rule win_unidentified_099_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.unidentified_099."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.unidentified_099"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { f3aa 498bf8 488d05cee3ffff 488bd3 6666660f1f840000000000 0fb68c0290f00100 4883c203 }
            // n = 7, score = 100
            //   f3aa                 | cmp                 ecx, dword ptr [edx]
            //   498bf8               | je                  0x187
            //   488d05cee3ffff       | inc                 eax
            //   488bd3               | xor                 eax, eax
            //   6666660f1f840000000000     | dec    esp
            //   0fb68c0290f00100     | lea                 ecx, [0x188f7]
            //   4883c203             | rep stosb           byte ptr es:[edi], al

        $sequence_1 = { e8???????? c70016000000 eb10 483bf3 }
            // n = 4, score = 100
            //   e8????????           |                     
            //   c70016000000         | lea                 ecx, [ebp + 0x1f0]
            //   eb10                 | inc                 ebp
            //   483bf3               | mov                 eax, esi

        $sequence_2 = { c705????????01000000 b808000000 486bc000 488d0d1ab30100 8b542430 48891401 }
            // n = 6, score = 100
            //   c705????????01000000     |     
            //   b808000000           | mov                 ecx, 0x20000000
            //   486bc000             | dec                 eax
            //   488d0d1ab30100       | lea                 edx, [esp + 0x50]
            //   8b542430             | inc                 ecx
            //   48891401             | or                  eax, 0xffffffff

        $sequence_3 = { 4c8ba424c8030000 488bb424c0030000 488b8d80020000 4833cc e8???????? 488b9c24d0030000 4881c490030000 }
            // n = 7, score = 100
            //   4c8ba424c8030000     | js                  0xbd8
            //   488bb424c0030000     | mov                 eax, 0x10
            //   488b8d80020000       | jmp                 0xbd0
            //   4833cc               | inc                 ecx
            //   e8????????           |                     
            //   488b9c24d0030000     | cmp                 byte ptr [eax], 0
            //   4881c490030000       | je                  0xbdd

        $sequence_4 = { 0f8276ffffff 488b4c2460 4833cc e8???????? 4c8d5c2470 498b5b18 }
            // n = 6, score = 100
            //   0f8276ffffff         | mov                 edx, ebx
            //   488b4c2460           | nop                 dword ptr [eax]
            //   4833cc               | nop                 word ptr [eax + eax]
            //   e8????????           |                     
            //   4c8d5c2470           | inc                 edx
            //   498b5b18             | movzx               ecx, byte ptr [edx + esi + 0x1f160]

        $sequence_5 = { 498bf8 488bd3 420fb68c3ad0eb0100 4883c203 880f 488d7f01 4883fa72 }
            // n = 7, score = 100
            //   498bf8               | dec                 eax
            //   488bd3               | xor                 eax, esp
            //   420fb68c3ad0eb0100     | dec    eax
            //   4883c203             | mov                 dword ptr [ebp + 0x540], eax
            //   880f                 | push                ebp
            //   488d7f01             | push                edi
            //   4883fa72             | inc                 ecx

        $sequence_6 = { 488bf9 4c8d0dace50000 33c9 4c8d059be50000 488d159ce50000 e8???????? 488bd8 }
            // n = 7, score = 100
            //   488bf9               | dec                 ecx
            //   4c8d0dace50000       | mov                 ebx, dword ptr [esi + 0x38]
            //   33c9                 | dec                 ecx
            //   4c8d059be50000       | mov                 edi, eax
            //   488d159ce50000       | mov                 esi, edx
            //   e8????????           |                     
            //   488bd8               | dec                 esp

        $sequence_7 = { 488d7b38 488d05b2100100 483947f0 741a 488b0f 4885c9 7412 }
            // n = 7, score = 100
            //   488d7b38             | dec                 eax
            //   488d05b2100100       | lea                 edx, [0xe55e]
            //   483947f0             | dec                 eax
            //   741a                 | mov                 edi, eax
            //   488b0f               | dec                 eax
            //   4885c9               | test                eax, eax
            //   7412                 | je                  0x1689

        $sequence_8 = { 4c8d442448 488d9500030000 488d8d10040000 e8???????? 80387b 0f8403010000 }
            // n = 6, score = 100
            //   4c8d442448           | lea                 ebp, [0x12719]
            //   488d9500030000       | mov                 ebp, ebx
            //   488d8d10040000       | dec                 ecx
            //   e8????????           |                     
            //   80387b               | mov                 eax, ebp
            //   0f8403010000         | inc                 ecx

        $sequence_9 = { 0f1f8000000000 8bd3 4c8d4c2444 4903d6 }
            // n = 4, score = 100
            //   0f1f8000000000       | movzx               ecx, byte ptr [edx + ebp + 0x1ea00]
            //   8bd3                 | dec                 eax
            //   4c8d4c2444           | add                 edx, 3
            //   4903d6               | nop                 dword ptr [eax]

    condition:
        7 of them and filesize < 314368
}