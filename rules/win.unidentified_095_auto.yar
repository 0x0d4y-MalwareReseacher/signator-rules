rule win_unidentified_095_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.unidentified_095."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.unidentified_095"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 7572 488b4c2468 488d442450 4889442428 4c8d4c2458 488d442460 48895c2440 }
            // n = 7, score = 100
            //   7572                 | dec                 eax
            //   488b4c2468           | mov                 ecx, edi
            //   488d442450           | dec                 esp
            //   4889442428           | mov                 esi, dword ptr [esp + 0x30]
            //   4c8d4c2458           | test                esi, esi
            //   488d442460           | jne                 0x177e
            //   48895c2440           | mov                 esi, 1

        $sequence_1 = { 4883ec20 488364243800 4c8d442438 8bd9 488d1596f30000 }
            // n = 5, score = 100
            //   4883ec20             | mov                 dword ptr [edi], 1
            //   488364243800         | mov                 ecx, edi
            //   4c8d442438           | test                eax, eax
            //   8bd9                 | jne                 0xdc0
            //   488d1596f30000       | inc                 ecx

        $sequence_2 = { 75ec 8bb424d8000000 bb01000000 4533c0 }
            // n = 4, score = 100
            //   75ec                 | dec                 eax
            //   8bb424d8000000       | lea                 edx, [0xfffee3e7]
            //   bb01000000           | shr                 eax, 3
            //   4533c0               | mov                 dword ptr [esp + 0x50], eax

        $sequence_3 = { 85ff 751d b957000000 ff15???????? 4883c8ff 488b6c2478 4883c440 }
            // n = 7, score = 100
            //   85ff                 | mov                 ebx, edi
            //   751d                 | dec                 eax
            //   b957000000           | inc                 ebx
            //   ff15????????         |                     
            //   4883c8ff             | test                eax, eax
            //   488b6c2478           | jne                 0x969
            //   4883c440             | cmp                 dword ptr [esp + 0x3c], 4

        $sequence_4 = { 48896c2460 33ff 4c89742438 498bd9 4c897c2430 4c8bf9 418be8 }
            // n = 7, score = 100
            //   48896c2460           | dec                 eax
            //   33ff                 | sar                 eax, 6
            //   4c89742438           | dec                 eax
            //   498bd9               | lea                 ecx, [0x18d88]
            //   4c897c2430           | inc                 ecx
            //   4c8bf9               | and                 edx, 0x3f
            //   418be8               | dec                 ebp

        $sequence_5 = { e8???????? 498bcd e8???????? 8bcb ff15???????? }
            // n = 5, score = 100
            //   e8????????           |                     
            //   498bcd               | dec                 eax
            //   e8????????           |                     
            //   8bcb                 | mov                 ecx, ebx
            //   ff15????????         |                     

        $sequence_6 = { 4885c9 741a 488d0554910000 483bc8 740e 83c8ff f00fc1815c010000 }
            // n = 7, score = 100
            //   4885c9               | je                  0x859
            //   741a                 | dec                 eax
            //   488d0554910000       | lea                 edx, [ebp - 0x71]
            //   483bc8               | dec                 eax
            //   740e                 | mov                 ecx, ebx
            //   83c8ff               | test                eax, eax
            //   f00fc1815c010000     | je                  0x812

        $sequence_7 = { 4885c9 7474 33db 4c8d3d43f6feff bfe3000000 8d041f 41b855000000 }
            // n = 7, score = 100
            //   4885c9               | cmp                 word ptr [edi + 2], 0x3a
            //   7474                 | je                  0x8c2
            //   33db                 | cmp                 word ptr [edi + 0xa], 0x3a
            //   4c8d3d43f6feff       | dec                 eax
            //   bfe3000000           | lea                 edx, [edi - 2]
            //   8d041f               | mov                 dword ptr [ecx], eax
            //   41b855000000         | nop                 word ptr [eax + eax]

        $sequence_8 = { 4885c0 7509 488d053b8d0100 eb04 4883c024 4883c428 c3 }
            // n = 7, score = 100
            //   4885c0               | mov                 ecx, edi
            //   7509                 | dec                 eax
            //   488d053b8d0100       | lea                 eax, [esp + 0x30]
            //   eb04                 | inc                 esp
            //   4883c024             | mov                 ecx, ebx
            //   4883c428             | inc                 ebp
            //   c3                   | xor                 eax, eax

        $sequence_9 = { 4885c0 742e 488d542420 488bce e8???????? 488d542420 488bcb }
            // n = 7, score = 100
            //   4885c0               | nop                 dword ptr [eax]
            //   742e                 | inc                 ecx
            //   488d542420           | movzx               eax, word ptr [edx + ecx*2]
            //   488bce               | mov                 word ptr [edx + ecx*2], ax
            //   e8????????           |                     
            //   488d542420           | dec                 eax
            //   488bcb               | lea                 edx, [edx + 2]

    condition:
        7 of them and filesize < 339968
}