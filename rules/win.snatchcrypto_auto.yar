rule win_snatchcrypto_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-11-21"
        version = "1"
        description = "Detects win.snatchcrypto."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.snatchcrypto"
        malpedia_rule_date = "20221118"
        malpedia_hash = "e0702e2e6d1d00da65c8a29a4ebacd0a4c59e1af"
        malpedia_version = "20221125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8b4c2434 89450c 8bc2 c1c010 41c1c110 4103c0 4403c8 }
            // n = 7, score = 200
            //   8b4c2434             | mov                 byte ptr [ebp + 0x10], bl
            //   89450c               | movzx               eax, byte ptr [ebx + 0x3c]
            //   8bc2                 | dec                 eax
            //   c1c010               | lea                 edx, [ebp + 0x10]
            //   41c1c110             | inc                 ecx
            //   4103c0               | mov                 eax, 1
            //   4403c8               | dec                 eax

        $sequence_1 = { 8be8 428d4c2500 e8???????? 488d542420 498bcd 448bc0 8bf0 }
            // n = 7, score = 200
            //   8be8                 | xor                 ecx, eax
            //   428d4c2500           | inc                 esp
            //   e8????????           |                     
            //   488d542420           | xor                 ecx, ecx
            //   498bcd               | inc                 ebp
            //   448bc0               | add                 ecx, dword ptr [esi + 0x24]
            //   8bf0                 | inc                 esp

        $sequence_2 = { ba7c000000 488bcf e8???????? 488bd8 4885c0 7403 668930 }
            // n = 7, score = 200
            //   ba7c000000           | mov                 eax, dword ptr [esp + 0x60]
            //   488bcf               | dec                 eax
            //   e8????????           |                     
            //   488bd8               | lea                 ecx, [0x18a4f]
            //   4885c0               | inc                 ebp
            //   7403                 | test                ecx, ecx
            //   668930               | je                  0xe9b

        $sequence_3 = { e9???????? 413928 400f95c5 89af94040000 e9???????? 413928 400f95c5 }
            // n = 7, score = 200
            //   e9????????           |                     
            //   413928               | mov                 dword ptr [eax], 0
            //   400f95c5             | dec                 esp
            //   89af94040000         | lea                 eax, [esp + 0x60]
            //   e9????????           |                     
            //   413928               | dec                 eax
            //   400f95c5             | sub                 esp, 0x30

        $sequence_4 = { 4103cd 448d9c11c67e9b28 488b542430 41c1c304 4503da 4133c3 03420c }
            // n = 7, score = 200
            //   4103cd               | mov                 edi, ecx
            //   448d9c11c67e9b28     | movups              xmmword ptr [esp + 0x20], xmm0
            //   488b542430           | push                edi
            //   41c1c304             | dec                 eax
            //   4503da               | sub                 esp, 0x80
            //   4133c3               | dec                 eax
            //   03420c               | xor                 eax, esp

        $sequence_5 = { 884510 e8???????? 440fb65b03 488d5510 41b801000000 488bcf 44885d10 }
            // n = 7, score = 200
            //   884510               | inc                 ecx
            //   e8????????           |                     
            //   440fb65b03           | mov                 eax, ebp
            //   488d5510             | inc                 ebp
            //   41b801000000         | add                 ecx, edi
            //   488bcf               | inc                 ecx
            //   44885d10             | ror                 eax, 2

        $sequence_6 = { 488b0d???????? 488bd7 e8???????? 448be0 85c0 0f8559010000 4c634710 }
            // n = 7, score = 200
            //   488b0d????????       |                     
            //   488bd7               | mov                 ecx, ebx
            //   e8????????           |                     
            //   448be0               | dec                 eax
            //   85c0                 | mov                 edx, dword ptr [ebx + 0x770]
            //   0f8559010000         | dec                 eax
            //   4c634710             | mov                 ecx, dword ptr [ebx + 0x300]

        $sequence_7 = { ba07000000 488bce e8???????? 83bba400000000 7e0c e8???????? 4889839c000000 }
            // n = 7, score = 200
            //   ba07000000           | jne                 0x833
            //   488bce               | dec                 eax
            //   e8????????           |                     
            //   83bba400000000       | lea                 edx, [ebp + 0x318]
            //   7e0c                 | inc                 ecx
            //   e8????????           |                     
            //   4889839c000000       | mov                 eax, 0xc

        $sequence_8 = { c3 33d2 4881c128050000 448d4250 e8???????? b900900000 c7832805000001000000 }
            // n = 7, score = 200
            //   c3                   | inc                 ecx
            //   33d2                 | rol                 ecx, 0xc
            //   4881c128050000       | inc                 ebp
            //   448d4250             | add                 ecx, ebx
            //   e8????????           |                     
            //   b900900000           | rol                 edx, 0xa
            //   c7832805000001000000     | inc    ecx

        $sequence_9 = { 8bc1 c1c20f 4103d1 41c1c30a 33c2 4123c3 33c1 }
            // n = 7, score = 200
            //   8bc1                 | dec                 eax
            //   c1c20f               | lea                 edx, [ebp + 0x860]
            //   4103d1               | dec                 ecx
            //   41c1c30a             | mov                 ecx, esi
            //   33c2                 | mov                 ebx, eax
            //   4123c3               | test                eax, eax
            //   33c1                 | je                  0x1778

    condition:
        7 of them and filesize < 1400832
}