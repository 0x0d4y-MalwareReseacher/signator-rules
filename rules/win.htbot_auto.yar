rule win_htbot_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-01-25"
        version = "1"
        description = "Detects win.htbot."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.htbot"
        malpedia_rule_date = "20230124"
        malpedia_hash = "2ee0eebba83dce3d019a90519f2f972c0fcf9686"
        malpedia_version = "20230125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8b8c243c080000 64890d00000000 59 5f 5e 5d 5b }
            // n = 7, score = 100
            //   8b8c243c080000       | mov                 ecx, dword ptr [esp + 0x83c]
            //   64890d00000000       | mov                 dword ptr fs:[0], ecx
            //   59                   | pop                 ecx
            //   5f                   | pop                 edi
            //   5e                   | pop                 esi
            //   5d                   | pop                 ebp
            //   5b                   | pop                 ebx

        $sequence_1 = { 8b45f8 8bd6 8b75f4 b901000000 2b4dfc 8d3c1e 2bc7 }
            // n = 7, score = 100
            //   8b45f8               | mov                 eax, dword ptr [ebp - 8]
            //   8bd6                 | mov                 edx, esi
            //   8b75f4               | mov                 esi, dword ptr [ebp - 0xc]
            //   b901000000           | mov                 ecx, 1
            //   2b4dfc               | sub                 ecx, dword ptr [ebp - 4]
            //   8d3c1e               | lea                 edi, [esi + ebx]
            //   2bc7                 | sub                 eax, edi

        $sequence_2 = { 83c510 896c2430 eb11 8b5df4 55 8d442434 e8???????? }
            // n = 7, score = 100
            //   83c510               | add                 ebp, 0x10
            //   896c2430             | mov                 dword ptr [esp + 0x30], ebp
            //   eb11                 | jmp                 0x13
            //   8b5df4               | mov                 ebx, dword ptr [ebp - 0xc]
            //   55                   | push                ebp
            //   8d442434             | lea                 eax, [esp + 0x34]
            //   e8????????           |                     

        $sequence_3 = { 85f6 7c11 3b75f8 7f0c 8975f4 c6042e00 e9???????? }
            // n = 7, score = 100
            //   85f6                 | test                esi, esi
            //   7c11                 | jl                  0x13
            //   3b75f8               | cmp                 esi, dword ptr [ebp - 8]
            //   7f0c                 | jg                  0xe
            //   8975f4               | mov                 dword ptr [ebp - 0xc], esi
            //   c6042e00             | mov                 byte ptr [esi + ebp], 0
            //   e9????????           |                     

        $sequence_4 = { eb52 8d4c240c 51 68???????? 6801000080 c744241001000000 ff15???????? }
            // n = 7, score = 100
            //   eb52                 | jmp                 0x54
            //   8d4c240c             | lea                 ecx, [esp + 0xc]
            //   51                   | push                ecx
            //   68????????           |                     
            //   6801000080           | push                0x80000001
            //   c744241001000000     | mov                 dword ptr [esp + 0x10], 1
            //   ff15????????         |                     

        $sequence_5 = { 51 8b4df0 8b11 8b4210 8d75f0 89642420 }
            // n = 6, score = 100
            //   51                   | push                ecx
            //   8b4df0               | mov                 ecx, dword ptr [ebp - 0x10]
            //   8b11                 | mov                 edx, dword ptr [ecx]
            //   8b4210               | mov                 eax, dword ptr [edx + 0x10]
            //   8d75f0               | lea                 esi, [ebp - 0x10]
            //   89642420             | mov                 dword ptr [esp + 0x20], esp

        $sequence_6 = { 8b44244c 83f801 75d9 eb46 83f801 7441 8b4c2418 }
            // n = 7, score = 100
            //   8b44244c             | mov                 eax, dword ptr [esp + 0x4c]
            //   83f801               | cmp                 eax, 1
            //   75d9                 | jne                 0xffffffdb
            //   eb46                 | jmp                 0x48
            //   83f801               | cmp                 eax, 1
            //   7441                 | je                  0x43
            //   8b4c2418             | mov                 ecx, dword ptr [esp + 0x18]

        $sequence_7 = { b304 eb5a 6683780802 7404 b304 eb4f 8b400c }
            // n = 7, score = 100
            //   b304                 | mov                 bl, 4
            //   eb5a                 | jmp                 0x5c
            //   6683780802           | cmp                 word ptr [eax + 8], 2
            //   7404                 | je                  6
            //   b304                 | mov                 bl, 4
            //   eb4f                 | jmp                 0x51
            //   8b400c               | mov                 eax, dword ptr [eax + 0xc]

        $sequence_8 = { 8d4310 89442418 eb11 8b58f4 50 8d44241c e8???????? }
            // n = 7, score = 100
            //   8d4310               | lea                 eax, [ebx + 0x10]
            //   89442418             | mov                 dword ptr [esp + 0x18], eax
            //   eb11                 | jmp                 0x13
            //   8b58f4               | mov                 ebx, dword ptr [eax - 0xc]
            //   50                   | push                eax
            //   8d44241c             | lea                 eax, [esp + 0x1c]
            //   e8????????           |                     

        $sequence_9 = { 3bfa 7313 668b28 668929 83c102 83c002 83c701 }
            // n = 7, score = 100
            //   3bfa                 | cmp                 edi, edx
            //   7313                 | jae                 0x15
            //   668b28               | mov                 bp, word ptr [eax]
            //   668929               | mov                 word ptr [ecx], bp
            //   83c102               | add                 ecx, 2
            //   83c002               | add                 eax, 2
            //   83c701               | add                 edi, 1

    condition:
        7 of them and filesize < 196608
}