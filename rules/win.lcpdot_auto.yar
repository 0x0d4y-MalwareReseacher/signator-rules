rule win_lcpdot_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-11-21"
        version = "1"
        description = "Detects win.lcpdot."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.lcpdot"
        malpedia_rule_date = "20221118"
        malpedia_hash = "e0702e2e6d1d00da65c8a29a4ebacd0a4c59e1af"
        malpedia_version = "20221125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 75d4 488d1d67190100 488b4bf8 4885c9 740b 833b01 }
            // n = 6, score = 100
            //   75d4                 | cmp                 dword ptr [esp + 0x74], 4
            //   488d1d67190100       | jne                 0x51
            //   488b4bf8             | mov                 dword ptr [ebx + 0x28], 1
            //   4885c9               | mov                 eax, 1
            //   740b                 | cmp                 eax, 1
            //   833b01               | jne                 0xb4

        $sequence_1 = { 4154 4883ec20 4533e4 bd01000000 4c3925???????? 746b }
            // n = 6, score = 100
            //   4154                 | dec                 eax
            //   4883ec20             | lea                 edx, [0xdac9]
            //   4533e4               | inc                 ecx
            //   bd01000000           | mov                 eax, 0x40
            //   4c3925????????       |                     
            //   746b                 | dec                 eax

        $sequence_2 = { ff15???????? b801000000 488b6c2468 488b5c2478 4883c440 415c 5f }
            // n = 7, score = 100
            //   ff15????????         |                     
            //   b801000000           | inc                 ecx
            //   488b6c2468           | cmp                 edi, esp
            //   488b5c2478           | jge                 0xb63
            //   4883c440             | cmp                 eax, 1
            //   415c                 | jne                 0xabd
            //   5f                   | inc                 ecx

        $sequence_3 = { 4c8d4c2440 4c8d842440020000 f2ae 488d542430 c744242800000000 48f7d1 48c744243000000000 }
            // n = 7, score = 100
            //   4c8d4c2440           | dec                 ecx
            //   4c8d842440020000     | mov                 eax, dword ptr [esp + esi*8]
            //   f2ae                 | movsx               ecx, byte ptr [eax + ebx + 8]
            //   488d542430           | and                 ecx, 1
            //   c744242800000000     | dec                 esp
            //   48f7d1               | lea                 esp, [0x134aa]
            //   48c744243000000000     | jmp    0x9a9

        $sequence_4 = { 41c1fa02 4585d2 7e7d 458be2 4c8d2d6f260100 0fb64602 0fb64e01 }
            // n = 7, score = 100
            //   41c1fa02             | dec                 eax
            //   4585d2               | mov                 dword ptr [ecx + 0xa0], eax
            //   7e7d                 | and                 dword ptr [ecx + 0x10], 0
            //   458be2               | dec                 eax
            //   4c8d2d6f260100       | sub                 esp, 0x20
            //   0fb64602             | dec                 eax
            //   0fb64e01             | lea                 eax, [0xe62f]

        $sequence_5 = { c78510010000bdbd151b c785140100000e4331b6 c78518010000842b4101 c7851c0100001716c0ce }
            // n = 4, score = 100
            //   c78510010000bdbd151b     | dec    esp
            //   c785140100000e4331b6     | lea    esp, [0x1034a]
            //   c78518010000842b4101     | and    ebx, 0x1f
            //   c7851c0100001716c0ce     | dec    eax

        $sequence_6 = { 4c8d0d0998ffff 41f640387f 7529 413bc7 741e 83f8fe 7419 }
            // n = 7, score = 100
            //   4c8d0d0998ffff       | dec                 ecx
            //   41f640387f           | sar                 ebp, 5
            //   7529                 | dec                 esp
            //   413bc7               | lea                 esi, [0x12e3c]
            //   741e                 | and                 ebx, 0x1f
            //   83f8fe               | dec                 eax
            //   7419                 | imul                ebx, ebx, 0x58

        $sequence_7 = { 4155 4881ec10040000 8b02 458be0 488bfa 894110 }
            // n = 6, score = 100
            //   4155                 | dec                 eax
            //   4881ec10040000       | mov                 eax, ebx
            //   8b02                 | dec                 eax
            //   458be0               | mov                 ebx, ecx
            //   488bfa               | dec                 esp
            //   894110               | lea                 ebx, [0xe7d3]

        $sequence_8 = { e8???????? ebc9 488bcb 488bc3 488d15ff360100 48c1f805 }
            // n = 6, score = 100
            //   e8????????           |                     
            //   ebc9                 | dec                 ecx
            //   488bcb               | mov                 ecx, esp
            //   488bc3               | xor                 eax, eax
            //   488d15ff360100       | dec                 eax
            //   48c1f805             | mov                 ecx, dword ptr [esp + 0x870]

        $sequence_9 = { ff15???????? 488b4b08 41b904000000 4c8d442440 418d51fe c744244010270000 }
            // n = 6, score = 100
            //   ff15????????         |                     
            //   488b4b08             | and                 ecx, 0xf
            //   41b904000000         | jmp                 0xb50
            //   4c8d442440           | inc                 ecx
            //   418d51fe             | mov                 ecx, edx
            //   c744244010270000     | dec                 eax

    condition:
        7 of them and filesize < 257024
}