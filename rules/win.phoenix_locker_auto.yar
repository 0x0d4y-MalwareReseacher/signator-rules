rule win_phoenix_locker_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-04-08"
        version = "1"
        description = "Describes win.phoenix_locker."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.phoenix_locker"
        malpedia_rule_date = "20220405"
        malpedia_hash = "ecd38294bd47d5589be5cd5490dc8bb4804afc2a"
        malpedia_version = ""
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 4d8beb 451add c0842418000000ec 0f88e9ffffff 4881842400000000d7296140 66453bdb 410f94c3 }
            // n = 7, score = 200
            //   4d8beb               | mov                 ecx, ebp
            //   451add               | inc                 eax
            //   c0842418000000ec     | seta                bh
            //   0f88e9ffffff         | inc                 eax
            //   4881842400000000d7296140     | xchg    bh, bh
            //   66453bdb             | not                 di
            //   410f94c3             | mov                 edi, 1

        $sequence_1 = { 488bd5 b9c206b2cb e8???????? 4c8d8680000000 488bd5 b969eec4dc }
            // n = 6, score = 200
            //   488bd5               | inc                 ecx
            //   b9c206b2cb           | pop                 esi
            //   e8????????           |                     
            //   4c8d8680000000       | inc                 ecx
            //   488bd5               | setp                ch
            //   b969eec4dc           | inc                 ecx

        $sequence_2 = { e8???????? e8???????? 212c57 d025???????? 69e8513d9413 8b20 6e }
            // n = 7, score = 200
            //   e8????????           |                     
            //   e8????????           |                     
            //   212c57               | push                0x69957d3a
            //   d025????????         |                     
            //   69e8513d9413         | shr                 byte ptr [esp + 0x10], 0x97
            //   8b20                 | js                  0xffef5b55
            //   6e                   | push                esi

        $sequence_3 = { 0c6a 792f 4e4eb228 a94e8b2173 51 b153 3cf8 }
            // n = 7, score = 200
            //   0c6a                 | cmc                 
            //   792f                 | inc                 ebp
            //   4e4eb228             | sub                 ebx, ebx
            //   a94e8b2173           | inc                 bp
            //   51                   | test                esi, ebx
            //   b153                 | inc                 ecx
            //   3cf8                 | cmp                 eax, ebx

        $sequence_4 = { 488d1c43 0f857bffffff 4885f6 e9???????? 0f8419000000 482bdf 0fbaf064 }
            // n = 7, score = 200
            //   488d1c43             | inc                 sp
            //   0f857bffffff         | cmp                 eax, edx
            //   4885f6               | cmc                 
            //   e9????????           |                     
            //   0f8419000000         | dec                 esp
            //   482bdf               | mov                 dword ptr [esp + 0x78], edi
            //   0fbaf064             | inc                 ebp

        $sequence_5 = { 6700bb8e2f99a2 3c8e 5e 0bc9 c1f137 fb 98 }
            // n = 7, score = 200
            //   6700bb8e2f99a2       | xadd                ah, al
            //   3c8e                 | mov                 eax, ecx
            //   5e                   | inc                 cx
            //   0bc9                 | ror                 eax, cl
            //   c1f137               | shr                 al, 7
            //   fb                   | cmc                 
            //   98                   | inc                 esp

        $sequence_6 = { f7942410000000 48c7442410f9f2c8a7 686d2c8277 e8???????? 5f e223 bc995a6625 }
            // n = 7, score = 200
            //   f7942410000000       | mov                 ah, 0xa4
            //   48c7442410f9f2c8a7     | dec    eax
            //   686d2c8277           | shl                 ecx, cl
            //   e8????????           |                     
            //   5f                   | bts                 ax, di
            //   e223                 | movzx               ax, byte ptr [esi]
            //   bc995a6625           | adc                 cx, 0x372

        $sequence_7 = { e9???????? 0f84a9000000 418b12 d2c8 418bc8 d3d8 }
            // n = 6, score = 200
            //   e9????????           |                     
            //   0f84a9000000         | inc                 ecx
            //   418b12               | rol                 ebp, cl
            //   d2c8                 | dec                 eax
            //   418bc8               | mov                 ebp, dword ptr [esp + 0x68]
            //   d3d8                 | inc                 eax

        $sequence_8 = { 0f42d0 e8???????? 488d4c2478 8bd6 450fbfc2 4c8bc3 99 }
            // n = 7, score = 200
            //   0f42d0               | dec                 eax
            //   e8????????           |                     
            //   488d4c2478           | mov                 ecx, dword ptr [esp + 0x50]
            //   8bd6                 | cmovo               si, si
            //   450fbfc2             | mov                 esi, eax
            //   4c8bc3               | dec                 eax
            //   99                   | mov                 ecx, dword ptr [esp + 0x70]

        $sequence_9 = { 3bca e9???????? 0f8510000000 66837f422e e9???????? 0f843b050000 }
            // n = 6, score = 200
            //   3bca                 | cwde                
            //   e9????????           |                     
            //   0f8510000000         | outsb               dx, byte ptr [esi]
            //   66837f422e           | push                0x523d198b
            //   e9????????           |                     
            //   0f843b050000         | push                0x124a4c9d

    condition:
        7 of them and filesize < 3702784
}