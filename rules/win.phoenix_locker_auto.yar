rule win_phoenix_locker_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-08-05"
        version = "1"
        description = "Detects win.phoenix_locker."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.phoenix_locker"
        malpedia_rule_date = "20220805"
        malpedia_hash = "6ec06c64bcfdbeda64eff021c766b4ce34542b71"
        malpedia_version = "20220808"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 0f85afffffff e9???????? 4585c9 e9???????? 0f8431000000 418b0a f5 }
            // n = 7, score = 200
            //   0f85afffffff         | xor                 ebx, 0x2f546bb0
            //   e9????????           |                     
            //   4585c9               | inc                 ebp
            //   e9????????           |                     
            //   0f8431000000         | xor                 esi, esi
            //   418b0a               | dec                 eax
            //   f5                   | bswap               ebx

        $sequence_1 = { 4c8be1 e9???????? ff15???????? 488b0d220ee5ff f8 f6c1b9 450ac7 }
            // n = 7, score = 200
            //   4c8be1               | jnp                 0x8f
            //   e9????????           |                     
            //   ff15????????         |                     
            //   488b0d220ee5ff       | add                 byte ptr [eax - 0x76], bl
            //   f8                   | push                ecx
            //   f6c1b9               | inc                 ecx
            //   450ac7               | sar                 edx, 0x7e

        $sequence_2 = { 660f4ae9 5d e9???????? c3 4053 440fb3db 4883ec20 }
            // n = 7, score = 200
            //   660f4ae9             | shrd                cx, bp, 0x21
            //   5d                   | dec                 ecx
            //   e9????????           |                     
            //   c3                   | add                 edx, 0x10
            //   4053                 | inc                 sp
            //   440fb3db             | shld                eax, edi, 0x57
            //   4883ec20             | dec                 eax

        $sequence_3 = { 0d3816667e a3????????1a8c294f 5f 52 51 ad 84dd }
            // n = 7, score = 200
            //   0d3816667e           | dec                 eax
            //   a3????????1a8c294f     |     
            //   5f                   | add                 dword ptr [esp + 0x10], 0x115d4586
            //   52                   | shr                 byte ptr [esp + 8], 0xea
            //   51                   | dec                 eax
            //   ad                   | lea                 esp, [esp + 0x20]
            //   84dd                 | shl                 word ptr [esp + 8], 0xb4

        $sequence_4 = { 488bc2 81fcae5e6821 f6c1a2 23ce 48c1e818 66413bec 4981f896365442 }
            // n = 7, score = 200
            //   488bc2               | dec                 ebp
            //   81fcae5e6821         | shld                eax, ecx, 0xf
            //   f6c1a2               | inc                 ecx
            //   23ce                 | xor                 al, 0x1f
            //   48c1e818             | dec                 esp
            //   66413bec             | mov                 eax, eax
            //   4981f896365442       | inc                 bp

        $sequence_5 = { 0f90c0 418a41fe f9 443bef 4080fe55 418840ff }
            // n = 6, score = 200
            //   0f90c0               | inc                 ebp
            //   418a41fe             | movsx               ecx, ax
            //   f9                   | test                eax, eax
            //   443bef               | je                  0xbaa
            //   4080fe55             | dec                 eax
            //   418840ff             | mov                 ecx, dword ptr [esp + 0x60]

        $sequence_6 = { 413bf1 e9???????? 0f876f000000 6683c720 66893b e9???????? e9???????? }
            // n = 7, score = 200
            //   413bf1               | movsd               dword ptr es:[edi], dword ptr [esi]
            //   e9????????           |                     
            //   0f876f000000         | in                  al, dx
            //   6683c720             | mov                 ch, 0xa5
            //   66893b               | iretd               
            //   e9????????           |                     
            //   e9????????           |                     

        $sequence_7 = { 48896810 41b0b2 48c1d54c 48897018 41d2c0 40f6d5 }
            // n = 6, score = 200
            //   48896810             | movzx               ebp, cx
            //   41b0b2               | pushfd              
            //   48c1d54c             | inc                 ecx
            //   48897018             | cmp                 bh, 0xc0
            //   41d2c0               | bsr                 bp, bp
            //   40f6d5               | inc                 ecx

        $sequence_8 = { 9c 4803ff 687617500d 4156 c08c240800000045 e8???????? 7b09 }
            // n = 7, score = 200
            //   9c                   | pop                 ebp
            //   4803ff               | inc                 cx
            //   687617500d           | movzx               edi, ch
            //   4156                 | dec                 ecx
            //   c08c240800000045     | mov                 esp, ebx
            //   e8????????           |                     
            //   7b09                 | inc                 ecx

        $sequence_9 = { 660fbef9 f7d7 56 87fe 66400fbefd 4863f3 9c }
            // n = 7, score = 200
            //   660fbef9             | bts                 cx, ax
            //   f7d7                 | inc                 ecx
            //   56                   | push                ebx
            //   87fe                 | dec                 eax
            //   66400fbefd           | cwde                
            //   4863f3               | dec                 eax
            //   9c                   | movsx               eax, di

    condition:
        7 of them and filesize < 3702784
}