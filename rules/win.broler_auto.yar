rule win_broler_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-04-08"
        version = "1"
        description = "Describes win.broler."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.broler"
        malpedia_rule_date = "20220405"
        malpedia_hash = "ecd38294bd47d5589be5cd5490dc8bb4804afc2a"
        malpedia_version = ""
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 83f80f 7303 8945fc 2bd3 }
            // n = 4, score = 100
            //   83f80f               | cmp                 eax, 0xf
            //   7303                 | jae                 5
            //   8945fc               | mov                 dword ptr [ebp - 4], eax
            //   2bd3                 | sub                 edx, ebx

        $sequence_1 = { 8bbd18dffcff b8???????? 8bcf e8???????? 8db55cdffcff e8???????? 8db578dffcff }
            // n = 7, score = 100
            //   8bbd18dffcff         | mov                 edi, dword ptr [ebp - 0x320e8]
            //   b8????????           |                     
            //   8bcf                 | mov                 ecx, edi
            //   e8????????           |                     
            //   8db55cdffcff         | lea                 esi, dword ptr [ebp - 0x320a4]
            //   e8????????           |                     
            //   8db578dffcff         | lea                 esi, dword ptr [ebp - 0x32088]

        $sequence_2 = { 5b 5f 8d45e8 5e }
            // n = 4, score = 100
            //   5b                   | pop                 ebx
            //   5f                   | pop                 edi
            //   8d45e8               | lea                 eax, dword ptr [ebp - 0x18]
            //   5e                   | pop                 esi

        $sequence_3 = { 8b5d08 c1fb08 8bc2 c1f808 25ff000000 3298085a4100 }
            // n = 6, score = 100
            //   8b5d08               | mov                 ebx, dword ptr [ebp + 8]
            //   c1fb08               | sar                 ebx, 8
            //   8bc2                 | mov                 eax, edx
            //   c1f808               | sar                 eax, 8
            //   25ff000000           | and                 eax, 0xff
            //   3298085a4100         | xor                 bl, byte ptr [eax + 0x415a08]

        $sequence_4 = { 3283085a4100 8b5d0c 884308 8b5d08 8bc2 c1f810 }
            // n = 6, score = 100
            //   3283085a4100         | xor                 al, byte ptr [ebx + 0x415a08]
            //   8b5d0c               | mov                 ebx, dword ptr [ebp + 0xc]
            //   884308               | mov                 byte ptr [ebx + 8], al
            //   8b5d08               | mov                 ebx, dword ptr [ebp + 8]
            //   8bc2                 | mov                 eax, edx
            //   c1f810               | sar                 eax, 0x10

        $sequence_5 = { 333c9d08844100 25ff000000 333c8508884100 83c104 4a 8979fc 75b3 }
            // n = 7, score = 100
            //   333c9d08844100       | xor                 edi, dword ptr [ebx*4 + 0x418408]
            //   25ff000000           | and                 eax, 0xff
            //   333c8508884100       | xor                 edi, dword ptr [eax*4 + 0x418808]
            //   83c104               | add                 ecx, 4
            //   4a                   | dec                 edx
            //   8979fc               | mov                 dword ptr [ecx - 4], edi
            //   75b3                 | jne                 0xffffffb5

        $sequence_6 = { 8d95f0fdffff 52 8d85f0feffff 53 50 e8???????? 83c414 }
            // n = 7, score = 100
            //   8d95f0fdffff         | lea                 edx, dword ptr [ebp - 0x210]
            //   52                   | push                edx
            //   8d85f0feffff         | lea                 eax, dword ptr [ebp - 0x110]
            //   53                   | push                ebx
            //   50                   | push                eax
            //   e8????????           |                     
            //   83c414               | add                 esp, 0x14

        $sequence_7 = { e8???????? 83c40c 8d8d10dffcff 51 6800900100 8d95e8dffcff 52 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   83c40c               | add                 esp, 0xc
            //   8d8d10dffcff         | lea                 ecx, dword ptr [ebp - 0x320f0]
            //   51                   | push                ecx
            //   6800900100           | push                0x19000
            //   8d95e8dffcff         | lea                 edx, dword ptr [ebp - 0x32018]
            //   52                   | push                edx

        $sequence_8 = { 8b35???????? 53 2bc2 8d8d68feffff }
            // n = 4, score = 100
            //   8b35????????         |                     
            //   53                   | push                ebx
            //   2bc2                 | sub                 eax, edx
            //   8d8d68feffff         | lea                 ecx, dword ptr [ebp - 0x198]

        $sequence_9 = { 8bdf c1fb10 81e3ff000000 8bc2 c1f808 }
            // n = 5, score = 100
            //   8bdf                 | mov                 ebx, edi
            //   c1fb10               | sar                 ebx, 0x10
            //   81e3ff000000         | and                 ebx, 0xff
            //   8bc2                 | mov                 eax, edx
            //   c1f808               | sar                 eax, 8

    condition:
        7 of them and filesize < 275456
}