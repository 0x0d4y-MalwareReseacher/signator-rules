rule win_juicy_potato_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-06-10"
        version = "1"
        description = "Detects win.juicy_potato."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.juicy_potato"
        malpedia_rule_date = "20210604"
        malpedia_hash = "be09d5d71e77373c0f538068be31a2ad4c69cfbd"
        malpedia_version = "20210616"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 488d1554d30300 83e13f 498bc1 48c1f806 48c1e106 48030cc2 eb07 }
            // n = 7, score = 100
            //   488d1554d30300       | dec                 eax
            //   83e13f               | mov                 eax, ecx
            //   498bc1               | ret                 
            //   48c1f806             | xor                 eax, eax
            //   48c1e106             | dec                 eax
            //   48030cc2             | mov                 dword ptr [ecx + 8], eax
            //   eb07                 | dec                 eax

        $sequence_1 = { 488903 4885c0 7406 0f57c0 0f1100 488b03 488918 }
            // n = 7, score = 100
            //   488903               | mov                 dword ptr [ebp + 0x38], eax
            //   4885c0               | inc                 esp
            //   7406                 | lea                 ecx, dword ptr [edi + 4]
            //   0f57c0               | dec                 eax
            //   0f1100               | lea                 eax, dword ptr [esp + 0x78]
            //   488b03               | mov                 dword ptr [esp + 0x88], edi
            //   488918               | dec                 eax

        $sequence_2 = { 0fb7d0 488d8de0000000 81ca00000780 85c0 0f4ed0 e8???????? 488d15a8350200 }
            // n = 7, score = 100
            //   0fb7d0               | xor                 ecx, esp
            //   488d8de0000000       | int                 0x29
            //   81ca00000780         | dec                 eax
            //   85c0                 | lea                 ecx, dword ptr [0x4dc37]
            //   0f4ed0               | dec                 eax
            //   e8????????           |                     
            //   488d15a8350200       | mov                 eax, dword ptr [esp + 0x38]

        $sequence_3 = { 49894620 4885c0 7565 488d4de0 e8???????? 488d15b6390300 488d4de0 }
            // n = 7, score = 100
            //   49894620             | lea                 eax, dword ptr [0x335f0]
            //   4885c0               | dec                 eax
            //   7565                 | lea                 eax, dword ptr [0x4c545]
            //   488d4de0             | dec                 eax
            //   e8????????           |                     
            //   488d15b6390300       | add                 esp, 0x28
            //   488d4de0             | ret                 

        $sequence_4 = { 32c0 eb7a 488d0d38db0400 e8???????? }
            // n = 4, score = 100
            //   32c0                 | dec                 eax
            //   eb7a                 | mov                 ecx, eax
            //   488d0d38db0400       | jg                  0xffffff9b
            //   e8????????           |                     

        $sequence_5 = { 488b5c2430 894718 488d0530f20000 488907 }
            // n = 4, score = 100
            //   488b5c2430           | inc                 ecx
            //   894718               | cmp                 eax, -1
            //   488d0530f20000       | dec                 eax
            //   488907               | cmp                 ecx, 8

        $sequence_6 = { 488d45f0 4889442428 33f6 89742420 4c8bcf }
            // n = 5, score = 100
            //   488d45f0             | dec                 eax
            //   4889442428           | mov                 ebx, ecx
            //   33f6                 | dec                 eax
            //   89742420             | lea                 eax, dword ptr [0x11f93]
            //   4c8bcf               | dec                 eax

        $sequence_7 = { c3 4883ec58 48c7442430feffffff 488d05d4820200 4889442460 b801000000 }
            // n = 6, score = 100
            //   c3                   | test                eax, eax
            //   4883ec58             | cmovle              edx, eax
            //   48c7442430feffffff     | dec    eax
            //   488d05d4820200       | lea                 edx, dword ptr [0x23466]
            //   4889442460           | dec                 eax
            //   b801000000           | lea                 ecx, dword ptr [esp + 0x20]

        $sequence_8 = { 488d4c2420 e8???????? cc 488d4c2420 e8???????? 488d155c340300 488d4c2420 }
            // n = 7, score = 100
            //   488d4c2420           | and                 dword ptr [eax], 0
            //   e8????????           |                     
            //   cc                   | dec                 eax
            //   488d4c2420           | mov                 dword ptr [eax + 8], eax
            //   e8????????           |                     
            //   488d155c340300       | mov                 dword ptr [eax + 0x10], 0
            //   488d4c2420           | jmp                 0x926

        $sequence_9 = { e8???????? 488d154a280400 488d0df7200400 e8???????? 488d0d0b210400 e8???????? 488d0daf210400 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   488d154a280400       | int3                
            //   488d0df7200400       | dec                 eax
            //   e8????????           |                     
            //   488d0d0b210400       | lea                 ecx, dword ptr [esp + 0x20]
            //   e8????????           |                     
            //   488d0daf210400       | dec                 eax

    condition:
        7 of them and filesize < 736256
}