rule win_nabucur_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-04-08"
        version = "1"
        description = "Describes win.nabucur."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.nabucur"
        malpedia_rule_date = "20220405"
        malpedia_hash = "ecd38294bd47d5589be5cd5490dc8bb4804afc2a"
        malpedia_version = ""
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 48 49 85c0 75fa }
            // n = 4, score = 200
            //   48                   | dec                 eax
            //   49                   | dec                 ecx
            //   85c0                 | test                eax, eax
            //   75fa                 | jne                 0xfffffffc

        $sequence_1 = { 33ff 0bfd 8bd8 0facd012 33ed 0be8 8b442440 }
            // n = 7, score = 200
            //   33ff                 | xor                 edi, edi
            //   0bfd                 | or                  edi, ebp
            //   8bd8                 | mov                 ebx, eax
            //   0facd012             | shrd                eax, edx, 0x12
            //   33ed                 | xor                 ebp, ebp
            //   0be8                 | or                  ebp, eax
            //   8b442440             | mov                 eax, dword ptr [esp + 0x40]

        $sequence_2 = { 009eaa030000 0fb686aa030000 57 83f80a 0f876d010000 }
            // n = 5, score = 200
            //   009eaa030000         | add                 byte ptr [esi + 0x3aa], bl
            //   0fb686aa030000       | movzx               eax, byte ptr [esi + 0x3aa]
            //   57                   | push                edi
            //   83f80a               | cmp                 eax, 0xa
            //   0f876d010000         | ja                  0x173

        $sequence_3 = { 48 43 0bf9 85c0 }
            // n = 4, score = 200
            //   48                   | dec                 eax
            //   43                   | inc                 ebx
            //   0bf9                 | or                  edi, ecx
            //   85c0                 | test                eax, eax

        $sequence_4 = { 48 41 0bf2 85c0 }
            // n = 4, score = 200
            //   48                   | dec                 eax
            //   41                   | inc                 ecx
            //   0bf2                 | or                  esi, edx
            //   85c0                 | test                eax, eax

        $sequence_5 = { 48 3bc8 7cee 8d742418 e8???????? }
            // n = 5, score = 200
            //   48                   | dec                 eax
            //   3bc8                 | cmp                 ecx, eax
            //   7cee                 | jl                  0xfffffff0
            //   8d742418             | lea                 esi, dword ptr [esp + 0x18]
            //   e8????????           |                     

        $sequence_6 = { 48 5f 894500 5d }
            // n = 4, score = 200
            //   48                   | dec                 eax
            //   5f                   | pop                 edi
            //   894500               | mov                 dword ptr [ebp], eax
            //   5d                   | pop                 ebp

        $sequence_7 = { 48 45 0bf1 85c0 }
            // n = 4, score = 200
            //   48                   | dec                 eax
            //   45                   | inc                 ebp
            //   0bf1                 | or                  esi, ecx
            //   85c0                 | test                eax, eax

        $sequence_8 = { 81f2d06095f7 81f3df6906fc ba53c8acfa 3d47e655e2 }
            // n = 4, score = 100
            //   81f2d06095f7         | xor                 edx, 0xf79560d0
            //   81f3df6906fc         | xor                 ebx, 0xfc0669df
            //   ba53c8acfa           | mov                 edx, 0xfaacc853
            //   3d47e655e2           | cmp                 eax, 0xe255e647

        $sequence_9 = { bafa77a6fd eb41 83f901 0f8d88000000 ba2ad4e6ff }
            // n = 5, score = 100
            //   bafa77a6fd           | mov                 edx, 0xfda677fa
            //   eb41                 | jmp                 0x43
            //   83f901               | cmp                 ecx, 1
            //   0f8d88000000         | jge                 0x8e
            //   ba2ad4e6ff           | mov                 edx, 0xffe6d42a

        $sequence_10 = { 4c 15602dee05 f8 2ac8 a3???????? }
            // n = 5, score = 100
            //   4c                   | dec                 esp
            //   15602dee05           | adc                 eax, 0x5ee2d60
            //   f8                   | clc                 
            //   2ac8                 | sub                 cl, al
            //   a3????????           |                     

        $sequence_11 = { 64892500000000 837de401 750a 8d45e8 50 ff15???????? }
            // n = 6, score = 100
            //   64892500000000       | mov                 dword ptr fs:[0], esp
            //   837de401             | cmp                 dword ptr [ebp - 0x1c], 1
            //   750a                 | jne                 0xc
            //   8d45e8               | lea                 eax, dword ptr [ebp - 0x18]
            //   50                   | push                eax
            //   ff15????????         |                     

        $sequence_12 = { 81f216886dff baaf746bf8 81f2d2b424fb e8???????? 81f2e5b3d7f7 bbee904bf8 }
            // n = 6, score = 100
            //   81f216886dff         | xor                 edx, 0xff6d8816
            //   baaf746bf8           | mov                 edx, 0xf86b74af
            //   81f2d2b424fb         | xor                 edx, 0xfb24b4d2
            //   e8????????           |                     
            //   81f2e5b3d7f7         | xor                 edx, 0xf7d7b3e5
            //   bbee904bf8           | mov                 ebx, 0xf84b90ee

        $sequence_13 = { eb8b 83c604 83e904 ebc2 83f901 }
            // n = 5, score = 100
            //   eb8b                 | jmp                 0xffffff8d
            //   83c604               | add                 esi, 4
            //   83e904               | sub                 ecx, 4
            //   ebc2                 | jmp                 0xffffffc4
            //   83f901               | cmp                 ecx, 1

        $sequence_14 = { 8711 42 27 f5 700d e1c8 }
            // n = 6, score = 100
            //   8711                 | xchg                dword ptr [ecx], edx
            //   42                   | inc                 edx
            //   27                   | daa                 
            //   f5                   | cmc                 
            //   700d                 | jo                  0xf
            //   e1c8                 | loope               0xffffffca

        $sequence_15 = { b68a 85b24b2537a7 91 8b8592b3c537 a7 }
            // n = 5, score = 100
            //   b68a                 | mov                 dh, 0x8a
            //   85b24b2537a7         | test                dword ptr [edx - 0x58c8dab5], esi
            //   91                   | xchg                eax, ecx
            //   8b8592b3c537         | mov                 eax, dword ptr [ebp + 0x37c5b392]
            //   a7                   | cmpsd               dword ptr [esi], dword ptr es:[edi]

    condition:
        7 of them and filesize < 1949696
}