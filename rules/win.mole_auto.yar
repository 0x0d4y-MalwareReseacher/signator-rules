rule win_mole_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-08-05"
        version = "1"
        description = "Detects win.mole."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.mole"
        malpedia_rule_date = "20220805"
        malpedia_hash = "6ec06c64bcfdbeda64eff021c766b4ce34542b71"
        malpedia_version = "20220808"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 81bdf0fdffff20e37018 0f84f8420000 81bdf0fdffff26587018 0f8426370000 81bdf0fdffff20e27018 0f84ea3f0000 e9???????? }
            // n = 7, score = 100
            //   81bdf0fdffff20e37018     | cmp    dword ptr [ebp - 0x210], 0x1870e320
            //   0f84f8420000         | je                  0x42fe
            //   81bdf0fdffff26587018     | cmp    dword ptr [ebp - 0x210], 0x18705826
            //   0f8426370000         | je                  0x372c
            //   81bdf0fdffff20e27018     | cmp    dword ptr [ebp - 0x210], 0x1870e220
            //   0f84ea3f0000         | je                  0x3ff0
            //   e9????????           |                     

        $sequence_1 = { 0f845e700000 81bdf0fdffff4c2bd105 7745 81bdf0fdffff4c2bd105 }
            // n = 4, score = 100
            //   0f845e700000         | je                  0x7064
            //   81bdf0fdffff4c2bd105     | cmp    dword ptr [ebp - 0x210], 0x5d12b4c
            //   7745                 | ja                  0x47
            //   81bdf0fdffff4c2bd105     | cmp    dword ptr [ebp - 0x210], 0x5d12b4c

        $sequence_2 = { 7520 6a08 6a18 68???????? 6a00 8d4df8 51 }
            // n = 7, score = 100
            //   7520                 | jne                 0x22
            //   6a08                 | push                8
            //   6a18                 | push                0x18
            //   68????????           |                     
            //   6a00                 | push                0
            //   8d4df8               | lea                 ecx, [ebp - 8]
            //   51                   | push                ecx

        $sequence_3 = { ff249544cd4000 81bdf0fdffff332dd405 0f8786000000 81bdf0fdffff332dd405 0f846c550000 81bdf0fdffffc92bd405 7745 }
            // n = 7, score = 100
            //   ff249544cd4000       | jmp                 dword ptr [edx*4 + 0x40cd44]
            //   81bdf0fdffff332dd405     | cmp    dword ptr [ebp - 0x210], 0x5d42d33
            //   0f8786000000         | ja                  0x8c
            //   81bdf0fdffff332dd405     | cmp    dword ptr [ebp - 0x210], 0x5d42d33
            //   0f846c550000         | je                  0x5572
            //   81bdf0fdffffc92bd405     | cmp    dword ptr [ebp - 0x210], 0x5d42bc9
            //   7745                 | ja                  0x47

        $sequence_4 = { 81bdf0fdffffd0a6d005 7735 81bdf0fdffffd0a6d005 0f840f760000 81bdf0fdffffd0a5d005 0f84617d0000 81bdf0fdffffb2a6d005 }
            // n = 7, score = 100
            //   81bdf0fdffffd0a6d005     | cmp    dword ptr [ebp - 0x210], 0x5d0a6d0
            //   7735                 | ja                  0x37
            //   81bdf0fdffffd0a6d005     | cmp    dword ptr [ebp - 0x210], 0x5d0a6d0
            //   0f840f760000         | je                  0x7615
            //   81bdf0fdffffd0a5d005     | cmp    dword ptr [ebp - 0x210], 0x5d0a5d0
            //   0f84617d0000         | je                  0x7d67
            //   81bdf0fdffffb2a6d005     | cmp    dword ptr [ebp - 0x210], 0x5d0a6b2

        $sequence_5 = { 81bdf0fdffff8a000000 0f87755c0000 8b8df0fdffff 0fb691b4cb4000 ff2495a0cb4000 81bdf0fdffffd824d405 7742 }
            // n = 7, score = 100
            //   81bdf0fdffff8a000000     | cmp    dword ptr [ebp - 0x210], 0x8a
            //   0f87755c0000         | ja                  0x5c7b
            //   8b8df0fdffff         | mov                 ecx, dword ptr [ebp - 0x210]
            //   0fb691b4cb4000       | movzx               edx, byte ptr [ecx + 0x40cbb4]
            //   ff2495a0cb4000       | jmp                 dword ptr [edx*4 + 0x40cba0]
            //   81bdf0fdffffd824d405     | cmp    dword ptr [ebp - 0x210], 0x5d424d8
            //   7742                 | ja                  0x44

        $sequence_6 = { c7802ceb410002000000 6a04 58 6bc000 8b0d???????? 894c05f8 6a04 }
            // n = 7, score = 100
            //   c7802ceb410002000000     | mov    dword ptr [eax + 0x41eb2c], 2
            //   6a04                 | push                4
            //   58                   | pop                 eax
            //   6bc000               | imul                eax, eax, 0
            //   8b0d????????         |                     
            //   894c05f8             | mov                 dword ptr [ebp + eax - 8], ecx
            //   6a04                 | push                4

        $sequence_7 = { 81bdf0fdffff53e6d005 0f84f5590000 81bdf0fdffffc1e6d005 0f84fb660000 e9???????? 81bdf0fdffffd4e6d005 0f844a580000 }
            // n = 7, score = 100
            //   81bdf0fdffff53e6d005     | cmp    dword ptr [ebp - 0x210], 0x5d0e653
            //   0f84f5590000         | je                  0x59fb
            //   81bdf0fdffffc1e6d005     | cmp    dword ptr [ebp - 0x210], 0x5d0e6c1
            //   0f84fb660000         | je                  0x6701
            //   e9????????           |                     
            //   81bdf0fdffffd4e6d005     | cmp    dword ptr [ebp - 0x210], 0x5d0e6d4
            //   0f844a580000         | je                  0x5850

        $sequence_8 = { 81bdf0fdffffd9e2d205 0f84b1620000 e9???????? 81bdf0fdffff47e6d205 0f84b4630000 e9???????? }
            // n = 6, score = 100
            //   81bdf0fdffffd9e2d205     | cmp    dword ptr [ebp - 0x210], 0x5d2e2d9
            //   0f84b1620000         | je                  0x62b7
            //   e9????????           |                     
            //   81bdf0fdffff47e6d205     | cmp    dword ptr [ebp - 0x210], 0x5d2e647
            //   0f84b4630000         | je                  0x63ba
            //   e9????????           |                     

        $sequence_9 = { 8985e4fbffff c785e0fbffff00000000 6a00 8d8de0fbffff 51 8b95e4fbffff 52 }
            // n = 7, score = 100
            //   8985e4fbffff         | mov                 dword ptr [ebp - 0x41c], eax
            //   c785e0fbffff00000000     | mov    dword ptr [ebp - 0x420], 0
            //   6a00                 | push                0
            //   8d8de0fbffff         | lea                 ecx, [ebp - 0x420]
            //   51                   | push                ecx
            //   8b95e4fbffff         | mov                 edx, dword ptr [ebp - 0x41c]
            //   52                   | push                edx

    condition:
        7 of them and filesize < 297984
}