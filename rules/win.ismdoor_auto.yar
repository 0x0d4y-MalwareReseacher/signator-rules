rule win_ismdoor_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-06-10"
        version = "1"
        description = "Detects win.ismdoor."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.ismdoor"
        malpedia_rule_date = "20210604"
        malpedia_hash = "be09d5d71e77373c0f538068be31a2ad4c69cfbd"
        malpedia_version = "20210616"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 32c0 eb05 c0e804 2401 84c0 0f94c3 }
            // n = 6, score = 400
            //   32c0                 | xor                 al, al
            //   eb05                 | jmp                 7
            //   c0e804               | shr                 al, 4
            //   2401                 | and                 al, 1
            //   84c0                 | test                al, al
            //   0f94c3               | sete                bl

        $sequence_1 = { c1e008 03c8 8bd9 8bc1 48c1e812 83e03f }
            // n = 6, score = 300
            //   c1e008               | inc                 edx
            //   03c8                 | mov                 eax, dword ptr [edx + eax*4]
            //   8bd9                 | bt                  eax, ecx
            //   8bc1                 | jae                 5
            //   48c1e812             | inc                 ebp
            //   83e03f               | xor                 ecx, ecx

        $sequence_2 = { 83e11f 49c1e805 428b0482 0fa3c8 7303 4533c9 }
            // n = 6, score = 300
            //   83e11f               | mov                 eax, edx
            //   49c1e805             | inc                 ecx
            //   428b0482             | inc                 edx
            //   0fa3c8               | and                 ecx, 0x1f
            //   7303                 | dec                 ecx
            //   4533c9               | shr                 eax, 5

        $sequence_3 = { 4883ec40 488bda 4c8bf1 4885d2 }
            // n = 4, score = 300
            //   4883ec40             | mov                 dword ptr [esp + 0x30], eax
            //   488bda               | dec                 eax
            //   4c8bf1               | mov                 eax, dword ptr [ebx + 8]
            //   4885d2               | dec                 eax

        $sequence_4 = { 3303 89442430 488b4308 4889442438 }
            // n = 4, score = 300
            //   3303                 | shl                 eax, 8
            //   89442430             | add                 ecx, eax
            //   488b4308             | mov                 ebx, ecx
            //   4889442438           | mov                 eax, ecx

        $sequence_5 = { 0fb7fa 488b08 beffff0000 4885c9 }
            // n = 4, score = 300
            //   0fb7fa               | dec                 eax
            //   488b08               | shr                 eax, 0x12
            //   beffff0000           | and                 eax, 0x3f
            //   4885c9               | xor                 eax, dword ptr [ebx]

        $sequence_6 = { 4889442458 488bda 498953e8 498d43b8 }
            // n = 4, score = 300
            //   4889442458           | mov                 dword ptr [esp + 0x38], eax
            //   488bda               | movzx               edi, dx
            //   498953e8             | dec                 eax
            //   498d43b8             | mov                 ecx, dword ptr [eax]

        $sequence_7 = { 7613 498d4970 418bc2 41ffc2 }
            // n = 4, score = 300
            //   7613                 | jbe                 0x15
            //   498d4970             | dec                 ecx
            //   418bc2               | lea                 ecx, dword ptr [ecx + 0x70]
            //   41ffc2               | inc                 ecx

        $sequence_8 = { 8945c4 eb07 c745e8feffff7f 8b4c3238 8b411c }
            // n = 5, score = 100
            //   8945c4               | sete                bl
            //   eb07                 | mov                 dword ptr [ebp - 0x24], 0x476040
            //   c745e8feffff7f       | mov                 dword ptr [ebp - 0x28], edx
            //   8b4c3238             | mov                 dword ptr [ebp - 0x24], 0x476040
            //   8b411c               | jb                  0x10

        $sequence_9 = { 8d8db8fcffff c645fc01 e8???????? c645fc03 }
            // n = 4, score = 100
            //   8d8db8fcffff         | push                dword ptr [ebp - 0x134]
            //   c645fc01             | add                 esp, 4
            //   e8????????           |                     
            //   c645fc03             | mov                 ecx, dword ptr [ebp - 0x3c]

        $sequence_10 = { 8bd8 e8???????? 8bf8 6a01 6800040000 89bdc8fdffff }
            // n = 6, score = 100
            //   8bd8                 | and                 al, 1
            //   e8????????           |                     
            //   8bf8                 | test                al, al
            //   6a01                 | xor                 al, al
            //   6800040000           | jmp                 9
            //   89bdc8fdffff         | shr                 al, 4

        $sequence_11 = { 720e ffb5ccfeffff e8???????? 83c404 8b4dc4 8b4518 }
            // n = 6, score = 100
            //   720e                 | shr                 al, 4
            //   ffb5ccfeffff         | and                 al, 1
            //   e8????????           |                     
            //   83c404               | test                al, al
            //   8b4dc4               | jmp                 7
            //   8b4518               | shr                 al, 4

        $sequence_12 = { c745dc40604700 e9???????? 8955d8 c745dc40604700 }
            // n = 4, score = 100
            //   c745dc40604700       | jne                 9
            //   e9????????           |                     
            //   8955d8               | xor                 al, al
            //   c745dc40604700       | jmp                 9

        $sequence_13 = { 8d45e4 c745e48c034700 50 e8???????? 8d7320 8bce }
            // n = 6, score = 100
            //   8d45e4               | test                al, al
            //   c745e48c034700       | sete                bl
            //   50                   | shr                 al, 4
            //   e8????????           |                     
            //   8d7320               | and                 al, 1
            //   8bce                 | test                al, al

        $sequence_14 = { 8b85f8feffff 8b4004 c78405f8feffffdcb64700 8b85f8feffff 8b4804 }
            // n = 5, score = 100
            //   8b85f8feffff         | and                 al, 1
            //   8b4004               | test                al, al
            //   c78405f8feffffdcb64700     | jmp    7
            //   8b85f8feffff         | shr                 al, 4
            //   8b4804               | and                 al, 1

    condition:
        7 of them and filesize < 1933312
}