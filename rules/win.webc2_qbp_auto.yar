rule win_webc2_qbp_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-08-05"
        version = "1"
        description = "Detects win.webc2_qbp."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.webc2_qbp"
        malpedia_rule_date = "20220805"
        malpedia_hash = "6ec06c64bcfdbeda64eff021c766b4ce34542b71"
        malpedia_version = "20220808"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 668945fc 0fbf4df4 83e101 85c9 740d 668b55fc 6681c20080 }
            // n = 7, score = 100
            //   668945fc             | mov                 word ptr [ebp - 4], ax
            //   0fbf4df4             | movsx               ecx, word ptr [ebp - 0xc]
            //   83e101               | and                 ecx, 1
            //   85c9                 | test                ecx, ecx
            //   740d                 | je                  0xf
            //   668b55fc             | mov                 dx, word ptr [ebp - 4]
            //   6681c20080           | add                 dx, 0x8000

        $sequence_1 = { 038198830000 50 8b5508 52 e8???????? 83c40c }
            // n = 6, score = 100
            //   038198830000         | add                 eax, dword ptr [ecx + 0x8398]
            //   50                   | push                eax
            //   8b5508               | mov                 edx, dword ptr [ebp + 8]
            //   52                   | push                edx
            //   e8????????           |                     
            //   83c40c               | add                 esp, 0xc

        $sequence_2 = { 8b9188830000 833a00 756d 8b450c 6bc003 99 }
            // n = 6, score = 100
            //   8b9188830000         | mov                 edx, dword ptr [ecx + 0x8388]
            //   833a00               | cmp                 dword ptr [edx], 0
            //   756d                 | jne                 0x6f
            //   8b450c               | mov                 eax, dword ptr [ebp + 0xc]
            //   6bc003               | imul                eax, eax, 3
            //   99                   | cdq                 

        $sequence_3 = { 66898c504e720000 0fbf4df8 8b55f4 668b45fc }
            // n = 4, score = 100
            //   66898c504e720000     | mov                 word ptr [eax + edx*2 + 0x724e], cx
            //   0fbf4df8             | movsx               ecx, word ptr [ebp - 8]
            //   8b55f4               | mov                 edx, dword ptr [ebp - 0xc]
            //   668b45fc             | mov                 ax, word ptr [ebp - 4]

        $sequence_4 = { 66c745fc0000 66c745f80000 8b4508 25ffff0000 8b4df0 668b94411c7c0000 668955f4 }
            // n = 7, score = 100
            //   66c745fc0000         | mov                 word ptr [ebp - 4], 0
            //   66c745f80000         | mov                 word ptr [ebp - 8], 0
            //   8b4508               | mov                 eax, dword ptr [ebp + 8]
            //   25ffff0000           | and                 eax, 0xffff
            //   8b4df0               | mov                 ecx, dword ptr [ebp - 0x10]
            //   668b94411c7c0000     | mov                 dx, word ptr [ecx + eax*2 + 0x7c1c]
            //   668955f4             | mov                 word ptr [ebp - 0xc], dx

        $sequence_5 = { 0fbf4df0 8b55ec 668b45f4 6689844a4e720000 0fbf4d08 8b55ec 668b844a907e0000 }
            // n = 7, score = 100
            //   0fbf4df0             | movsx               ecx, word ptr [ebp - 0x10]
            //   8b55ec               | mov                 edx, dword ptr [ebp - 0x14]
            //   668b45f4             | mov                 ax, word ptr [ebp - 0xc]
            //   6689844a4e720000     | mov                 word ptr [edx + ecx*2 + 0x724e], ax
            //   0fbf4d08             | movsx               ecx, word ptr [ebp + 8]
            //   8b55ec               | mov                 edx, dword ptr [ebp - 0x14]
            //   668b844a907e0000     | mov                 ax, word ptr [edx + ecx*2 + 0x7e90]

        $sequence_6 = { e8???????? 8b45e4 0fbf8846100000 0fbf55e8 3bca 7e0e }
            // n = 6, score = 100
            //   e8????????           |                     
            //   8b45e4               | mov                 eax, dword ptr [ebp - 0x1c]
            //   0fbf8846100000       | movsx               ecx, word ptr [eax + 0x1046]
            //   0fbf55e8             | movsx               edx, word ptr [ebp - 0x18]
            //   3bca                 | cmp                 ecx, edx
            //   7e0e                 | jle                 0x10

        $sequence_7 = { eb09 8b55f8 83c201 8955f8 8b45f8 3b450c 732d }
            // n = 7, score = 100
            //   eb09                 | jmp                 0xb
            //   8b55f8               | mov                 edx, dword ptr [ebp - 8]
            //   83c201               | add                 edx, 1
            //   8955f8               | mov                 dword ptr [ebp - 8], edx
            //   8b45f8               | mov                 eax, dword ptr [ebp - 8]
            //   3b450c               | cmp                 eax, dword ptr [ebp + 0xc]
            //   732d                 | jae                 0x2f

        $sequence_8 = { 0fbf55f4 83faff 7468 668b45f8 50 }
            // n = 5, score = 100
            //   0fbf55f4             | movsx               edx, word ptr [ebp - 0xc]
            //   83faff               | cmp                 edx, -1
            //   7468                 | je                  0x6a
            //   668b45f8             | mov                 ax, word ptr [ebp - 8]
            //   50                   | push                eax

        $sequence_9 = { 660bd0 8b45fc 6689907a830000 8b4dfc 8a917c830000 025508 8b45fc }
            // n = 7, score = 100
            //   660bd0               | or                  dx, ax
            //   8b45fc               | mov                 eax, dword ptr [ebp - 4]
            //   6689907a830000       | mov                 word ptr [eax + 0x837a], dx
            //   8b4dfc               | mov                 ecx, dword ptr [ebp - 4]
            //   8a917c830000         | mov                 dl, byte ptr [ecx + 0x837c]
            //   025508               | add                 dl, byte ptr [ebp + 8]
            //   8b45fc               | mov                 eax, dword ptr [ebp - 4]

    condition:
        7 of them and filesize < 630784
}