rule win_tiger_rat_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-11-21"
        version = "1"
        description = "Detects win.tiger_rat."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.tiger_rat"
        malpedia_rule_date = "20221118"
        malpedia_hash = "e0702e2e6d1d00da65c8a29a4ebacd0a4c59e1af"
        malpedia_version = "20221125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 2bdf 448bcb 41b820000000 48897c2420 }
            // n = 4, score = 200
            //   2bdf                 | je                  0x51
            //   448bcb               | je                  0x47
            //   41b820000000         | je                  0x51
            //   48897c2420           | je                  0x49

        $sequence_1 = { 48833d????????00 7459 48833d????????00 744f }
            // n = 4, score = 200
            //   48833d????????00     |                     
            //   7459                 | dec                 eax
            //   48833d????????00     |                     
            //   744f                 | lea                 ecx, [esp + 0x30]

        $sequence_2 = { 48833d????????00 744e 48833d????????00 7444 }
            // n = 4, score = 200
            //   48833d????????00     |                     
            //   744e                 | sub                 esp, 0x90
            //   48833d????????00     |                     
            //   7444                 | inc                 ebp

        $sequence_3 = { 2bd9 488d4c2430 ff15???????? 85db }
            // n = 4, score = 200
            //   2bd9                 | je                  0x43
            //   488d4c2430           | je                  0x37
            //   ff15????????         |                     
            //   85db                 | je                  0x4b

        $sequence_4 = { 48833d????????00 7445 48833d????????00 743b 48833d????????00 }
            // n = 5, score = 200
            //   48833d????????00     |                     
            //   7445                 | inc                 ebx
            //   48833d????????00     |                     
            //   743b                 | dec                 eax
            //   48833d????????00     |                     

        $sequence_5 = { 48833d????????00 7449 48833d????????00 743f }
            // n = 4, score = 200
            //   48833d????????00     |                     
            //   7449                 | lea                 ebp, [0x181a1]
            //   48833d????????00     |                     
            //   743f                 | inc                 ecx

        $sequence_6 = { 2bdf eb05 bb00000100 488b4930 }
            // n = 4, score = 200
            //   2bdf                 | inc                 ecx
            //   eb05                 | mov                 eax, 0x20
            //   bb00000100           | dec                 eax
            //   488b4930             | mov                 dword ptr [esp + 0x20], edi

        $sequence_7 = { 2bdf 448d4020 448bcb 48897c2420 }
            // n = 4, score = 200
            //   2bdf                 | inc                 esp
            //   448d4020             | mov                 ecx, ebx
            //   448bcb               | inc                 ecx
            //   48897c2420           | mov                 eax, 0x20

        $sequence_8 = { 8b05???????? 41b800800000 498bd6 0b05???????? 488bcd 8905???????? ff15???????? }
            // n = 7, score = 100
            //   8b05????????         |                     
            //   41b800800000         | dec                 ecx
            //   498bd6               | mov                 eax, dword ptr [esi + edi*8]
            //   0b05????????         |                     
            //   488bcd               | push                edi
            //   8905????????         |                     
            //   ff15????????         |                     

        $sequence_9 = { 488d6c24a9 4881ec90000000 8b05???????? 4533f6 bac8000000 }
            // n = 5, score = 100
            //   488d6c24a9           | mov                 ecx, 0x18
            //   4881ec90000000       | dec                 eax
            //   8b05????????         |                     
            //   4533f6               | mov                 dword ptr [edi], eax
            //   bac8000000           | inc                 ebp

        $sequence_10 = { 8905???????? 488bcd ff15???????? bac8000000 41b918000000 488907 8b05???????? }
            // n = 7, score = 100
            //   8905????????         |                     
            //   488bcd               | dec                 eax
            //   ff15????????         |                     
            //   bac8000000           | sub                 esp, 0x20
            //   41b918000000         | cmp                 byte ptr [ecx + 0x10], 0
            //   488907               | dec                 eax
            //   8b05????????         |                     

        $sequence_11 = { 4863c1 4c8d35aa1d0100 488bf8 83e01f 48c1ff05 486bd858 498b04fe }
            // n = 7, score = 100
            //   4863c1               | jmp                 0xe
            //   4c8d35aa1d0100       | dec                 eax
            //   488bf8               | arpl                cx, ax
            //   83e01f               | dec                 esp
            //   48c1ff05             | lea                 esi, [0x11daa]
            //   486bd858             | dec                 eax
            //   498b04fe             | mov                 edi, eax

        $sequence_12 = { ffc5 88843cc7000000 48ffc3 4883ff04 0f85de000000 }
            // n = 5, score = 100
            //   ffc5                 | lea                 eax, [0x18a5b]
            //   88843cc7000000       | mov                 edi, edx
            //   48ffc3               | inc                 ecx
            //   4883ff04             | mov                 eax, 0x8000
            //   0f85de000000         | dec                 ecx

        $sequence_13 = { 0f8404010000 81fffc000000 0f8463010000 488d2da1810100 41bf14030000 4c8d0524ca0000 488bcd }
            // n = 7, score = 100
            //   0f8404010000         | mov                 edx, esi
            //   81fffc000000         | dec                 eax
            //   0f8463010000         | mov                 ecx, ebp
            //   488d2da1810100       | dec                 eax
            //   41bf14030000         | mov                 ecx, ebp
            //   4c8d0524ca0000       | mov                 edx, 0xc8
            //   488bcd               | inc                 ecx

        $sequence_14 = { 57 4883ec20 80791000 488d055b8a0100 8bfa }
            // n = 5, score = 100
            //   57                   | and                 eax, 0x1f
            //   4883ec20             | dec                 eax
            //   80791000             | sar                 edi, 5
            //   488d055b8a0100       | dec                 eax
            //   8bfa                 | imul                ebx, eax, 0x58

        $sequence_15 = { 4983c614 e9???????? b801000000 eb0c c705????????06000000 }
            // n = 5, score = 100
            //   4983c614             | dec                 ecx
            //   e9????????           |                     
            //   b801000000           | add                 esi, 0x14
            //   eb0c                 | mov                 eax, 1
            //   c705????????06000000     |     

    condition:
        7 of them and filesize < 557056
}