rule win_graphical_neutrino_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.graphical_neutrino."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.graphical_neutrino"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 4889da e8???????? 488b442458 b950000000 4d8b742408 488b00 488b6808 }
            // n = 7, score = 500
            //   4889da               | mov                 eax, esi
            //   e8????????           |                     
            //   488b442458           | dec                 eax
            //   b950000000           | lea                 edx, [0x10578]
            //   4d8b742408           | dec                 esp
            //   488b00               | mov                 ecx, edi
            //   488b6808             | dec                 esp

        $sequence_1 = { e8???????? 85c0 7435 c605????????01 31c0 488b7c2438 8a1407 }
            // n = 7, score = 500
            //   e8????????           |                     
            //   85c0                 | dec                 eax
            //   7435                 | mov                 edx, dword ptr [eax - 8]
            //   c605????????01       |                     
            //   31c0                 | mov                 al, byte ptr [edx]
            //   488b7c2438           | cmp                 al, 2
            //   8a1407               | jne                 0xb60

        $sequence_2 = { 53 4883ec28 31c0 803901 4889d5 7552 }
            // n = 6, score = 500
            //   53                   | je                  0x109f
            //   4883ec28             | dec                 eax
            //   31c0                 | lea                 edx, [0x3bfb1]
            //   803901               | xor                 ecx, ecx
            //   4889d5               | inc                 esp
            //   7552                 | cmp                 ecx, edx

        $sequence_3 = { eb07 b001 80fa09 7478 }
            // n = 4, score = 500
            //   eb07                 | dec                 eax
            //   b001                 | lea                 ecx, [0x3ed27]
            //   80fa09               | je                  0x10dd
            //   7478                 | dec                 eax

        $sequence_4 = { 4889c1 e8???????? 48897308 4889d9 ba01000000 }
            // n = 5, score = 500
            //   4889c1               | mov                 word ptr [esp + 0x17c], 0xac1b
            //   e8????????           |                     
            //   48897308             | test                al, al
            //   4889d9               | mov                 dword ptr [esp + 0x180], 0xafaebd58
            //   ba01000000           | mov                 byte ptr [esp + 0x184], 0xcf

        $sequence_5 = { e8???????? 84c0 4c0f45e6 4c89e0 4883c428 5b 5e }
            // n = 7, score = 500
            //   e8????????           |                     
            //   84c0                 | dec                 eax
            //   4c0f45e6             | mov                 edx, esi
            //   4c89e0               | mov                 dword ptr [esp + 0x590], 0x3339b3f7
            //   4883c428             | mov                 byte ptr [esp + 0x594], 0x25
            //   5b                   | dec                 eax
            //   5e                   | mov                 ecx, edi

        $sequence_6 = { 7402 8a02 888424c1000000 b980000000 31c0 488dbc24c2000000 }
            // n = 6, score = 500
            //   7402                 | jne                 0x1242
            //   8a02                 | dec                 esp
            //   888424c1000000       | mov                 ecx, edi
            //   b980000000           | dec                 eax
            //   31c0                 | add                 eax, edx
            //   488dbc24c2000000     | jmp                 eax

        $sequence_7 = { 4c89e9 488d7c2430 e8???????? 488b442450 4989442408 4839de 0f84bc000000 }
            // n = 7, score = 500
            //   4c89e9               | dec                 eax
            //   488d7c2430           | lea                 edx, [esp + 0xf8]
            //   e8????????           |                     
            //   488b442450           | dec                 esp
            //   4989442408           | mov                 ecx, ebp
            //   4839de               | dec                 eax
            //   0f84bc000000         | mov                 dword ptr [esp + 0xf8], eax

        $sequence_8 = { 7413 80fa02 742c 31c0 84d2 }
            // n = 5, score = 500
            //   7413                 | jae                 0x1991
            //   80fa02               | inc                 ecx
            //   742c                 | mov                 eax, 0x3c1b
            //   31c0                 | dec                 eax
            //   84d2                 | lea                 edx, [0xd807]

        $sequence_9 = { 48637c2428 8d743d00 39f7 7f2b 83fe0f }
            // n = 5, score = 500
            //   48637c2428           | dec                 eax
            //   8d743d00             | lea                 ecx, [0x3c11a]
            //   39f7                 | test                al, al
            //   7f2b                 | jne                 0x162a
            //   83fe0f               | dec                 eax

    condition:
        7 of them and filesize < 674816
}