rule win_pocodown_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-11-21"
        version = "1"
        description = "Detects win.pocodown."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.pocodown"
        malpedia_rule_date = "20221118"
        malpedia_hash = "e0702e2e6d1d00da65c8a29a4ebacd0a4c59e1af"
        malpedia_version = "20221125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { ffe0 488b442450 8b8028010000 e9???????? 488b442450 8b8028010000 89442420 }
            // n = 7, score = 200
            //   ffe0                 | mov                 ecx, dword ptr [esp + 0xb8]
            //   488b442450           | dec                 eax
            //   8b8028010000         | mov                 dword ptr [esp + 0x40], eax
            //   e9????????           |                     
            //   488b442450           | dec                 eax
            //   8b8028010000         | mov                 ecx, dword ptr [esp + 0xb8]
            //   89442420             | mov                 dword ptr [esp + 0x30], 1

        $sequence_1 = { c60000 4885ed 0f95c0 84c0 742e 488b4e10 48837e1810 }
            // n = 7, score = 200
            //   c60000               | dec                 eax
            //   4885ed               | cmp                 dword ptr [esp + 0x60], 0
            //   0f95c0               | je                  0x153
            //   84c0                 | dec                 eax
            //   742e                 | arpl                word ptr [esp + 0x34], ax
            //   488b4e10             | mov                 ecx, 0x14
            //   48837e1810           | xor                 eax, eax

        $sequence_2 = { ebc9 488b442450 4883e808 4889442450 8b442440 83c003 4898 }
            // n = 7, score = 200
            //   ebc9                 | mov                 ecx, dword ptr [esp + 0x50]
            //   488b442450           | test                eax, eax
            //   4883e808             | jg                  0x468
            //   4889442450           | dec                 eax
            //   8b442440             | mov                 eax, dword ptr [esp + 0x30]
            //   83c003               | dec                 eax
            //   4898                 | arpl                word ptr [eax + 0x29c], ax

        $sequence_3 = { f0ff01 488b0b 488b4308 48894c2450 4889442458 f0ff01 488d542430 }
            // n = 7, score = 200
            //   f0ff01               | inc                 ebp
            //   488b0b               | xor                 eax, eax
            //   488b4308             | mov                 byte ptr [esp + 0x300], al
            //   48894c2450           | mov                 dword ptr [esp + 0x2f8], 0
            //   4889442458           | jmp                 0x14c8
            //   f0ff01               | mov                 eax, dword ptr [esp + 0x2f8]
            //   488d542430           | inc                 eax

        $sequence_4 = { e8???????? 8b4010 89842488000000 83bc248800000000 750a c744245001000000 eb08 }
            // n = 7, score = 200
            //   e8????????           |                     
            //   8b4010               | mov                 dword ptr [esp + 0x20], eax
            //   89842488000000       | dec                 eax
            //   83bc248800000000     | sub                 esp, eax
            //   750a                 | inc                 ecx
            //   c744245001000000     | mov                 eax, 0x50
            //   eb08                 | dec                 eax

        $sequence_5 = { e8???????? 85c0 7502 eb39 488b4c2450 e8???????? eb26 }
            // n = 7, score = 200
            //   e8????????           |                     
            //   85c0                 | mov                 dword ptr [ebp - 0x39], edi
            //   7502                 | mov                 byte ptr [ebp - 0x49], 0
            //   eb39                 | inc                 ecx
            //   488b4c2450           | mov                 eax, 0x29
            //   e8????????           |                     
            //   eb26                 | dec                 eax

        $sequence_6 = { c744242401000000 488b442440 488b00 488b542448 488b4c2440 ff5020 89442420 }
            // n = 7, score = 200
            //   c744242401000000     | mov                 edx, 0x7f
            //   488b442440           | mov                 ecx, 0x71
            //   488b00               | xor                 eax, eax
            //   488b542448           | inc                 ecx
            //   488b4c2440           | mov                 eax, 0x43d
            //   ff5020               | dec                 eax
            //   89442420             | lea                 edx, [0x1d3645]

        $sequence_7 = { ffe1 4c8b742460 498911 33c0 4883c420 415d 415c }
            // n = 7, score = 200
            //   ffe1                 | mov                 dword ptr [esp + 0x6c], 1
            //   4c8b742460           | cmp                 dword ptr [esp + 0x6c], 0
            //   498911               | je                  0x3ea
            //   33c0                 | dec                 eax
            //   4883c420             | cmp                 dword ptr [esp + 0x58], 0
            //   415d                 | je                  0x3e1
            //   415c                 | dec                 eax

        $sequence_8 = { f2ae 48f7d1 488d79ff 488d4dd8 4983ff10 480f434dd8 4c8bc7 }
            // n = 7, score = 200
            //   f2ae                 | mov                 eax, dword ptr [esp + 0x70]
            //   48f7d1               | dec                 eax
            //   488d79ff             | mov                 ecx, dword ptr [eax + 0x38]
            //   488d4dd8             | mov                 dword ptr [esp + 0x30], eax
            //   4983ff10             | cmp                 dword ptr [esp + 0x30], 0
            //   480f434dd8           | je                  0xa50
            //   4c8bc7               | dec                 esp

        $sequence_9 = { e8???????? 482be0 488b442440 488b00 488b4c2448 488b09 8b09 }
            // n = 7, score = 200
            //   e8????????           |                     
            //   482be0               | dec                 eax
            //   488b442440           | mov                 eax, dword ptr [esp + 0x20]
            //   488b00               | dec                 eax
            //   488b4c2448           | mov                 dword ptr [eax + 8], 0
            //   488b09               | mov                 dword ptr [eax + 0x38], 1
            //   8b09                 | dec                 eax

    condition:
        7 of them and filesize < 6703104
}