rule win_industrial_spy_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-11-21"
        version = "1"
        description = "Detects win.industrial_spy."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.industrial_spy"
        malpedia_rule_date = "20221118"
        malpedia_hash = "e0702e2e6d1d00da65c8a29a4ebacd0a4c59e1af"
        malpedia_version = "20221125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 48893a 488b01 f30f7f442430 488b742438 4c8b742430 48897c2440 4885c0 }
            // n = 7, score = 100
            //   48893a               | inc                 esp
            //   488b01               | mov                 dword ptr [ebx + 4], edx
            //   f30f7f442430         | jae                 0xbae
            //   488b742438           | inc                 ecx
            //   4c8b742430           | mov                 ecx, dword ptr [eax]
            //   48897c2440           | jmp                 0xbbb
            //   4885c0               | inc                 ecx

        $sequence_1 = { ff15???????? 488935???????? c705????????02000000 e9???????? }
            // n = 4, score = 100
            //   ff15????????         |                     
            //   488935????????       |                     
            //   c705????????02000000     |     
            //   e9????????           |                     

        $sequence_2 = { 4903d2 41c1e608 0fb602 440bf0 420fb60412 41c1e608 440bf0 }
            // n = 7, score = 100
            //   4903d2               | mov                 eax, esi
            //   41c1e608             | inc                 ebp
            //   0fb602               | test                ebp, ebp
            //   440bf0               | je                  0x1ad
            //   420fb60412           | xor                 eax, dword ptr [ebx + 0x88]
            //   41c1e608             | xor                 eax, dword ptr [ebx + 0x80]
            //   440bf0               | mov                 dword ptr [ebp + 0x40], eax

        $sequence_3 = { 443bff 0f82a6feffff 488b5c2478 4883c430 415f 415e }
            // n = 6, score = 100
            //   443bff               | xor                 eax, eax
            //   0f82a6feffff         | dec                 eax
            //   488b5c2478           | mov                 ebx, dword ptr [esp + 0x50]
            //   4883c430             | dec                 ecx
            //   415f                 | mov                 dword ptr [eax + edx*8], eax
            //   415e                 | inc                 edx

        $sequence_4 = { 4183e13f 83e03f 0b948590ff0100 420b9485b0f90100 }
            // n = 4, score = 100
            //   4183e13f             | test                ebx, ebx
            //   83e03f               | je                  0xae
            //   0b948590ff0100       | cmp                 edx, esi
            //   420b9485b0f90100     | seta                cl

        $sequence_5 = { 442bc9 f7d1 443bc9 418bc0 0f46d6 c1e010 }
            // n = 6, score = 100
            //   442bc9               | test                edx, edx
            //   f7d1                 | dec                 ecx
            //   443bc9               | add                 eax, 4
            //   418bc0               | dec                 ecx
            //   0f46d6               | sub                 ecx, 1
            //   c1e010               | jne                 0x138

        $sequence_6 = { 0fb68c2490000000 4c8d0531b90000 4803da 4883f101 4803d9 482bfb 488bcb }
            // n = 7, score = 100
            //   0fb68c2490000000     | not                 edx
            //   4c8d0531b90000       | inc                 ecx
            //   4803da               | add                 eax, ebp
            //   4883f101             | inc                 ebp
            //   4803d9               | add                 edx, ecx
            //   482bfb               | inc                 ecx
            //   488bcb               | xor                 eax, edx

        $sequence_7 = { 8bc2 c1e818 4503fa 8801 4903ca 8bc2 }
            // n = 6, score = 100
            //   8bc2                 | inc                 ecx
            //   c1e818               | add                 ecx, ecx
            //   4503fa               | or                  eax, ecx
            //   8801                 | inc                 ecx
            //   4903ca               | xor                 eax, ecx
            //   8bc2                 | add                 eax, dword ptr [ebp - 0x20]

        $sequence_8 = { 8a0c10 43848c4b40fd0100 0f95c0 42880414 49ffc2 4983fa38 7cd1 }
            // n = 7, score = 100
            //   8a0c10               | movzx               eax, byte ptr [edx]
            //   43848c4b40fd0100     | movzx               eax, byte ptr [edx]
            //   0f95c0               | dec                 ecx
            //   42880414             | add                 edx, edx
            //   49ffc2               | or                  esi, eax
            //   4983fa38             | shl                 esi, 8
            //   7cd1                 | movzx               ecx, byte ptr [edx]

        $sequence_9 = { 488d3dc1640100 488b0c3b 4885c9 740a e8???????? 4883243b00 4883c308 }
            // n = 7, score = 100
            //   488d3dc1640100       | dec                 eax
            //   488b0c3b             | mov                 ecx, edi
            //   4885c9               | test                edi, edi
            //   740a                 | je                  0x1029
            //   e8????????           |                     
            //   4883243b00           | inc                 esp
            //   4883c308             | mov                 ebp, dword ptr [ebx + 0x90]

    condition:
        7 of them and filesize < 339968
}