rule win_microcin_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-11-21"
        version = "1"
        description = "Detects win.microcin."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.microcin"
        malpedia_rule_date = "20221118"
        malpedia_hash = "e0702e2e6d1d00da65c8a29a4ebacd0a4c59e1af"
        malpedia_version = "20221125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8d45ac 50 6801000080 ff15???????? 85c0 }
            // n = 5, score = 400
            //   8d45ac               | inc                 ecx
            //   50                   | push                esi
            //   6801000080           | inc                 ecx
            //   ff15????????         |                     
            //   85c0                 | push                edi

        $sequence_1 = { ff15???????? 4863c8 c6840d8002000076 488d8d80020000 ff15???????? }
            // n = 5, score = 400
            //   ff15????????         |                     
            //   4863c8               | mov                 ecx, ebx
            //   c6840d8002000076     | dec                 esp
            //   488d8d80020000       | lea                 eax, [0x112b7]
            //   ff15????????         |                     

        $sequence_2 = { 6804010000 50 ff15???????? 8d85f8feffff }
            // n = 4, score = 400
            //   6804010000           | lea                 eax, [ebp - 0xb18]
            //   50                   | push                eax
            //   ff15????????         |                     
            //   8d85f8feffff         | mov                 dword ptr [ebp - 0xb1c], 0

        $sequence_3 = { ff15???????? 4863c8 c6440c605c 488d542444 }
            // n = 4, score = 400
            //   ff15????????         |                     
            //   4863c8               | mov                 eax, eax
            //   c6440c605c           | xor                 edx, edx
            //   488d542444           | div                 ecx

        $sequence_4 = { 50 6805100000 68ffff0000 56 8b35???????? }
            // n = 5, score = 400
            //   50                   | add                 esp, 0xc
            //   6805100000           | push                0
            //   68ffff0000           | push                0x1c
            //   56                   | dec                 eax
            //   8b35????????         |                     

        $sequence_5 = { ff15???????? 8b1d???????? 8d85a8feffff 50 ffd3 }
            // n = 5, score = 400
            //   ff15????????         |                     
            //   8b1d????????         |                     
            //   8d85a8feffff         | dec                 eax
            //   50                   | lea                 edx, [esp + 0x44]
            //   ffd3                 | mov                 byte ptr [ebp + ecx + 0x280], 0x34

        $sequence_6 = { 57 4156 4157 4883ec60 488be9 }
            // n = 5, score = 400
            //   57                   | jbe                 0x49
            //   4156                 | dec                 ecx
            //   4157                 | mov                 ecx, ebp
            //   4883ec60             | dec                 esp
            //   488be9               | lea                 eax, [0x112b7]

        $sequence_7 = { c6840d8002000034 488d8d80020000 ff15???????? 4863c8 }
            // n = 4, score = 400
            //   c6840d8002000034     | lea                 ecx, [esp + 0x20]
            //   488d8d80020000       | dec                 ecx
            //   ff15????????         |                     
            //   4863c8               | mov                 ebp, eax

        $sequence_8 = { c744244831305244 c744244c75366d66 e9???????? b964000000 ff15???????? }
            // n = 5, score = 400
            //   c744244831305244     | inc                 ecx
            //   c744244c75366d66     | mov                 ecx, 3
            //   e9????????           |                     
            //   b964000000           | dec                 eax
            //   ff15????????         |                     

        $sequence_9 = { ff75d4 e8???????? 83c40c 8bc7 }
            // n = 4, score = 400
            //   ff75d4               | mov                 eax, 0xfffffff5
            //   e8????????           |                     
            //   83c40c               | jmp                 0x1a
            //   8bc7                 | mov                 eax, 0xfffffffc

        $sequence_10 = { b8fcffffff eb0c b8fdffffff eb05 }
            // n = 4, score = 400
            //   b8fcffffff           | dec                 eax
            //   eb0c                 | lea                 edx, [0x10c73]
            //   b8fdffffff           | dec                 eax
            //   eb05                 | mov                 ecx, eax

        $sequence_11 = { eb1a b8f5ffffff eb13 b8fcffffff }
            // n = 4, score = 400
            //   eb1a                 | lea                 ecx, [ebp + eax*2 - 0x44]
            //   b8f5ffffff           | dec                 eax
            //   eb13                 | mov                 eax, ecx
            //   b8fcffffff           | dec                 ecx

        $sequence_12 = { 33f6 50 ffd3 85c0 7e18 }
            // n = 5, score = 400
            //   33f6                 | or                  al, 0xd
            //   50                   | adc                 eax, 0xe151515
            //   ffd3                 | adc                 eax, 0x15151515
            //   85c0                 | push                eax
            //   7e18                 | push                esi

        $sequence_13 = { 7e18 80bc35a8feffff3a 741f 8d85a8feffff }
            // n = 4, score = 400
            //   7e18                 | dec                 eax
            //   80bc35a8feffff3a     | arpl                ax, cx
            //   741f                 | mov                 byte ptr [ebp + ecx + 0x280], 0x34
            //   8d85a8feffff         | dec                 eax

        $sequence_14 = { 488b05???????? 4833c4 488985f0040000 4c8b3d???????? 4533c0 }
            // n = 5, score = 400
            //   488b05????????       |                     
            //   4833c4               | dec                 eax
            //   488985f0040000       | test                eax, eax
            //   4c8b3d????????       |                     
            //   4533c0               | je                  0xc

        $sequence_15 = { ff15???????? 85c0 7426 8b400c }
            // n = 4, score = 400
            //   ff15????????         |                     
            //   85c0                 | lea                 ecx, [ebp + 0x280]
            //   7426                 | dec                 eax
            //   8b400c               | lea                 ecx, [ebp + 0x280]

        $sequence_16 = { 8b45fc 83c008 50 ff15???????? 8b4dfc c7412800000000 }
            // n = 6, score = 200
            //   8b45fc               | jbe                 0x6b
            //   83c008               | jb                  0x73
            //   50                   | outsb               dx, byte ptr [esi]
            //   ff15????????         |                     
            //   8b4dfc               | insd                dword ptr es:[edi], dx
            //   c7412800000000       | outsb               dx, byte ptr gs:[esi]

        $sequence_17 = { 4c8d05b7120100 41b903000000 488d4c45bc 488bc1 492bc5 }
            // n = 5, score = 200
            //   4c8d05b7120100       | test                eax, eax
            //   41b903000000         | je                  0x13
            //   488d4c45bc           | mov                 ecx, ebx
            //   488bc1               | dec                 eax
            //   492bc5               | mov                 ecx, ebp

        $sequence_18 = { eb02 ebb9 817dfce8030000 7c04 33c0 eb42 8b4df0 }
            // n = 7, score = 200
            //   eb02                 | push                0x652e7473
            //   ebb9                 | js                  0x6e
            //   817dfce8030000       | outsb               dx, byte ptr [esi]
            //   7c04                 | insd                dword ptr es:[edi], dx
            //   33c0                 | outsb               dx, byte ptr gs:[esi]
            //   eb42                 | je                  5
            //   8b4df0               | jbe                 0x6b

        $sequence_19 = { 6828010000 8d85ccfeffff 6a00 50 }
            // n = 4, score = 200
            //   6828010000           | mov                 ecx, 3
            //   8d85ccfeffff         | dec                 eax
            //   6a00                 | lea                 ecx, [ebp + eax*2 - 0x44]
            //   50                   | dec                 eax

        $sequence_20 = { 49 53 53 56 }
            // n = 4, score = 200
            //   49                   | mov                 eax, ecx
            //   53                   | dec                 eax
            //   53                   | lea                 edx, [0x111f8]
            //   56                   | inc                 ecx

        $sequence_21 = { 55 8bec 8b4508 56 8d34c5c0304100 833e00 }
            // n = 6, score = 200
            //   55                   | cli                 
            //   8bec                 | cli                 
            //   8b4508               | cli                 
            //   56                   | cli                 
            //   8d34c5c0304100       | arpl                word ptr [ebx + 0x73], sp
            //   833e00               | jbe                 0x75

        $sequence_22 = { 488bcd e8???????? 85c0 751a 488d15f8110100 41b810200100 }
            // n = 6, score = 200
            //   488bcd               | dec                 eax
            //   e8????????           |                     
            //   85c0                 | mov                 ecx, eax
            //   751a                 | dec                 eax
            //   488d15f8110100       | test                eax, eax
            //   41b810200100         | je                  0x13

        $sequence_23 = { 488d15f8110100 41b810200100 488bcd e8???????? e9???????? 4533c9 }
            // n = 6, score = 200
            //   488d15f8110100       | dec                 esp
            //   41b810200100         | lea                 eax, [0x11302]
            //   488bcd               | mov                 edx, edi
            //   e8????????           |                     
            //   e9????????           |                     
            //   4533c9               | xor                 ecx, ecx

        $sequence_24 = { 8b4df8 e8???????? 8b55f8 8b4228 50 8b4df8 8b11 }
            // n = 7, score = 200
            //   8b4df8               | je                  8
            //   e8????????           |                     
            //   8b55f8               | cli                 
            //   8b4228               | cli                 
            //   50                   | cli                 
            //   8b4df8               | cli                 
            //   8b11                 | outsb               dx, byte ptr [esi]

        $sequence_25 = { 7370 696465726167656e 742e 657865 }
            // n = 4, score = 200
            //   7370                 | jbe                 0x49
            //   696465726167656e     | dec                 ecx
            //   742e                 | mov                 ecx, ebp
            //   657865               | dec                 esp

        $sequence_26 = { ff15???????? 418d7c24e7 85c0 752a 4c8d0502130100 8bd7 }
            // n = 6, score = 200
            //   ff15????????         |                     
            //   418d7c24e7           | mov                 eax, 0x12010
            //   85c0                 | dec                 eax
            //   752a                 | inc                 eax
            //   4c8d0502130100       | dec                 eax
            //   8bd7                 | cmp                 eax, 0x3c

        $sequence_27 = { 8b00 85c0 7402 ffd0 8345e404 ebe6 c745e0f8604000 }
            // n = 7, score = 200
            //   8b00                 | inc                 ecx
            //   85c0                 | mov                 edx, esp
            //   7402                 | xor                 ecx, ecx
            //   ffd0                 | dec                 ecx
            //   8345e404             | push                ebx
            //   ebe6                 | push                ebx
            //   c745e0f8604000       | push                esi

        $sequence_28 = { 48ffc0 4883f83c 7647 498bcd e8???????? 4c8d05b7120100 41b903000000 }
            // n = 7, score = 200
            //   48ffc0               | je                  0x1b
            //   4883f83c             | dec                 eax
            //   7647                 | lea                 edx, [0x10c73]
            //   498bcd               | dec                 eax
            //   e8????????           |                     
            //   4c8d05b7120100       | mov                 ecx, eax
            //   41b903000000         | dec                 eax

        $sequence_29 = { 6e 6d 656e 7400 }
            // n = 4, score = 200
            //   6e                   | dec                 eax
            //   6d                   | lea                 ecx, [0x10c95]
            //   656e                 | dec                 eax
            //   7400                 | test                eax, eax

        $sequence_30 = { 894820 8b55f8 83c208 52 ff15???????? c745c800000000 8d4dcc }
            // n = 7, score = 200
            //   894820               | push                ebx
            //   8b55f8               | push                ebx
            //   83c208               | push                esi
            //   52                   | inc                 ebx
            //   ff15????????         |                     
            //   c745c800000000       | cli                 
            //   8d4dcc               | cli                 

        $sequence_31 = { 4c8d0535120100 33c0 498bd0 3b0a }
            // n = 4, score = 200
            //   4c8d0535120100       | lea                 edx, [0x10c73]
            //   33c0                 | dec                 esp
            //   498bd0               | lea                 eax, [0x112b7]
            //   3b0a                 | inc                 ecx

        $sequence_32 = { fa fa fa fa fa fa }
            // n = 6, score = 200
            //   fa                   | xor                 ecx, ecx
            //   fa                   | inc                 ecx
            //   fa                   | lea                 edi, [esp - 0x19]
            //   fa                   | test                eax, eax
            //   fa                   | jne                 0x2e
            //   fa                   | dec                 esp

        $sequence_33 = { 83c40c e9???????? e9???????? e9???????? 5f 5e }
            // n = 6, score = 200
            //   83c40c               | je                  0xa
            //   e9????????           |                     
            //   e9????????           |                     
            //   e9????????           |                     
            //   5f                   | dec                 ecx
            //   5e                   | push                ebx

        $sequence_34 = { 039485f8feffff 8b8d7cffffff 89948d78feffff 8b957cffffff }
            // n = 4, score = 200
            //   039485f8feffff       | jb                  0x71
            //   8b8d7cffffff         | outsb               dx, byte ptr [esi]
            //   89948d78feffff       | insd                dword ptr es:[edi], dx
            //   8b957cffffff         | outsb               dx, byte ptr gs:[esi]

        $sequence_35 = { ff15???????? 4885c0 7419 488d15730c0100 488bc8 ff15???????? 4885c0 }
            // n = 7, score = 200
            //   ff15????????         |                     
            //   4885c0               | dec                 eax
            //   7419                 | test                eax, eax
            //   488d15730c0100       | je                  0x1b
            //   488bc8               | dec                 eax
            //   ff15????????         |                     
            //   4885c0               | lea                 edx, [0x10c73]

        $sequence_36 = { 33c9 4889742420 e8???????? cc 4c8d056c120100 498bd4 488bcd }
            // n = 7, score = 200
            //   33c9                 | jbe                 0x4d
            //   4889742420           | dec                 ecx
            //   e8????????           |                     
            //   cc                   | mov                 ecx, ebp
            //   4c8d056c120100       | dec                 esp
            //   498bd4               | lea                 eax, [0x112b7]
            //   488bcd               | inc                 ecx

        $sequence_37 = { 636373 7673 6873742e65 7865 }
            // n = 4, score = 200
            //   636373               | lea                 eax, [0x11302]
            //   7673                 | mov                 edx, edi
            //   6873742e65           | dec                 ecx
            //   7865                 | mov                 ecx, ebp

        $sequence_38 = { 8d8424b8020000 48 894118 48 8d6970 48 896920 }
            // n = 7, score = 100
            //   8d8424b8020000       | cmp                 dword ptr [ebp - 4], 0x3e8
            //   48                   | jl                  0xd
            //   894118               | xor                 eax, eax
            //   48                   | jmp                 0x4f
            //   8d6970               | mov                 ecx, dword ptr [ebp - 0x10]
            //   48                   | add                 edx, dword ptr [ebp + eax*4 - 0x108]
            //   896920               | mov                 ecx, dword ptr [ebp - 0x84]

        $sequence_39 = { f7f1 85d2 7411 44 89c0 33d2 f7f1 }
            // n = 7, score = 100
            //   f7f1                 | mov                 dword ptr [ebp + ecx*4 - 0x188], edx
            //   85d2                 | mov                 edx, dword ptr [ebp - 0x84]
            //   7411                 | mov                 ecx, dword ptr [ebp - 8]
            //   44                   | mov                 edx, dword ptr [ebp - 8]
            //   89c0                 | mov                 eax, dword ptr [edx + 0x28]
            //   33d2                 | push                eax
            //   f7f1                 | mov                 ecx, dword ptr [ebp - 8]

        $sequence_40 = { 50 c744241030000000 c744241403000000 c7442418d0114000 c744241c00000000 c744242000000000 89742424 }
            // n = 7, score = 100
            //   50                   | cli                 
            //   c744241030000000     | cli                 
            //   c744241403000000     | cli                 
            //   c7442418d0114000     | cli                 
            //   c744241c00000000     | jae                 0x72
            //   c744242000000000     | imul                esp, dword ptr [ebp + 0x72], 0x6e656761
            //   89742424             | je                  0x38

        $sequence_41 = { 5b 894508 3bc3 7e50 83fb05 7445 83fb0e }
            // n = 7, score = 100
            //   5b                   | mov                 eax, ecx
            //   894508               | dec                 eax
            //   3bc3                 | mov                 dword ptr [esp + 0x20], esi
            //   7e50                 | int3                
            //   83fb05               | dec                 esp
            //   7445                 | lea                 eax, [0x1126c]
            //   83fb0e               | dec                 ecx

        $sequence_42 = { 8d95f0feffff 8bce e8???????? 83c404 8d85e8f4ffff }
            // n = 5, score = 100
            //   8d95f0feffff         | dec                 ecx
            //   8bce                 | push                ebx
            //   e8????????           |                     
            //   83c404               | push                ebx
            //   8d85e8f4ffff         | push                esi

        $sequence_43 = { 50 56 8d85e8f4ffff 50 ff35???????? c785e4f4ffff00000000 }
            // n = 6, score = 100
            //   50                   | outsb               dx, byte ptr [esi]
            //   56                   | insd                dword ptr es:[edi], dx
            //   8d85e8f4ffff         | outsb               dx, byte ptr gs:[esi]
            //   50                   | je                  0xa
            //   ff35????????         |                     
            //   c785e4f4ffff00000000     | lea    eax, [esp + 0x2b8]

        $sequence_44 = { 6bd230 8d82c0d34000 8945e4 803800 8bc8 7435 8a4101 }
            // n = 7, score = 100
            //   6bd230               | dec                 eax
            //   8d82c0d34000         | mov                 dword ptr [ecx + 0x18], eax
            //   8945e4               | dec                 eax
            //   803800               | lea                 ebp, [ecx + 0x70]
            //   8bc8                 | dec                 eax
            //   7435                 | mov                 dword ptr [ecx + 0x20], ebp
            //   8a4101               | div                 ecx

        $sequence_45 = { 8d4c2420 e8???????? 49 89c5 4d 85ed 74c9 }
            // n = 7, score = 100
            //   8d4c2420             | mov                 edx, dword ptr [ecx]
            //   e8????????           |                     
            //   49                   | mov                 eax, dword ptr [ebp - 4]
            //   89c5                 | add                 eax, 8
            //   4d                   | push                eax
            //   85ed                 | mov                 ecx, dword ptr [ebp - 4]
            //   74c9                 | mov                 dword ptr [ecx + 0x28], 0

        $sequence_46 = { 0a0b 0c0d 151515150e 0f????????1515 1515151515 }
            // n = 5, score = 100
            //   0a0b                 | js                  0x72
            //   0c0d                 | outsb               dx, byte ptr [esi]
            //   151515150e           | jbe                 0x6b
            //   0f????????1515       |                     
            //   1515151515           | jb                  0x73

        $sequence_47 = { c744243400000000 c744243c00000000 ff15???????? 6685c0 7441 6a00 56 }
            // n = 7, score = 100
            //   c744243400000000     | cli                 
            //   c744243c00000000     | cli                 
            //   ff15????????         |                     
            //   6685c0               | cli                 
            //   7441                 | cli                 
            //   6a00                 | cli                 
            //   56                   | cli                 

        $sequence_48 = { 59 8d8538fcffff 8945f4 ff7514 8d85c8fcffff 50 }
            // n = 6, score = 100
            //   59                   | mov                 edx, esp
            //   8d8538fcffff         | dec                 eax
            //   8945f4               | mov                 ecx, ebp
            //   ff7514               | dec                 esp
            //   8d85c8fcffff         | lea                 eax, [0x11235]
            //   50                   | xor                 eax, eax

        $sequence_49 = { ff15???????? 8d85c8feffff 6a00 6880000000 }
            // n = 4, score = 100
            //   ff15????????         |                     
            //   8d85c8feffff         | inc                 ebx
            //   6a00                 | cli                 
            //   6880000000           | cli                 

    condition:
        7 of them and filesize < 417792
}