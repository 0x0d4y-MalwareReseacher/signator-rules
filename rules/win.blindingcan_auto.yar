rule win_blindingcan_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-08-05"
        version = "1"
        description = "Detects win.blindingcan."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.blindingcan"
        malpedia_rule_date = "20220805"
        malpedia_hash = "6ec06c64bcfdbeda64eff021c766b4ce34542b71"
        malpedia_version = "20220808"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { c785c4fdffff1f08c3d4 c785c8fdffff28edbc6a c785ccfdffff12aff210 c785d0fdffff860f38a4 c785d4fdffffb5d65e3e }
            // n = 5, score = 300
            //   c785c4fdffff1f08c3d4     | mov    dword ptr [ebp - 0x23c], 0xd4c3081f
            //   c785c8fdffff28edbc6a     | mov    dword ptr [ebp - 0x238], 0x6abced28
            //   c785ccfdffff12aff210     | mov    dword ptr [ebp - 0x234], 0x10f2af12
            //   c785d0fdffff860f38a4     | mov    dword ptr [ebp - 0x230], 0xa4380f86
            //   c785d4fdffffb5d65e3e     | mov    dword ptr [ebp - 0x22c], 0x3e5ed6b5

        $sequence_1 = { c78574feffffd10cd19d c78578feffffb90fec33 c7857cfeffff36a54e6b c78580feffff5c01611e c78584feffffb5dcfc68 c78588feffff6ce7a33a }
            // n = 6, score = 300
            //   c78574feffffd10cd19d     | mov    dword ptr [ebp - 0x18c], 0x9dd10cd1
            //   c78578feffffb90fec33     | mov    dword ptr [ebp - 0x188], 0x33ec0fb9
            //   c7857cfeffff36a54e6b     | mov    dword ptr [ebp - 0x184], 0x6b4ea536
            //   c78580feffff5c01611e     | mov    dword ptr [ebp - 0x180], 0x1e61015c
            //   c78584feffffb5dcfc68     | mov    dword ptr [ebp - 0x17c], 0x68fcdcb5
            //   c78588feffff6ce7a33a     | mov    dword ptr [ebp - 0x178], 0x3aa3e76c

        $sequence_2 = { c7857cffffffd5b8ff4c c745803b1456ad c74584cac240c7 c74588788e35c9 c7458cb6293481 }
            // n = 5, score = 300
            //   c7857cffffffd5b8ff4c     | mov    dword ptr [ebp - 0x84], 0x4cffb8d5
            //   c745803b1456ad       | mov                 dword ptr [ebp - 0x80], 0xad56143b
            //   c74584cac240c7       | mov                 dword ptr [ebp - 0x7c], 0xc740c2ca
            //   c74588788e35c9       | mov                 dword ptr [ebp - 0x78], 0xc9358e78
            //   c7458cb6293481       | mov                 dword ptr [ebp - 0x74], 0x813429b6

        $sequence_3 = { c7850cffffff5e41f6d0 c78510ffffff75bb0656 c78514ffffff47cdfbc7 c78518ffffff79ecb859 c7851cffffff29398742 }
            // n = 5, score = 300
            //   c7850cffffff5e41f6d0     | mov    dword ptr [ebp - 0xf4], 0xd0f6415e
            //   c78510ffffff75bb0656     | mov    dword ptr [ebp - 0xf0], 0x5606bb75
            //   c78514ffffff47cdfbc7     | mov    dword ptr [ebp - 0xec], 0xc7fbcd47
            //   c78518ffffff79ecb859     | mov    dword ptr [ebp - 0xe8], 0x59b8ec79
            //   c7851cffffff29398742     | mov    dword ptr [ebp - 0xe4], 0x42873929

        $sequence_4 = { c78570ffffff1af7f3b4 c78574ffffff9dd490d9 c78578ffffffb9d6b365 c7857cffffffd5b8ff4c c745803b1456ad }
            // n = 5, score = 300
            //   c78570ffffff1af7f3b4     | mov    dword ptr [ebp - 0x90], 0xb4f3f71a
            //   c78574ffffff9dd490d9     | mov    dword ptr [ebp - 0x8c], 0xd990d49d
            //   c78578ffffffb9d6b365     | mov    dword ptr [ebp - 0x88], 0x65b3d6b9
            //   c7857cffffffd5b8ff4c     | mov    dword ptr [ebp - 0x84], 0x4cffb8d5
            //   c745803b1456ad       | mov                 dword ptr [ebp - 0x80], 0xad56143b

        $sequence_5 = { c785dcfdffff22505a47 c785e0fdffffca2ad0ca c785e4fdffff1ae87952 c785e8fdffff6dbfc790 c785ecfdffff9e14e675 c785f0fdffff5e15f8d2 c785f4fdffff7f5e6709 }
            // n = 7, score = 300
            //   c785dcfdffff22505a47     | mov    dword ptr [ebp - 0x224], 0x475a5022
            //   c785e0fdffffca2ad0ca     | mov    dword ptr [ebp - 0x220], 0xcad02aca
            //   c785e4fdffff1ae87952     | mov    dword ptr [ebp - 0x21c], 0x5279e81a
            //   c785e8fdffff6dbfc790     | mov    dword ptr [ebp - 0x218], 0x90c7bf6d
            //   c785ecfdffff9e14e675     | mov    dword ptr [ebp - 0x214], 0x75e6149e
            //   c785f0fdffff5e15f8d2     | mov    dword ptr [ebp - 0x210], 0xd2f8155e
            //   c785f4fdffff7f5e6709     | mov    dword ptr [ebp - 0x20c], 0x9675e7f

        $sequence_6 = { c74590ba0d9dae c74594922aeaf1 c74598f6e3e7dd c7459c52b86f28 c745a0b5c9a315 c745a453e8ba52 }
            // n = 6, score = 300
            //   c74590ba0d9dae       | mov                 dword ptr [ebp - 0x70], 0xae9d0dba
            //   c74594922aeaf1       | mov                 dword ptr [ebp - 0x6c], 0xf1ea2a92
            //   c74598f6e3e7dd       | mov                 dword ptr [ebp - 0x68], 0xdde7e3f6
            //   c7459c52b86f28       | mov                 dword ptr [ebp - 0x64], 0x286fb852
            //   c745a0b5c9a315       | mov                 dword ptr [ebp - 0x60], 0x15a3c9b5
            //   c745a453e8ba52       | mov                 dword ptr [ebp - 0x5c], 0x52bae853

        $sequence_7 = { c745b8e958e686 c745bcedc14eb4 c745c091810345 c745c401761a06 c745c859c24b75 }
            // n = 5, score = 300
            //   c745b8e958e686       | mov                 dword ptr [ebp - 0x48], 0x86e658e9
            //   c745bcedc14eb4       | mov                 dword ptr [ebp - 0x44], 0xb44ec1ed
            //   c745c091810345       | mov                 dword ptr [ebp - 0x40], 0x45038191
            //   c745c401761a06       | mov                 dword ptr [ebp - 0x3c], 0x61a7601
            //   c745c859c24b75       | mov                 dword ptr [ebp - 0x38], 0x754bc259

        $sequence_8 = { f7fe 8bca e8???????? 85c0 7409 }
            // n = 5, score = 200
            //   f7fe                 | idiv                esi
            //   8bca                 | mov                 ecx, edx
            //   e8????????           |                     
            //   85c0                 | test                eax, eax
            //   7409                 | je                  0xb

        $sequence_9 = { 66448921 488d542450 488d8df0030000 ff15???????? 4883cfff 488bd8 483bc7 }
            // n = 7, score = 100
            //   66448921             | dec                 esp
            //   488d542450           | sub                 ecx, ebp
            //   488d8df0030000       | inc                 esp
            //   ff15????????         |                     
            //   4883cfff             | mov                 bl, al
            //   488bd8               | jne                 0xffffffd6
            //   483bc7               | dec                 eax

        $sequence_10 = { 410fb7e8 8bf2 488bd9 4885c9 745b e8???????? 8364242800 }
            // n = 7, score = 100
            //   410fb7e8             | mov                 ebx, dword ptr [esp + 8]
            //   8bf2                 | dec                 eax
            //   488bd9               | mov                 ebp, dword ptr [esp + 0x10]
            //   4885c9               | inc                 sp
            //   745b                 | mov                 dword ptr [ecx], esp
            //   e8????????           |                     
            //   8364242800           | dec                 eax

        $sequence_11 = { 488bd3 e8???????? 488b4c2430 ff15???????? 488d4c246c 8bd8 ff15???????? }
            // n = 7, score = 100
            //   488bd3               | lea                 edx, [esp + 0x50]
            //   e8????????           |                     
            //   488b4c2430           | dec                 eax
            //   ff15????????         |                     
            //   488d4c246c           | lea                 ecx, [ebp + 0x3f0]
            //   8bd8                 | dec                 eax
            //   ff15????????         |                     

        $sequence_12 = { 0f44c6 4c03d5 4c2bcd 448ad8 75cb 488b5c2408 488b6c2410 }
            // n = 7, score = 100
            //   0f44c6               | test                eax, eax
            //   4c03d5               | je                  0x412
            //   4c2bcd               | dec                 ecx
            //   448ad8               | lea                 esi, [ebp + 8]
            //   75cb                 | cmove               eax, esi
            //   488b5c2408           | dec                 esp
            //   488b6c2410           | add                 edx, ebp

        $sequence_13 = { 488d15825d0100 488d8d70010000 4533c0 ff15???????? 85c0 0f840c040000 498d7508 }
            // n = 7, score = 100
            //   488d15825d0100       | dec                 eax
            //   488d8d70010000       | lea                 edx, [0x15d82]
            //   4533c0               | dec                 eax
            //   ff15????????         |                     
            //   85c0                 | lea                 ecx, [ebp + 0x170]
            //   0f840c040000         | inc                 ebp
            //   498d7508             | xor                 eax, eax

        $sequence_14 = { ff15???????? 8bd8 85db 7505 453bee 7431 }
            // n = 6, score = 100
            //   ff15????????         |                     
            //   8bd8                 | mov                 esi, edx
            //   85db                 | dec                 eax
            //   7505                 | mov                 ebx, ecx
            //   453bee               | dec                 eax
            //   7431                 | test                ecx, ecx

        $sequence_15 = { 7d08 412bd4 0bd3 4103d4 4863ca 8a440c20 4288440420 }
            // n = 7, score = 100
            //   7d08                 | or                  edi, 0xffffffff
            //   412bd4               | dec                 eax
            //   0bd3                 | mov                 ebx, eax
            //   4103d4               | dec                 eax
            //   4863ca               | cmp                 eax, edi
            //   8a440c20             | inc                 ecx
            //   4288440420           | movzx               ebp, ax

    condition:
        7 of them and filesize < 363520
}