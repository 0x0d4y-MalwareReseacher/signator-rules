rule win_adhubllka_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-06-10"
        version = "1"
        description = "Detects win.adhubllka."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.adhubllka"
        malpedia_rule_date = "20210604"
        malpedia_hash = "be09d5d71e77373c0f538068be31a2ad4c69cfbd"
        malpedia_version = "20210616"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 83c410 ebe3 8b4df8 8b55f4 8b048d68b34100 807c102800 }
            // n = 6, score = 500
            //   83c410               | add                 esp, 0x10
            //   ebe3                 | jmp                 0xffffffe5
            //   8b4df8               | mov                 ecx, dword ptr [ebp - 8]
            //   8b55f4               | mov                 edx, dword ptr [ebp - 0xc]
            //   8b048d68b34100       | mov                 eax, dword ptr [ecx*4 + 0x41b368]
            //   807c102800           | cmp                 byte ptr [eax + edx + 0x28], 0

        $sequence_1 = { 898538ffffff 8b4598 038560ffffff 8bc8 8b9578ffffff 33cf c1c110 }
            // n = 7, score = 500
            //   898538ffffff         | mov                 dword ptr [ebp - 0xc8], eax
            //   8b4598               | mov                 eax, dword ptr [ebp - 0x68]
            //   038560ffffff         | add                 eax, dword ptr [ebp - 0xa0]
            //   8bc8                 | mov                 ecx, eax
            //   8b9578ffffff         | mov                 edx, dword ptr [ebp - 0x88]
            //   33cf                 | xor                 ecx, edi
            //   c1c110               | rol                 ecx, 0x10

        $sequence_2 = { 660febc8 0f28c1 660ffec2 0f28d7 660ffe9500ffffff 660fefe0 660f380025???????? }
            // n = 7, score = 500
            //   660febc8             | por                 xmm1, xmm0
            //   0f28c1               | movaps              xmm0, xmm1
            //   660ffec2             | paddd               xmm0, xmm2
            //   0f28d7               | movaps              xmm2, xmm7
            //   660ffe9500ffffff     | paddd               xmm2, xmmword ptr [ebp - 0x100]
            //   660fefe0             | pxor                xmm4, xmm0
            //   660f380025????????     |     

        $sequence_3 = { 8d8d60ffffff e8???????? 0f108560ffffff be04000000 0f118510ffffff 0f108570ffffff 0f118520ffffff }
            // n = 7, score = 500
            //   8d8d60ffffff         | lea                 ecx, dword ptr [ebp - 0xa0]
            //   e8????????           |                     
            //   0f108560ffffff       | movups              xmm0, xmmword ptr [ebp - 0xa0]
            //   be04000000           | mov                 esi, 4
            //   0f118510ffffff       | movups              xmmword ptr [ebp - 0xf0], xmm0
            //   0f108570ffffff       | movups              xmm0, xmmword ptr [ebp - 0x90]
            //   0f118520ffffff       | movups              xmmword ptr [ebp - 0xe0], xmm0

        $sequence_4 = { 89b50cfbffff 0f104320 0f114580 0f104330 }
            // n = 4, score = 500
            //   89b50cfbffff         | mov                 dword ptr [ebp - 0x4f4], esi
            //   0f104320             | movups              xmm0, xmmword ptr [ebx + 0x20]
            //   0f114580             | movups              xmmword ptr [ebp - 0x80], xmm0
            //   0f104330             | movups              xmm0, xmmword ptr [ebx + 0x30]

        $sequence_5 = { 8b4738 8945f8 8b4718 f76f20 }
            // n = 4, score = 500
            //   8b4738               | mov                 eax, dword ptr [edi + 0x38]
            //   8945f8               | mov                 dword ptr [ebp - 8], eax
            //   8b4718               | mov                 eax, dword ptr [edi + 0x18]
            //   f76f20               | imul                dword ptr [edi + 0x20]

        $sequence_6 = { 0f1000 8b45ec 660fefe8 0f1128 0f28adb0feffff }
            // n = 5, score = 500
            //   0f1000               | movups              xmm0, xmmword ptr [eax]
            //   8b45ec               | mov                 eax, dword ptr [ebp - 0x14]
            //   660fefe8             | pxor                xmm5, xmm0
            //   0f1128               | movups              xmmword ptr [eax], xmm5
            //   0f28adb0feffff       | movaps              xmm5, xmmword ptr [ebp - 0x150]

        $sequence_7 = { ff742424 ff15???????? 85c0 0f8593000000 8d442428 c74424100a000000 }
            // n = 6, score = 500
            //   ff742424             | push                dword ptr [esp + 0x24]
            //   ff15????????         |                     
            //   85c0                 | test                eax, eax
            //   0f8593000000         | jne                 0x99
            //   8d442428             | lea                 eax, dword ptr [esp + 0x28]
            //   c74424100a000000     | mov                 dword ptr [esp + 0x10], 0xa

        $sequence_8 = { 0f85e0feffff ffb59cfdffff ff15???????? 68???????? 56 68???????? }
            // n = 6, score = 500
            //   0f85e0feffff         | jne                 0xfffffee6
            //   ffb59cfdffff         | push                dword ptr [ebp - 0x264]
            //   ff15????????         |                     
            //   68????????           |                     
            //   56                   | push                esi
            //   68????????           |                     

        $sequence_9 = { 85c9 743f 8b442410 8bd0 50 51 }
            // n = 6, score = 500
            //   85c9                 | test                ecx, ecx
            //   743f                 | je                  0x41
            //   8b442410             | mov                 eax, dword ptr [esp + 0x10]
            //   8bd0                 | mov                 edx, eax
            //   50                   | push                eax
            //   51                   | push                ecx

    condition:
        7 of them and filesize < 253952
}