rule win_adhubllka_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-01-25"
        version = "1"
        description = "Detects win.adhubllka."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.adhubllka"
        malpedia_rule_date = "20230124"
        malpedia_hash = "2ee0eebba83dce3d019a90519f2f972c0fcf9686"
        malpedia_version = "20230125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 03c7 880c10 42 836de401 75e6 8b7de0 8b4df8 }
            // n = 7, score = 500
            //   03c7                 | add                 eax, edi
            //   880c10               | mov                 byte ptr [eax + edx], cl
            //   42                   | inc                 edx
            //   836de401             | sub                 dword ptr [ebp - 0x1c], 1
            //   75e6                 | jne                 0xffffffe8
            //   8b7de0               | mov                 edi, dword ptr [ebp - 0x20]
            //   8b4df8               | mov                 ecx, dword ptr [ebp - 8]

        $sequence_1 = { 33c7 c1c008 8bbd30ffffff 898540ffffff 8945e0 }
            // n = 5, score = 500
            //   33c7                 | xor                 eax, edi
            //   c1c008               | rol                 eax, 8
            //   8bbd30ffffff         | mov                 edi, dword ptr [ebp - 0xd0]
            //   898540ffffff         | mov                 dword ptr [ebp - 0xc0], eax
            //   8945e0               | mov                 dword ptr [ebp - 0x20], eax

        $sequence_2 = { 33f0 c1c610 03ce 8bd1 335580 c1c20c 03c2 }
            // n = 7, score = 500
            //   33f0                 | xor                 esi, eax
            //   c1c610               | rol                 esi, 0x10
            //   03ce                 | add                 ecx, esi
            //   8bd1                 | mov                 edx, ecx
            //   335580               | xor                 edx, dword ptr [ebp - 0x80]
            //   c1c20c               | rol                 edx, 0xc
            //   03c2                 | add                 eax, edx

        $sequence_3 = { 731c 8bc1 83e13f c1f806 6bc938 8b048568b34100 0fb6440828 }
            // n = 7, score = 500
            //   731c                 | jae                 0x1e
            //   8bc1                 | mov                 eax, ecx
            //   83e13f               | and                 ecx, 0x3f
            //   c1f806               | sar                 eax, 6
            //   6bc938               | imul                ecx, ecx, 0x38
            //   8b048568b34100       | mov                 eax, dword ptr [eax*4 + 0x41b368]
            //   0fb6440828           | movzx               eax, byte ptr [eax + ecx + 0x28]

        $sequence_4 = { 0f1128 0f28adb0feffff 660ffefe 660ffead60ffffff 0f28a590feffff 0f28dd 660ffea5e0feffff }
            // n = 7, score = 500
            //   0f1128               | movups              xmmword ptr [eax], xmm5
            //   0f28adb0feffff       | movaps              xmm5, xmmword ptr [ebp - 0x150]
            //   660ffefe             | paddd               xmm7, xmm6
            //   660ffead60ffffff     | paddd               xmm5, xmmword ptr [ebp - 0xa0]
            //   0f28a590feffff       | movaps              xmm4, xmmword ptr [ebp - 0x170]
            //   0f28dd               | movaps              xmm3, xmm5
            //   660ffea5e0feffff     | paddd               xmm4, xmmword ptr [ebp - 0x120]

        $sequence_5 = { 8b0c8568b34100 8a0433 43 88440a2e 8b4dd8 8b55b4 3bdf }
            // n = 7, score = 500
            //   8b0c8568b34100       | mov                 ecx, dword ptr [eax*4 + 0x41b368]
            //   8a0433               | mov                 al, byte ptr [ebx + esi]
            //   43                   | inc                 ebx
            //   88440a2e             | mov                 byte ptr [edx + ecx + 0x2e], al
            //   8b4dd8               | mov                 ecx, dword ptr [ebp - 0x28]
            //   8b55b4               | mov                 edx, dword ptr [ebp - 0x4c]
            //   3bdf                 | cmp                 ebx, edi

        $sequence_6 = { 8bb530fbffff 83c410 898530fbffff 8b852cfbffff 89851cfbffff 8b8528fbffff }
            // n = 6, score = 500
            //   8bb530fbffff         | mov                 esi, dword ptr [ebp - 0x4d0]
            //   83c410               | add                 esp, 0x10
            //   898530fbffff         | mov                 dword ptr [ebp - 0x4d0], eax
            //   8b852cfbffff         | mov                 eax, dword ptr [ebp - 0x4d4]
            //   89851cfbffff         | mov                 dword ptr [ebp - 0x4e4], eax
            //   8b8528fbffff         | mov                 eax, dword ptr [ebp - 0x4d8]

        $sequence_7 = { 03c1 8b8d2cffffff 8945dc 33c2 8b9538ffffff c1c007 894590 }
            // n = 7, score = 500
            //   03c1                 | add                 eax, ecx
            //   8b8d2cffffff         | mov                 ecx, dword ptr [ebp - 0xd4]
            //   8945dc               | mov                 dword ptr [ebp - 0x24], eax
            //   33c2                 | xor                 eax, edx
            //   8b9538ffffff         | mov                 edx, dword ptr [ebp - 0xc8]
            //   c1c007               | rol                 eax, 7
            //   894590               | mov                 dword ptr [ebp - 0x70], eax

        $sequence_8 = { 660f62e0 660f6ad0 0f28f4 0f299d00ffffff 0f28dd 0f28ad70feffff }
            // n = 6, score = 500
            //   660f62e0             | punpckldq           xmm4, xmm0
            //   660f6ad0             | punpckhdq           xmm2, xmm0
            //   0f28f4               | movaps              xmm6, xmm4
            //   0f299d00ffffff       | movaps              xmmword ptr [ebp - 0x100], xmm3
            //   0f28dd               | movaps              xmm3, xmm5
            //   0f28ad70feffff       | movaps              xmm5, xmmword ptr [ebp - 0x190]

        $sequence_9 = { 72ce 6a48 8d857cfeffff 6a00 }
            // n = 4, score = 500
            //   72ce                 | jb                  0xffffffd0
            //   6a48                 | push                0x48
            //   8d857cfeffff         | lea                 eax, [ebp - 0x184]
            //   6a00                 | push                0

    condition:
        7 of them and filesize < 253952
}