rule win_colony_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.colony."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.colony"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 0101 0101 0101 0202 0202 0200 }
            // n = 6, score = 600
            //   0101                 | pop                 edi
            //   0101                 | pop                 esi
            //   0101                 | pop                 ebp
            //   0202                 | pop                 ebx
            //   0202                 | lock inc            dword ptr [eax]
            //   0200                 | dec                 eax

        $sequence_1 = { 0118 e9???????? 6a00 6818200000 }
            // n = 4, score = 600
            //   0118                 | add                 al, byte ptr [eax]
            //   e9????????           |                     
            //   6a00                 | add                 dword ptr [edx], eax
            //   6818200000           | add                 al, byte ptr [edx]

        $sequence_2 = { 5b c3 b901000000 66894808 }
            // n = 4, score = 600
            //   5b                   | cmp                 edx, 0x80
            //   c3                   | je                  0x2b
            //   b901000000           | cmp                 edx, 0xc0
            //   66894808             | movd                xmm0, dword ptr [ecx + 4]

        $sequence_3 = { 69d200008f04 2bc8 c1e910 69c161a4f778 }
            // n = 4, score = 600
            //   69d200008f04         | cvtdq2pd            xmm0, xmm0
            //   2bc8                 | test                al, al
            //   c1e910               | jne                 0x11
            //   69c161a4f778         | movss               xmm1, dword ptr [ecx]

        $sequence_4 = { 03c1 50 e8???????? 83c40c 8b45f0 }
            // n = 5, score = 600
            //   03c1                 | mov                 dword ptr [edi + 4], esi
            //   50                   | mov                 eax, dword ptr [esi + 0x14]
            //   e8????????           |                     
            //   83c40c               | add                 dword ptr [edx], eax
            //   8b45f0               | add                 eax, eax

        $sequence_5 = { 0118 e9???????? c745ec00000000 85db }
            // n = 4, score = 600
            //   0118                 | jl                  0xffffff8c
            //   e9????????           |                     
            //   c745ec00000000       | jmp                 0x11
            //   85db                 | or                  esi, 0xffffffff

        $sequence_6 = { 8841fe 8a4202 8841ff 8b02 c1e808 }
            // n = 5, score = 600
            //   8841fe               | jne                 0xc
            //   8a4202               | movss               xmm0, dword ptr [ecx + 4]
            //   8841ff               | cvtps2pd            xmm0, xmm0
            //   8b02                 | test                al, al
            //   c1e808               | jne                 0xb

        $sequence_7 = { 0102 894dec 3bcb 7c85 }
            // n = 4, score = 600
            //   0102                 | add                 al, byte ptr [edx]
            //   894dec               | add                 al, byte ptr [eax]
            //   3bcb                 | add                 dword ptr [edx], eax
            //   7c85                 | add                 dword ptr [ecx], eax

        $sequence_8 = { 660f6e4104 f30fe6c0 84c0 7509 f30f1009 0f5ac9 }
            // n = 6, score = 600
            //   660f6e4104           | add                 esi, ecx
            //   f30fe6c0             | push                ebx
            //   84c0                 | push                esi
            //   7509                 | mov                 esi, dword ptr [ebp - 0x34]
            //   f30f1009             | add                 esi, ecx
            //   0f5ac9               | push                ebx

        $sequence_9 = { 034de8 894604 893e 8930 }
            // n = 4, score = 600
            //   034de8               | add                 dword ptr [ecx], eax
            //   894604               | add                 dword ptr [ecx], eax
            //   893e                 | add                 al, byte ptr [edx]
            //   8930                 | add                 al, byte ptr [edx]

        $sequence_10 = { 740f 0301 eb0b a801 }
            // n = 4, score = 600
            //   740f                 | jne                 0x11
            //   0301                 | movss               xmm1, dword ptr [ecx]
            //   eb0b                 | movd                xmm0, dword ptr [ecx + 4]
            //   a801                 | cvtdq2pd            xmm0, xmm0

        $sequence_11 = { 03f1 ff15???????? 8b0d???????? 53 }
            // n = 4, score = 600
            //   03f1                 | push                0
            //   ff15????????         |                     
            //   8b0d????????         |                     
            //   53                   | push                eax

        $sequence_12 = { 85c0 750f 80fb0a 740a 80fb0d 7405 }
            // n = 6, score = 600
            //   85c0                 | shr                 ecx, 0x10
            //   750f                 | imul                eax, ecx, 0x78f7a461
            //   80fb0a               | sub                 edx, eax
            //   740a                 | imul                eax, edx, 0x30674eef
            //   80fb0d               | imul                edx, edx, 0x48f0000
            //   7405                 | sub                 ecx, eax

        $sequence_13 = { 7407 b901000000 eb0a 33c9 803f01 }
            // n = 5, score = 600
            //   7407                 | cvtps2pd            xmm1, xmm1
            //   b901000000           | jmp                 0x19
            //   eb0a                 | movd                xmm0, dword ptr [ecx + 4]
            //   33c9                 | cvtdq2pd            xmm0, xmm0
            //   803f01               | test                al, al

        $sequence_14 = { 84c0 750a f30f104104 0f5ac0 eb09 660f6e4104 f30fe6c0 }
            // n = 7, score = 600
            //   84c0                 | jmp                 0x15
            //   750a                 | xor                 ecx, ecx
            //   f30f104104           | cmp                 byte ptr [edi], 1
            //   0f5ac0               | setne               cl
            //   eb09                 | test                eax, eax
            //   660f6e4104           | je                  0xb
            //   f30fe6c0             | mov                 ecx, 1

        $sequence_15 = { 03c0 8985bcfbffff 8d85bcfbffff 6a00 }
            // n = 4, score = 600
            //   03c0                 | add                 al, byte ptr [eax]
            //   8985bcfbffff         | add                 dword ptr [edx], eax
            //   8d85bcfbffff         | add                 al, byte ptr [edx]
            //   6a00                 | add                 ecx, dword ptr [ebp - 0x18]

        $sequence_16 = { 488bcd e8???????? 85c0 0f85d9000000 488d15a8900000 }
            // n = 5, score = 100
            //   488bcd               | mov                 ecx, eax
            //   e8????????           |                     
            //   85c0                 | dec                 eax
            //   0f85d9000000         | lea                 edx, [0x7b14]
            //   488d15a8900000       | dec                 eax

        $sequence_17 = { 4c8d357e0c0100 488b0d???????? eb7b 4c8d35660c0100 }
            // n = 4, score = 100
            //   4c8d357e0c0100       | neg                 ebp
            //   488b0d????????       |                     
            //   eb7b                 | dec                 eax
            //   4c8d35660c0100       | sub                 esi, 0x60

        $sequence_18 = { 488905???????? ff15???????? 488bc8 ff15???????? 488d15147b0000 }
            // n = 5, score = 100
            //   488905????????       |                     
            //   ff15????????         |                     
            //   488bc8               | dec                 esp
            //   ff15????????         |                     
            //   488d15147b0000       | lea                 esi, [0x10c7e]

        $sequence_19 = { 4159 4158 5f 5e 5d 5b }
            // n = 6, score = 100
            //   4159                 | lea                 esi, [0xc8fe]
            //   4158                 | and                 eax, 0x1f
            //   5f                   | dec                 eax
            //   5e                   | mov                 ecx, ebp
            //   5d                   | test                eax, eax
            //   5b                   | jne                 0xe1

        $sequence_20 = { 790e 488d357ead0000 41f7dd 4883ee60 }
            // n = 4, score = 100
            //   790e                 | jns                 0x10
            //   488d357ead0000       | dec                 eax
            //   41f7dd               | lea                 esi, [0xad7e]
            //   4883ee60             | inc                 ecx

        $sequence_21 = { 488bfb 48c1ff05 4c8d35fec80000 83e01f }
            // n = 4, score = 100
            //   488bfb               | jmp                 0x7d
            //   48c1ff05             | dec                 esp
            //   4c8d35fec80000       | lea                 esi, [0x10c66]
            //   83e01f               | dec                 eax

        $sequence_22 = { f0ff00 488d4128 41b806000000 488d1588fd0000 483950f0 740b 488b10 }
            // n = 7, score = 100
            //   f0ff00               | dec                 eax
            //   488d4128             | lea                 edx, [0x90a8]
            //   41b806000000         | nop                 
            //   488d1588fd0000       | dec                 eax
            //   483950f0             | mov                 edx, edi
            //   740b                 | dec                 eax
            //   488b10               | lea                 ecx, [0xc551]

        $sequence_23 = { 90 488bd7 488d0d51c50000 e8???????? 488905???????? b90c000000 }
            // n = 6, score = 100
            //   90                   | mov                 edi, ebx
            //   488bd7               | dec                 eax
            //   488d0d51c50000       | sar                 edi, 5
            //   e8????????           |                     
            //   488905????????       |                     
            //   b90c000000           | dec                 esp

    condition:
        7 of them and filesize < 7599104
}