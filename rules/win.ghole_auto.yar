rule win_ghole_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-01-25"
        version = "1"
        description = "Detects win.ghole."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.ghole"
        malpedia_rule_date = "20230124"
        malpedia_hash = "2ee0eebba83dce3d019a90519f2f972c0fcf9686"
        malpedia_version = "20230125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 7409 48 8b80b0020000 eb7a 48 8d0d4d5a0300 ff15???????? }
            // n = 7, score = 100
            //   7409                 | je                  0xb
            //   48                   | dec                 eax
            //   8b80b0020000         | mov                 eax, dword ptr [eax + 0x2b0]
            //   eb7a                 | jmp                 0x7c
            //   48                   | dec                 eax
            //   8d0d4d5a0300         | lea                 ecx, [0x35a4d]
            //   ff15????????         |                     

        $sequence_1 = { c0e804 8845e1 0fb645e0 0fb6c0 c1e004 0a45eb 8845e0 }
            // n = 7, score = 100
            //   c0e804               | shr                 al, 4
            //   8845e1               | mov                 byte ptr [ebp - 0x1f], al
            //   0fb645e0             | movzx               eax, byte ptr [ebp - 0x20]
            //   0fb6c0               | movzx               eax, al
            //   c1e004               | shl                 eax, 4
            //   0a45eb               | or                  al, byte ptr [ebp - 0x15]
            //   8845e0               | mov                 byte ptr [ebp - 0x20], al

        $sequence_2 = { 83e801 48 034598 0fb610 0fb645c2 8d0402 8845c2 }
            // n = 7, score = 100
            //   83e801               | sub                 eax, 1
            //   48                   | dec                 eax
            //   034598               | add                 eax, dword ptr [ebp - 0x68]
            //   0fb610               | movzx               edx, byte ptr [eax]
            //   0fb645c2             | movzx               eax, byte ptr [ebp - 0x3e]
            //   8d0402               | lea                 eax, [edx + eax]
            //   8845c2               | mov                 byte ptr [ebp - 0x3e], al

        $sequence_3 = { 48 89c7 e8???????? e9???????? bf04100000 e8???????? 48 }
            // n = 7, score = 100
            //   48                   | dec                 eax
            //   89c7                 | mov                 edi, eax
            //   e8????????           |                     
            //   e9????????           |                     
            //   bf04100000           | mov                 edi, 0x1004
            //   e8????????           |                     
            //   48                   | dec                 eax

        $sequence_4 = { 48 8b45a0 0fb700 6683f84b 0f85b5000000 48 8b45a0 }
            // n = 7, score = 100
            //   48                   | dec                 eax
            //   8b45a0               | mov                 eax, dword ptr [ebp - 0x60]
            //   0fb700               | movzx               eax, word ptr [eax]
            //   6683f84b             | cmp                 ax, 0x4b
            //   0f85b5000000         | jne                 0xbb
            //   48                   | dec                 eax
            //   8b45a0               | mov                 eax, dword ptr [ebp - 0x60]

        $sequence_5 = { 48 0355b8 48 8b8588faffff 48 89d6 48 }
            // n = 7, score = 100
            //   48                   | dec                 eax
            //   0355b8               | add                 edx, dword ptr [ebp - 0x48]
            //   48                   | dec                 eax
            //   8b8588faffff         | mov                 eax, dword ptr [ebp - 0x578]
            //   48                   | dec                 eax
            //   89d6                 | mov                 esi, edx
            //   48                   | dec                 eax

        $sequence_6 = { 48 8975e0 48 8955d8 48 894dd0 48 }
            // n = 7, score = 100
            //   48                   | dec                 eax
            //   8975e0               | mov                 dword ptr [ebp - 0x20], esi
            //   48                   | dec                 eax
            //   8955d8               | mov                 dword ptr [ebp - 0x28], edx
            //   48                   | dec                 eax
            //   894dd0               | mov                 dword ptr [ebp - 0x30], ecx
            //   48                   | dec                 eax

        $sequence_7 = { 0f8578ffffff c9 c3 55 48 89e5 48 }
            // n = 7, score = 100
            //   0f8578ffffff         | jne                 0xffffff7e
            //   c9                   | leave               
            //   c3                   | ret                 
            //   55                   | push                ebp
            //   48                   | dec                 eax
            //   89e5                 | mov                 ebp, esp
            //   48                   | dec                 eax

        $sequence_8 = { 7538 833d????????00 7424 48 8bcb e8???????? 85c0 }
            // n = 7, score = 100
            //   7538                 | jne                 0x3a
            //   833d????????00       |                     
            //   7424                 | je                  0x26
            //   48                   | dec                 eax
            //   8bcb                 | mov                 ecx, ebx
            //   e8????????           |                     
            //   85c0                 | test                eax, eax

        $sequence_9 = { 48 8d7c2440 48 85ff 0f849d000000 }
            // n = 5, score = 100
            //   48                   | dec                 eax
            //   8d7c2440             | lea                 edi, [esp + 0x40]
            //   48                   | dec                 eax
            //   85ff                 | test                edi, edi
            //   0f849d000000         | je                  0xa3

    condition:
        7 of them and filesize < 622592
}