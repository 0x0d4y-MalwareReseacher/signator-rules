rule win_mrac_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.mrac."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.mrac"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8a45fe 8b0c8d804b4500 88441129 8b0b 8bc1 c1f806 83e13f }
            // n = 7, score = 200
            //   8a45fe               | mov                 al, byte ptr [ebp - 2]
            //   8b0c8d804b4500       | mov                 ecx, dword ptr [ecx*4 + 0x454b80]
            //   88441129             | mov                 byte ptr [ecx + edx + 0x29], al
            //   8b0b                 | mov                 ecx, dword ptr [ebx]
            //   8bc1                 | mov                 eax, ecx
            //   c1f806               | sar                 eax, 6
            //   83e13f               | and                 ecx, 0x3f

        $sequence_1 = { 6a11 888424080d0000 e8???????? 3442 8d8c24f00c0000 6a12 888424090d0000 }
            // n = 7, score = 200
            //   6a11                 | push                0x11
            //   888424080d0000       | mov                 byte ptr [esp + 0xd08], al
            //   e8????????           |                     
            //   3442                 | xor                 al, 0x42
            //   8d8c24f00c0000       | lea                 ecx, [esp + 0xcf0]
            //   6a12                 | push                0x12
            //   888424090d0000       | mov                 byte ptr [esp + 0xd09], al

        $sequence_2 = { c684245b0600000b c684245c0600001c c684245d0600001f c684245e06000016 c684245f06000001 c68424600600001a c684246106000016 }
            // n = 7, score = 200
            //   c684245b0600000b     | mov                 byte ptr [esp + 0x65b], 0xb
            //   c684245c0600001c     | mov                 byte ptr [esp + 0x65c], 0x1c
            //   c684245d0600001f     | mov                 byte ptr [esp + 0x65d], 0x1f
            //   c684245e06000016     | mov                 byte ptr [esp + 0x65e], 0x16
            //   c684245f06000001     | mov                 byte ptr [esp + 0x65f], 1
            //   c68424600600001a     | mov                 byte ptr [esp + 0x660], 0x1a
            //   c684246106000016     | mov                 byte ptr [esp + 0x661], 0x16

        $sequence_3 = { 8b8424600c0000 0417 3465 8884247b0c0000 8b8424600c0000 0418 346e }
            // n = 7, score = 200
            //   8b8424600c0000       | mov                 eax, dword ptr [esp + 0xc60]
            //   0417                 | add                 al, 0x17
            //   3465                 | xor                 al, 0x65
            //   8884247b0c0000       | mov                 byte ptr [esp + 0xc7b], al
            //   8b8424600c0000       | mov                 eax, dword ptr [esp + 0xc60]
            //   0418                 | add                 al, 0x18
            //   346e                 | xor                 al, 0x6e

        $sequence_4 = { 88441104 42 83fa2a 72ec 5e c6412e00 8d4104 }
            // n = 7, score = 200
            //   88441104             | mov                 byte ptr [ecx + edx + 4], al
            //   42                   | inc                 edx
            //   83fa2a               | cmp                 edx, 0x2a
            //   72ec                 | jb                  0xffffffee
            //   5e                   | pop                 esi
            //   c6412e00             | mov                 byte ptr [ecx + 0x2e], 0
            //   8d4104               | lea                 eax, [ecx + 4]

        $sequence_5 = { 3465 888424d7010000 8b8424c0010000 0414 3462 888424d8010000 8b8424c0010000 }
            // n = 7, score = 200
            //   3465                 | xor                 al, 0x65
            //   888424d7010000       | mov                 byte ptr [esp + 0x1d7], al
            //   8b8424c0010000       | mov                 eax, dword ptr [esp + 0x1c0]
            //   0414                 | add                 al, 0x14
            //   3462                 | xor                 al, 0x62
            //   888424d8010000       | mov                 byte ptr [esp + 0x1d8], al
            //   8b8424c0010000       | mov                 eax, dword ptr [esp + 0x1c0]

        $sequence_6 = { 88842429120000 e8???????? 3449 8d8c2408120000 6a1b 8884242a120000 e8???????? }
            // n = 7, score = 200
            //   88842429120000       | mov                 byte ptr [esp + 0x1229], al
            //   e8????????           |                     
            //   3449                 | xor                 al, 0x49
            //   8d8c2408120000       | lea                 ecx, [esp + 0x1208]
            //   6a1b                 | push                0x1b
            //   8884242a120000       | mov                 byte ptr [esp + 0x122a], al
            //   e8????????           |                     

        $sequence_7 = { 888424490a0000 e8???????? 346e 8d8c24340a0000 6a0f 8884244a0a0000 e8???????? }
            // n = 7, score = 200
            //   888424490a0000       | mov                 byte ptr [esp + 0xa49], al
            //   e8????????           |                     
            //   346e                 | xor                 al, 0x6e
            //   8d8c24340a0000       | lea                 ecx, [esp + 0xa34]
            //   6a0f                 | push                0xf
            //   8884244a0a0000       | mov                 byte ptr [esp + 0xa4a], al
            //   e8????????           |                     

        $sequence_8 = { 88842463020000 8b842450020000 0410 3420 88842464020000 8b842450020000 0411 }
            // n = 7, score = 200
            //   88842463020000       | mov                 byte ptr [esp + 0x263], al
            //   8b842450020000       | mov                 eax, dword ptr [esp + 0x250]
            //   0410                 | add                 al, 0x10
            //   3420                 | xor                 al, 0x20
            //   88842464020000       | mov                 byte ptr [esp + 0x264], al
            //   8b842450020000       | mov                 eax, dword ptr [esp + 0x250]
            //   0411                 | add                 al, 0x11

        $sequence_9 = { 88842478060000 e8???????? 3467 8d8c2464060000 6a0e 88842479060000 e8???????? }
            // n = 7, score = 200
            //   88842478060000       | mov                 byte ptr [esp + 0x678], al
            //   e8????????           |                     
            //   3467                 | xor                 al, 0x67
            //   8d8c2464060000       | lea                 ecx, [esp + 0x664]
            //   6a0e                 | push                0xe
            //   88842479060000       | mov                 byte ptr [esp + 0x679], al
            //   e8????????           |                     

    condition:
        7 of them and filesize < 745472
}