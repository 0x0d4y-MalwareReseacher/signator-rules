rule win_xbot_pos_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-06-10"
        version = "1"
        description = "Detects win.xbot_pos."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.xbot_pos"
        malpedia_rule_date = "20210604"
        malpedia_hash = "be09d5d71e77373c0f538068be31a2ad4c69cfbd"
        malpedia_version = "20210616"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8b4df8 e8???????? 83c014 5f 5e 5b 81c4cc000000 }
            // n = 7, score = 100
            //   8b4df8               | mov                 ecx, dword ptr [ebp - 8]
            //   e8????????           |                     
            //   83c014               | add                 eax, 0x14
            //   5f                   | pop                 edi
            //   5e                   | pop                 esi
            //   5b                   | pop                 ebx
            //   81c4cc000000         | add                 esp, 0xcc

        $sequence_1 = { 8b55f8 0fb68220b14c00 ff2485f8b04c00 8b4dfc }
            // n = 4, score = 100
            //   8b55f8               | mov                 edx, dword ptr [ebp - 8]
            //   0fb68220b14c00       | movzx               eax, byte ptr [edx + 0x4cb120]
            //   ff2485f8b04c00       | jmp                 dword ptr [eax*4 + 0x4cb0f8]
            //   8b4dfc               | mov                 ecx, dword ptr [ebp - 4]

        $sequence_2 = { 5e 5b 8b4df0 33cd e8???????? 81c408040000 3bec }
            // n = 7, score = 100
            //   5e                   | pop                 esi
            //   5b                   | pop                 ebx
            //   8b4df0               | mov                 ecx, dword ptr [ebp - 0x10]
            //   33cd                 | xor                 ecx, ebp
            //   e8????????           |                     
            //   81c408040000         | add                 esp, 0x408
            //   3bec                 | cmp                 ebp, esp

        $sequence_3 = { 00633f 4c 00703f 4c 007d3f 4c 008a3f4c0097 }
            // n = 7, score = 100
            //   00633f               | add                 byte ptr [ebx + 0x3f], ah
            //   4c                   | dec                 esp
            //   00703f               | add                 byte ptr [eax + 0x3f], dh
            //   4c                   | dec                 esp
            //   007d3f               | add                 byte ptr [ebp + 0x3f], bh
            //   4c                   | dec                 esp
            //   008a3f4c0097         | add                 byte ptr [edx - 0x68ffb3c1], cl

        $sequence_4 = { 8b5508 8d049518465600 50 e8???????? 83c408 50 e8???????? }
            // n = 7, score = 100
            //   8b5508               | mov                 edx, dword ptr [ebp + 8]
            //   8d049518465600       | lea                 eax, dword ptr [edx*4 + 0x564618]
            //   50                   | push                eax
            //   e8????????           |                     
            //   83c408               | add                 esp, 8
            //   50                   | push                eax
            //   e8????????           |                     

        $sequence_5 = { e8???????? 83c404 8985d0fcffff 8b8dd0fcffff 898de0feffff }
            // n = 5, score = 100
            //   e8????????           |                     
            //   83c404               | add                 esp, 4
            //   8985d0fcffff         | mov                 dword ptr [ebp - 0x330], eax
            //   8b8dd0fcffff         | mov                 ecx, dword ptr [ebp - 0x330]
            //   898de0feffff         | mov                 dword ptr [ebp - 0x120], ecx

        $sequence_6 = { 85c0 7432 83ec0c 8bc4 89a520ffffff }
            // n = 5, score = 100
            //   85c0                 | test                eax, eax
            //   7432                 | je                  0x34
            //   83ec0c               | sub                 esp, 0xc
            //   8bc4                 | mov                 eax, esp
            //   89a520ffffff         | mov                 dword ptr [ebp - 0xe0], esp

        $sequence_7 = { eb07 c6853effffff01 8a953effffff 88953fffffff 8a853fffffff 5f 5e }
            // n = 7, score = 100
            //   eb07                 | jmp                 9
            //   c6853effffff01       | mov                 byte ptr [ebp - 0xc2], 1
            //   8a953effffff         | mov                 dl, byte ptr [ebp - 0xc2]
            //   88953fffffff         | mov                 byte ptr [ebp - 0xc1], dl
            //   8a853fffffff         | mov                 al, byte ptr [ebp - 0xc1]
            //   5f                   | pop                 edi
            //   5e                   | pop                 esi

        $sequence_8 = { 8985fcfeffff 8d8d0cffffff e8???????? 5f 5e 5b 81c404010000 }
            // n = 7, score = 100
            //   8985fcfeffff         | mov                 dword ptr [ebp - 0x104], eax
            //   8d8d0cffffff         | lea                 ecx, dword ptr [ebp - 0xf4]
            //   e8????????           |                     
            //   5f                   | pop                 edi
            //   5e                   | pop                 esi
            //   5b                   | pop                 ebx
            //   81c404010000         | add                 esp, 0x104

        $sequence_9 = { 8b4dfc 83e13f 6bd130 8b0485e0465600 807c102901 7510 c745d802000000 }
            // n = 7, score = 100
            //   8b4dfc               | mov                 ecx, dword ptr [ebp - 4]
            //   83e13f               | and                 ecx, 0x3f
            //   6bd130               | imul                edx, ecx, 0x30
            //   8b0485e0465600       | mov                 eax, dword ptr [eax*4 + 0x5646e0]
            //   807c102901           | cmp                 byte ptr [eax + edx + 0x29], 1
            //   7510                 | jne                 0x12
            //   c745d802000000       | mov                 dword ptr [ebp - 0x28], 2

    condition:
        7 of them and filesize < 3031040
}