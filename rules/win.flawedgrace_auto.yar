rule win_flawedgrace_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-01-25"
        version = "1"
        description = "Detects win.flawedgrace."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.flawedgrace"
        malpedia_rule_date = "20230124"
        malpedia_hash = "2ee0eebba83dce3d019a90519f2f972c0fcf9686"
        malpedia_version = "20230125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { c6851ed3ffff00 c6851fd3ffff4c c68520d3ffff89 c68521d3ffff6c c68522d3ffff24 c68523d3ffff28 c68524d3ffff48 }
            // n = 7, score = 200
            //   c6851ed3ffff00       | mov                 byte ptr [ebp - 0x2ce2], 0
            //   c6851fd3ffff4c       | mov                 byte ptr [ebp - 0x2ce1], 0x4c
            //   c68520d3ffff89       | mov                 byte ptr [ebp - 0x2ce0], 0x89
            //   c68521d3ffff6c       | mov                 byte ptr [ebp - 0x2cdf], 0x6c
            //   c68522d3ffff24       | mov                 byte ptr [ebp - 0x2cde], 0x24
            //   c68523d3ffff28       | mov                 byte ptr [ebp - 0x2cdd], 0x28
            //   c68524d3ffff48       | mov                 byte ptr [ebp - 0x2cdc], 0x48

        $sequence_1 = { c685e8d9ffff00 c685e9d9ffff00 c685ead9ffff00 c685ebd9ffff00 c685ecd9ffff00 c685edd9ffff00 c685eed9ffff00 }
            // n = 7, score = 200
            //   c685e8d9ffff00       | mov                 byte ptr [ebp - 0x2618], 0
            //   c685e9d9ffff00       | mov                 byte ptr [ebp - 0x2617], 0
            //   c685ead9ffff00       | mov                 byte ptr [ebp - 0x2616], 0
            //   c685ebd9ffff00       | mov                 byte ptr [ebp - 0x2615], 0
            //   c685ecd9ffff00       | mov                 byte ptr [ebp - 0x2614], 0
            //   c685edd9ffff00       | mov                 byte ptr [ebp - 0x2613], 0
            //   c685eed9ffff00       | mov                 byte ptr [ebp - 0x2612], 0

        $sequence_2 = { 8945e8 6a14 0f1100 c7401000000000 c6400401 c7400c00000000 c7400800000000 }
            // n = 7, score = 200
            //   8945e8               | mov                 dword ptr [ebp - 0x18], eax
            //   6a14                 | push                0x14
            //   0f1100               | movups              xmmword ptr [eax], xmm0
            //   c7401000000000       | mov                 dword ptr [eax + 0x10], 0
            //   c6400401             | mov                 byte ptr [eax + 4], 1
            //   c7400c00000000       | mov                 dword ptr [eax + 0xc], 0
            //   c7400800000000       | mov                 dword ptr [eax + 8], 0

        $sequence_3 = { c6850af4ffff17 c6850bf4ffff03 c6850cf4fffffa c6850df4ffff83 c6850ef4ffffc7 c6850ff4ffff04 c68510f4ffff66 }
            // n = 7, score = 200
            //   c6850af4ffff17       | mov                 byte ptr [ebp - 0xbf6], 0x17
            //   c6850bf4ffff03       | mov                 byte ptr [ebp - 0xbf5], 3
            //   c6850cf4fffffa       | mov                 byte ptr [ebp - 0xbf4], 0xfa
            //   c6850df4ffff83       | mov                 byte ptr [ebp - 0xbf3], 0x83
            //   c6850ef4ffffc7       | mov                 byte ptr [ebp - 0xbf2], 0xc7
            //   c6850ff4ffff04       | mov                 byte ptr [ebp - 0xbf1], 4
            //   c68510f4ffff66       | mov                 byte ptr [ebp - 0xbf0], 0x66

        $sequence_4 = { c685a0f0ffff00 c685a1f0ffff00 c685a2f0ffff89 c685a3f0ffff45 c685a4f0fffffc c685a5f0ffff50 c685a6f0ffff6a }
            // n = 7, score = 200
            //   c685a0f0ffff00       | mov                 byte ptr [ebp - 0xf60], 0
            //   c685a1f0ffff00       | mov                 byte ptr [ebp - 0xf5f], 0
            //   c685a2f0ffff89       | mov                 byte ptr [ebp - 0xf5e], 0x89
            //   c685a3f0ffff45       | mov                 byte ptr [ebp - 0xf5d], 0x45
            //   c685a4f0fffffc       | mov                 byte ptr [ebp - 0xf5c], 0xfc
            //   c685a5f0ffff50       | mov                 byte ptr [ebp - 0xf5b], 0x50
            //   c685a6f0ffff6a       | mov                 byte ptr [ebp - 0xf5a], 0x6a

        $sequence_5 = { c68576c7ffff49 c68577c7ffffb8 c68578c7ffffb0 c68579c7ffff43 c6857ac7ffff00 c6857bc7ffff40 c6857cc7ffff01 }
            // n = 7, score = 200
            //   c68576c7ffff49       | mov                 byte ptr [ebp - 0x388a], 0x49
            //   c68577c7ffffb8       | mov                 byte ptr [ebp - 0x3889], 0xb8
            //   c68578c7ffffb0       | mov                 byte ptr [ebp - 0x3888], 0xb0
            //   c68579c7ffff43       | mov                 byte ptr [ebp - 0x3887], 0x43
            //   c6857ac7ffff00       | mov                 byte ptr [ebp - 0x3886], 0
            //   c6857bc7ffff40       | mov                 byte ptr [ebp - 0x3885], 0x40
            //   c6857cc7ffff01       | mov                 byte ptr [ebp - 0x3884], 1

        $sequence_6 = { c685e7ddffff00 c685e8ddffff00 c685e9ddffff00 c685eaddffff00 c685ebddffff00 c685ecddffff00 c685edddffff00 }
            // n = 7, score = 200
            //   c685e7ddffff00       | mov                 byte ptr [ebp - 0x2219], 0
            //   c685e8ddffff00       | mov                 byte ptr [ebp - 0x2218], 0
            //   c685e9ddffff00       | mov                 byte ptr [ebp - 0x2217], 0
            //   c685eaddffff00       | mov                 byte ptr [ebp - 0x2216], 0
            //   c685ebddffff00       | mov                 byte ptr [ebp - 0x2215], 0
            //   c685ecddffff00       | mov                 byte ptr [ebp - 0x2214], 0
            //   c685edddffff00       | mov                 byte ptr [ebp - 0x2213], 0

        $sequence_7 = { 8d85fcc1ffff 8d8dfce5ffff 83bdc0bfffff00 0f44c1 898548bfffff ba001a0000 b800240000 }
            // n = 7, score = 200
            //   8d85fcc1ffff         | lea                 eax, [ebp - 0x3e04]
            //   8d8dfce5ffff         | lea                 ecx, [ebp - 0x1a04]
            //   83bdc0bfffff00       | cmp                 dword ptr [ebp - 0x4040], 0
            //   0f44c1               | cmove               eax, ecx
            //   898548bfffff         | mov                 dword ptr [ebp - 0x40b8], eax
            //   ba001a0000           | mov                 edx, 0x1a00
            //   b800240000           | mov                 eax, 0x2400

        $sequence_8 = { c685abcdffff85 c685accdffff79 c685adcdffffff c685aecdffffff c685afcdffffff c685b0cdffffe8 c685b1cdffff05 }
            // n = 7, score = 200
            //   c685abcdffff85       | mov                 byte ptr [ebp - 0x3255], 0x85
            //   c685accdffff79       | mov                 byte ptr [ebp - 0x3254], 0x79
            //   c685adcdffffff       | mov                 byte ptr [ebp - 0x3253], 0xff
            //   c685aecdffffff       | mov                 byte ptr [ebp - 0x3252], 0xff
            //   c685afcdffffff       | mov                 byte ptr [ebp - 0x3251], 0xff
            //   c685b0cdffffe8       | mov                 byte ptr [ebp - 0x3250], 0xe8
            //   c685b1cdffff05       | mov                 byte ptr [ebp - 0x324f], 5

        $sequence_9 = { c685f6f1ffff8d c685f7f1ffff7d c685f8f1ffffc4 c685f9f1ffff8b c685faf1ffff0d c685fbf1ffff4c c685fcf1ffff33 }
            // n = 7, score = 200
            //   c685f6f1ffff8d       | mov                 byte ptr [ebp - 0xe0a], 0x8d
            //   c685f7f1ffff7d       | mov                 byte ptr [ebp - 0xe09], 0x7d
            //   c685f8f1ffffc4       | mov                 byte ptr [ebp - 0xe08], 0xc4
            //   c685f9f1ffff8b       | mov                 byte ptr [ebp - 0xe07], 0x8b
            //   c685faf1ffff0d       | mov                 byte ptr [ebp - 0xe06], 0xd
            //   c685fbf1ffff4c       | mov                 byte ptr [ebp - 0xe05], 0x4c
            //   c685fcf1ffff33       | mov                 byte ptr [ebp - 0xe04], 0x33

    condition:
        7 of them and filesize < 966656
}