rule win_rikamanu_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.rikamanu."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.rikamanu"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 50 ff15???????? 8b35???????? 3d80969800 }
            // n = 4, score = 200
            //   50                   | push                eax
            //   ff15????????         |                     
            //   8b35????????         |                     
            //   3d80969800           | cmp                 eax, 0x989680

        $sequence_1 = { e8???????? 6a14 ff15???????? a801 }
            // n = 4, score = 200
            //   e8????????           |                     
            //   6a14                 | push                0x14
            //   ff15????????         |                     
            //   a801                 | test                al, 1

        $sequence_2 = { c3 663d1100 7525 668b4612 6685c0 750d }
            // n = 6, score = 100
            //   c3                   | ret                 
            //   663d1100             | cmp                 ax, 0x11
            //   7525                 | jne                 0x27
            //   668b4612             | mov                 ax, word ptr [esi + 0x12]
            //   6685c0               | test                ax, ax
            //   750d                 | jne                 0xf

        $sequence_3 = { 33c0 6808020000 8d95f4fdffff 52 899dccfdffff 8985d0fdffff }
            // n = 6, score = 100
            //   33c0                 | xor                 eax, eax
            //   6808020000           | push                0x208
            //   8d95f4fdffff         | lea                 edx, [ebp - 0x20c]
            //   52                   | push                edx
            //   899dccfdffff         | mov                 dword ptr [ebp - 0x234], ebx
            //   8985d0fdffff         | mov                 dword ptr [ebp - 0x230], eax

        $sequence_4 = { 83e61f 8d3c8de0b84000 c1e603 8b0f f644310401 7456 50 }
            // n = 7, score = 100
            //   83e61f               | and                 esi, 0x1f
            //   8d3c8de0b84000       | lea                 edi, [ecx*4 + 0x40b8e0]
            //   c1e603               | shl                 esi, 3
            //   8b0f                 | mov                 ecx, dword ptr [edi]
            //   f644310401           | test                byte ptr [ecx + esi + 4], 1
            //   7456                 | je                  0x58
            //   50                   | push                eax

        $sequence_5 = { 899df0feffff 50 89bdf4feffff ff15???????? }
            // n = 4, score = 100
            //   899df0feffff         | mov                 dword ptr [ebp - 0x110], ebx
            //   50                   | push                eax
            //   89bdf4feffff         | mov                 dword ptr [ebp - 0x10c], edi
            //   ff15????????         |                     

        $sequence_6 = { 33c0 8dbc2441060000 889c2440060000 f3ab }
            // n = 4, score = 100
            //   33c0                 | xor                 eax, eax
            //   8dbc2441060000       | lea                 edi, [esp + 0x641]
            //   889c2440060000       | mov                 byte ptr [esp + 0x640], bl
            //   f3ab                 | rep stosd           dword ptr es:[edi], eax

        $sequence_7 = { 7229 f3a5 ff2495d85a4000 8bc7 ba03000000 }
            // n = 5, score = 100
            //   7229                 | jb                  0x2b
            //   f3a5                 | rep movsd           dword ptr es:[edi], dword ptr [esi]
            //   ff2495d85a4000       | jmp                 dword ptr [edx*4 + 0x405ad8]
            //   8bc7                 | mov                 eax, edi
            //   ba03000000           | mov                 edx, 3

        $sequence_8 = { 5f 85c0 753e 6810270000 }
            // n = 4, score = 100
            //   5f                   | pop                 edi
            //   85c0                 | test                eax, eax
            //   753e                 | jne                 0x40
            //   6810270000           | push                0x2710

        $sequence_9 = { f3a4 be???????? b8???????? 8a10 8aca }
            // n = 5, score = 100
            //   f3a4                 | rep movsb           byte ptr es:[edi], byte ptr [esi]
            //   be????????           |                     
            //   b8????????           |                     
            //   8a10                 | mov                 dl, byte ptr [eax]
            //   8aca                 | mov                 cl, dl

        $sequence_10 = { 75f8 8bc8 c1e902 8bf2 f3a5 8bc8 8d95f4fdffff }
            // n = 7, score = 100
            //   75f8                 | jne                 0xfffffffa
            //   8bc8                 | mov                 ecx, eax
            //   c1e902               | shr                 ecx, 2
            //   8bf2                 | mov                 esi, edx
            //   f3a5                 | rep movsd           dword ptr es:[edi], dword ptr [esi]
            //   8bc8                 | mov                 ecx, eax
            //   8d95f4fdffff         | lea                 edx, [ebp - 0x20c]

        $sequence_11 = { 66ab aa 837d0001 0f85f5030000 ff15???????? 8be8 8d842430010000 }
            // n = 7, score = 100
            //   66ab                 | stosw               word ptr es:[edi], ax
            //   aa                   | stosb               byte ptr es:[edi], al
            //   837d0001             | cmp                 dword ptr [ebp], 1
            //   0f85f5030000         | jne                 0x3fb
            //   ff15????????         |                     
            //   8be8                 | mov                 ebp, eax
            //   8d842430010000       | lea                 eax, [esp + 0x130]

        $sequence_12 = { 50 83e103 68???????? f3a4 bf???????? }
            // n = 5, score = 100
            //   50                   | push                eax
            //   83e103               | and                 ecx, 3
            //   68????????           |                     
            //   f3a4                 | rep movsb           byte ptr es:[edi], byte ptr [esi]
            //   bf????????           |                     

        $sequence_13 = { 742f 8b4d0c f7d9 8d55f0 52 1bc9 }
            // n = 6, score = 100
            //   742f                 | je                  0x31
            //   8b4d0c               | mov                 ecx, dword ptr [ebp + 0xc]
            //   f7d9                 | neg                 ecx
            //   8d55f0               | lea                 edx, [ebp - 0x10]
            //   52                   | push                edx
            //   1bc9                 | sbb                 ecx, ecx

        $sequence_14 = { a1???????? c705????????231a2400 8935???????? a3???????? ff15???????? }
            // n = 5, score = 100
            //   a1????????           |                     
            //   c705????????231a2400     |     
            //   8935????????         |                     
            //   a3????????           |                     
            //   ff15????????         |                     

        $sequence_15 = { 7410 8088????????20 8a9405ecfcffff ebe3 80a020ad400000 40 41 }
            // n = 7, score = 100
            //   7410                 | je                  0x12
            //   8088????????20       |                     
            //   8a9405ecfcffff       | mov                 dl, byte ptr [ebp + eax - 0x314]
            //   ebe3                 | jmp                 0xffffffe5
            //   80a020ad400000       | and                 byte ptr [eax + 0x40ad20], 0
            //   40                   | inc                 eax
            //   41                   | inc                 ecx

        $sequence_16 = { 56 83e102 6a00 c745ec01000000 }
            // n = 4, score = 100
            //   56                   | push                esi
            //   83e102               | and                 ecx, 2
            //   6a00                 | push                0
            //   c745ec01000000       | mov                 dword ptr [ebp - 0x14], 1

        $sequence_17 = { 751d 8b45e8 50 ff15???????? 33c0 5e }
            // n = 6, score = 100
            //   751d                 | jne                 0x1f
            //   8b45e8               | mov                 eax, dword ptr [ebp - 0x18]
            //   50                   | push                eax
            //   ff15????????         |                     
            //   33c0                 | xor                 eax, eax
            //   5e                   | pop                 esi

        $sequence_18 = { ffb62c724000 8d8560ffffff 50 e8???????? 6810200100 8d8560ffffff 68???????? }
            // n = 7, score = 100
            //   ffb62c724000         | push                dword ptr [esi + 0x40722c]
            //   8d8560ffffff         | lea                 eax, [ebp - 0xa0]
            //   50                   | push                eax
            //   e8????????           |                     
            //   6810200100           | push                0x12010
            //   8d8560ffffff         | lea                 eax, [ebp - 0xa0]
            //   68????????           |                     

        $sequence_19 = { 8b35???????? 3d80969800 7619 8b0d???????? 55 }
            // n = 5, score = 100
            //   8b35????????         |                     
            //   3d80969800           | cmp                 eax, 0x989680
            //   7619                 | jbe                 0x1b
            //   8b0d????????         |                     
            //   55                   | push                ebp

        $sequence_20 = { 8945c4 0f87e9060000 ff2485ea1f4000 33c0 }
            // n = 4, score = 100
            //   8945c4               | mov                 dword ptr [ebp - 0x3c], eax
            //   0f87e9060000         | ja                  0x6ef
            //   ff2485ea1f4000       | jmp                 dword ptr [eax*4 + 0x401fea]
            //   33c0                 | xor                 eax, eax

        $sequence_21 = { 0f85d2000000 33c0 3905???????? 0f94c0 }
            // n = 4, score = 100
            //   0f85d2000000         | jne                 0xd8
            //   33c0                 | xor                 eax, eax
            //   3905????????         |                     
            //   0f94c0               | sete                al

        $sequence_22 = { 833cf5602a410000 7513 56 e8???????? }
            // n = 4, score = 100
            //   833cf5602a410000     | cmp                 dword ptr [esi*8 + 0x412a60], 0
            //   7513                 | jne                 0x15
            //   56                   | push                esi
            //   e8????????           |                     

        $sequence_23 = { 50 e8???????? cc 55 8bec 8b450c 56 }
            // n = 7, score = 100
            //   50                   | push                eax
            //   e8????????           |                     
            //   cc                   | int3                
            //   55                   | push                ebp
            //   8bec                 | mov                 ebp, esp
            //   8b450c               | mov                 eax, dword ptr [ebp + 0xc]
            //   56                   | push                esi

        $sequence_24 = { c1e606 033485383f4100 8975dc 8b02 }
            // n = 4, score = 100
            //   c1e606               | shl                 esi, 6
            //   033485383f4100       | add                 esi, dword ptr [eax*4 + 0x413f38]
            //   8975dc               | mov                 dword ptr [ebp - 0x24], esi
            //   8b02                 | mov                 eax, dword ptr [edx]

        $sequence_25 = { ff15???????? 8b3d???????? 3d80969800 7610 6a00 6a00 }
            // n = 6, score = 100
            //   ff15????????         |                     
            //   8b3d????????         |                     
            //   3d80969800           | cmp                 eax, 0x989680
            //   7610                 | jbe                 0x12
            //   6a00                 | push                0
            //   6a00                 | push                0

        $sequence_26 = { 6a40 8d8d8cfdffff 53 51 }
            // n = 4, score = 100
            //   6a40                 | push                0x40
            //   8d8d8cfdffff         | lea                 ecx, [ebp - 0x274]
            //   53                   | push                ebx
            //   51                   | push                ecx

        $sequence_27 = { ebb4 c745e438494100 a1???????? eb1a c745e434494100 a1???????? }
            // n = 6, score = 100
            //   ebb4                 | jmp                 0xffffffb6
            //   c745e438494100       | mov                 dword ptr [ebp - 0x1c], 0x414938
            //   a1????????           |                     
            //   eb1a                 | jmp                 0x1c
            //   c745e434494100       | mov                 dword ptr [ebp - 0x1c], 0x414934
            //   a1????????           |                     

        $sequence_28 = { 6a00 6884242200 50 ff15???????? 85c0 74d2 }
            // n = 6, score = 100
            //   6a00                 | push                0
            //   6884242200           | push                0x222484
            //   50                   | push                eax
            //   ff15????????         |                     
            //   85c0                 | test                eax, eax
            //   74d2                 | je                  0xffffffd4

        $sequence_29 = { 8088????????10 8a9405ecfdffff 889020ad4000 eb1c f6c202 }
            // n = 5, score = 100
            //   8088????????10       |                     
            //   8a9405ecfdffff       | mov                 dl, byte ptr [ebp + eax - 0x214]
            //   889020ad4000         | mov                 byte ptr [eax + 0x40ad20], dl
            //   eb1c                 | jmp                 0x1e
            //   f6c202               | test                dl, 2

    condition:
        7 of them and filesize < 212992
}