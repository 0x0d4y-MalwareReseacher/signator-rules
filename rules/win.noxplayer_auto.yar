rule win_noxplayer_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-06-10"
        version = "1"
        description = "Detects win.noxplayer."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.noxplayer"
        malpedia_rule_date = "20210604"
        malpedia_hash = "be09d5d71e77373c0f538068be31a2ad4c69cfbd"
        malpedia_version = "20210616"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 488d5510 488d4dd0 488bd8 488d059c420300 48894510 e8???????? 488b4dc0 }
            // n = 7, score = 100
            //   488d5510             | mov                 edx, dword ptr [ebx + 0xa8]
            //   488d4dd0             | jmp                 0x331
            //   488bd8               | movsd               xmm0, qword ptr [ebx + 0xb0]
            //   488d059c420300       | cvttsd2si           edx, xmm0
            //   48894510             | mov                 eax, dword ptr [ebx + 0xc0]
            //   e8????????           |                     
            //   488b4dc0             | cmp                 eax, ecx

        $sequence_1 = { 4c8d45b0 488b9730020000 488b8f20020000 e8???????? 488d8f10010000 e8???????? e9???????? }
            // n = 7, score = 100
            //   4c8d45b0             | inc                 esp
            //   488b9730020000       | add                 dword ptr [edi + 0x20], ebp
            //   488b8f20020000       | inc                 esp
            //   e8????????           |                     
            //   488d8f10010000       | mov                 dword ptr [esi + 0x18], ebp
            //   e8????????           |                     
            //   e9????????           |                     

        $sequence_2 = { 807d580a 741f 448823 4b8b8cf860e50400 8a4558 88443109 eb3b }
            // n = 7, score = 100
            //   807d580a             | mov                 eax, dword ptr [ebx + 0x17c]
            //   741f                 | mov                 dword ptr [esi + 0x1c], eax
            //   448823               | mov                 eax, dword ptr [ebx + 0x180]
            //   4b8b8cf860e50400     | mov                 dword ptr [esi + 0x20], eax
            //   8a4558               | dec                 eax
            //   88443109             | mov                 dword ptr [esi + 0x18], eax
            //   eb3b                 | inc                 esp

        $sequence_3 = { 488bf1 83f806 0f87a6030000 488d1da61affff 8b8483a4e90000 4803c3 ffe0 }
            // n = 7, score = 100
            //   488bf1               | cmp                 byte ptr [esi + 0x38], al
            //   83f806               | sete                al
            //   0f87a6030000         | inc                 ecx
            //   488d1da61affff       | mov                 dword ptr [esp + 0x14], eax
            //   8b8483a4e90000       | cmovge              ecx, eax
            //   4803c3               | mov                 dword ptr [esp + 0x20], ecx
            //   ffe0                 | dec                 esp

        $sequence_4 = { 483bc8 0f836e020000 b968000000 e8???????? 4885c0 740f 488bc8 }
            // n = 7, score = 100
            //   483bc8               | dec                 edx
            //   0f836e020000         | mov                 eax, dword ptr [eax + edi*8 + 0x4e560]
            //   b968000000           | or                  ebp, 1
            //   e8????????           |                     
            //   4885c0               | inc                 ebp
            //   740f                 | mov                 ecx, esp
            //   488bc8               | inc                 esp

        $sequence_5 = { 44393d???????? 0f86e5000000 e8???????? 85c0 0f85d8000000 888520010000 }
            // n = 6, score = 100
            //   44393d????????       |                     
            //   0f86e5000000         | test                al, al
            //   e8????????           |                     
            //   85c0                 | jne                 0x1a8
            //   0f85d8000000         | mov                 edx, 2
            //   888520010000         | dec                 eax

        $sequence_6 = { 4883c420 5f c3 4d3bc1 747f 660f1f440000 4180782100 }
            // n = 7, score = 100
            //   4883c420             | mov                 dword ptr [esp + 0x44], ebx
            //   5f                   | dec                 eax
            //   c3                   | lea                 eax, dword ptr [esp + 0x44]
            //   4d3bc1               | dec                 eax
            //   747f                 | mov                 dword ptr [esp + 0x20], eax
            //   660f1f440000         | inc                 ebp
            //   4180782100           | xor                 ecx, ecx

        $sequence_7 = { 3b5118 410f9cc0 4584c0 7405 488b09 eb04 488b4910 }
            // n = 7, score = 100
            //   3b5118               | dec                 esp
            //   410f9cc0             | lea                 ecx, dword ptr [esp + 0x34]
            //   4584c0               | dec                 esp
            //   7405                 | lea                 eax, dword ptr [esp + 0x30]
            //   488b09               | dec                 eax
            //   eb04                 | mov                 edx, eax
            //   488b4910             | xor                 ecx, ecx

        $sequence_8 = { 4c8bdc 57 4154 4155 4156 4157 4881ecf0030000 }
            // n = 7, score = 100
            //   4c8bdc               | jne                 0x1ba1
            //   57                   | mov                 edx, dword ptr [edi + 0x14]
            //   4154                 | cmp                 dword ptr [eax + 0x28], edx
            //   4155                 | jne                 0x1ba1
            //   4156                 | cmp                 byte ptr [eax + 0x30], 0
            //   4157                 | je                  0x1ba1
            //   4881ecf0030000       | inc                 esp

        $sequence_9 = { 4c8d1d8c410300 4c891f 488b4318 48894718 488b4320 488b5c2430 48894720 }
            // n = 7, score = 100
            //   4c8d1d8c410300       | mov                 eax, edx
            //   4c891f               | inc                 ecx
            //   488b4318             | or                  ecx, 0xffffffff
            //   48894718             | xor                 edx, edx
            //   488b4320             | mov                 ecx, eax
            //   488b5c2430           | inc                 esp
            //   48894720             | mov                 dword ptr [esp + 0x28], eax

    condition:
        7 of them and filesize < 742400
}