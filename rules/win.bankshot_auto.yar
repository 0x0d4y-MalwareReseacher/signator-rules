rule win_bankshot_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-04-08"
        version = "1"
        description = "Describes win.bankshot."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.bankshot"
        malpedia_rule_date = "20220405"
        malpedia_hash = "ecd38294bd47d5589be5cd5490dc8bb4804afc2a"
        malpedia_version = ""
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 55 8bec 81ec48040000 a1???????? 33c5 8945f8 53 }
            // n = 7, score = 300
            //   55                   | nop                 word ptr [eax + eax]
            //   8bec                 | shr                 eax, 0x10
            //   81ec48040000         | shr                 edx, 0x18
            //   a1????????           |                     
            //   33c5                 | xor                 dl, al
            //   8945f8               | inc                 ecx
            //   53                   | mov                 eax, eax

        $sequence_1 = { 8bf8 8d5101 8a01 41 84c0 75f9 57 }
            // n = 7, score = 300
            //   8bf8                 | dec                 ecx
            //   8d5101               | mov                 dword ptr [edx + 0x6aff0], eax
            //   8a01                 | dec                 ecx
            //   41                   | arpl                ax, ax
            //   84c0                 | inc                 edx
            //   75f9                 | movzx               ecx, byte ptr [eax + edx + 0x1b71]
            //   57                   | dec                 eax

        $sequence_2 = { 8d90c4e10110 5f 668b02 8d5202 }
            // n = 4, score = 200
            //   8d90c4e10110         | lea                 edx, dword ptr [edx + 2]
            //   5f                   | mov                 word ptr [ecx], ax
            //   668b02               | lea                 ecx, dword ptr [ecx + 2]
            //   8d5202               | lea                 eax, dword ptr [eax + 0x1001e1d0]

        $sequence_3 = { 8d80d0e10110 8945e4 803800 8bc8 }
            // n = 4, score = 200
            //   8d80d0e10110         | mov                 dword ptr [ebp - 0x20], eax
            //   8945e4               | lea                 eax, dword ptr [eax + 0x1001e1d0]
            //   803800               | mov                 dword ptr [ebp - 0x1c], eax
            //   8bc8                 | cmp                 byte ptr [eax], 0

        $sequence_4 = { 0f280d???????? 8bf2 2bf1 0f108405e4bfffff 660fefc1 }
            // n = 5, score = 200
            //   0f280d????????       |                     
            //   8bf2                 | xor                 eax, ebp
            //   2bf1                 | mov                 dword ptr [ebp - 8], eax
            //   0f108405e4bfffff     | push                ebx
            //   660fefc1             | mov                 ebp, esp

        $sequence_5 = { 8b4508 898850030000 8b4508 59 c74048b8e40110 }
            // n = 5, score = 200
            //   8b4508               | push                6
            //   898850030000         | lea                 edx, dword ptr [eax + 0x1001e1c4]
            //   8b4508               | pop                 edi
            //   59                   | mov                 ax, word ptr [edx]
            //   c74048b8e40110       | movzx               eax, al

        $sequence_6 = { 0f8e9d010000 83fa20 7248 251f000080 7905 48 83c8e0 }
            // n = 7, score = 200
            //   0f8e9d010000         | test                ebx, ebx
            //   83fa20               | jne                 9
            //   7248                 | mov                 dword ptr [esi + 0x34], 0x10017b0c
            //   251f000080           | push                edi
            //   7905                 | push                ebp
            //   48                   | mov                 ebp, esp
            //   83c8e0               | sub                 esp, 0x448

        $sequence_7 = { c74048b8e40110 8b4508 6689486c 8b4508 66898872010000 8b4508 83a04c03000000 }
            // n = 7, score = 200
            //   c74048b8e40110       | inc                 edx
            //   8b4508               | cmp                 dword ptr [eax + 0x1001e1c0], ebx
            //   6689486c             | je                  0xf0
            //   8b4508               | inc                 ecx
            //   66898872010000       | add                 eax, 0x30
            //   8b4508               | mov                 dword ptr [ebp - 0x1c], ecx
            //   83a04c03000000       | cmp                 eax, 0xf0

        $sequence_8 = { 33c9 85d2 7e5f 83fa20 7247 }
            // n = 5, score = 200
            //   33c9                 | push                edi
            //   85d2                 | jle                 0x1a3
            //   7e5f                 | cmp                 edx, 0x20
            //   83fa20               | jb                  0x4a
            //   7247                 | and                 eax, 0x8000001f

        $sequence_9 = { b801000000 0f44f8 eb02 33ff 8b8508b9ffff }
            // n = 5, score = 200
            //   b801000000           | lea                 edx, dword ptr [ecx + 1]
            //   0f44f8               | mov                 al, byte ptr [ecx]
            //   eb02                 | inc                 ecx
            //   33ff                 | test                al, al
            //   8b8508b9ffff         | jne                 3

        $sequence_10 = { 50 e8???????? 83c40c 8d85acbaffff 33ff 6828050000 }
            // n = 6, score = 200
            //   50                   | sub                 esp, 0x448
            //   e8????????           |                     
            //   83c40c               | xor                 eax, ebp
            //   8d85acbaffff         | mov                 dword ptr [ebp - 8], eax
            //   33ff                 | push                ebx
            //   6828050000           | sub                 esp, 0x448

        $sequence_11 = { e9???????? 57 33ff 8bcf 8bc7 894de4 3998c0e10110 }
            // n = 7, score = 200
            //   e9????????           |                     
            //   57                   | push                dword ptr [eax + 0xc]
            //   33ff                 | push                0x2150
            //   8bcf                 | mov                 esi, eax
            //   8bc7                 | lea                 eax, dword ptr [esp + 0x15c4]
            //   894de4               | push                0
            //   3998c0e10110         | add                 eax, dword ptr [ebp - 0x10]

        $sequence_12 = { 7515 8b45fc 817848b8e40110 7409 ff7048 e8???????? 59 }
            // n = 7, score = 200
            //   7515                 | push                eax
            //   8b45fc               | jmp                 0x3e
            //   817848b8e40110       | lock xadd           dword ptr [eax], ebx
            //   7409                 | dec                 ebx
            //   ff7048               | jne                 0x18
            //   e8????????           |                     
            //   59                   | mov                 eax, dword ptr [ebp - 4]

        $sequence_13 = { eb17 81fa00010000 7313 8a87bce10110 08441619 42 0fb64101 }
            // n = 7, score = 200
            //   eb17                 | cmp                 dword ptr [eax + 0x48], 0x1001e4b8
            //   81fa00010000         | je                  0xb
            //   7313                 | push                dword ptr [eax + 0x48]
            //   8a87bce10110         | movzx               edx, byte ptr [ecx]
            //   08441619             | movzx               eax, al
            //   42                   | jmp                 0x19
            //   0fb64101             | cmp                 edx, 0x100

        $sequence_14 = { e8???????? 83c40c e8???????? 99 b907000000 }
            // n = 5, score = 200
            //   e8????????           |                     
            //   83c40c               | push                eax
            //   e8????????           |                     
            //   99                   | add                 esp, 0xc
            //   b907000000           | lea                 eax, dword ptr [ebp - 0x4554]

        $sequence_15 = { 50 e8???????? 83c40c 6b45e430 8945e0 8d80d0e10110 8945e4 }
            // n = 7, score = 200
            //   50                   | jae                 0x15
            //   e8????????           |                     
            //   83c40c               | mov                 al, byte ptr [edi + 0x1001e1bc]
            //   6b45e430             | or                  byte ptr [esi + edx + 0x19], al
            //   8945e0               | mov                 dword ptr [eax + 0x48], 0x1001e4b8
            //   8d80d0e10110         | mov                 eax, dword ptr [ebp + 8]
            //   8945e4               | mov                 word ptr [eax + 0x6c], cx

        $sequence_16 = { 8bf0 8d5101 90 8a01 }
            // n = 4, score = 200
            //   8bf0                 | xor                 eax, ebp
            //   8d5101               | mov                 dword ptr [ebp - 8], eax
            //   90                   | push                ebx
            //   8a01                 | mov                 edi, eax

        $sequence_17 = { 0fbe02 83c009 8b8df8fbffff 8801 }
            // n = 4, score = 100
            //   0fbe02               | mov                 eax, dword ptr [eax*4 + 0x421c40]
            //   83c009               | push                0
            //   8b8df8fbffff         | push                0
            //   8801                 | mov                 dword ptr [esp + 0x24], eax

        $sequence_18 = { 50 ff95ccf3ffff 89470c 8b470c 85c0 743f }
            // n = 6, score = 100
            //   50                   | push                ebx
            //   ff95ccf3ffff         | push                ecx
            //   89470c               | lea                 eax, dword ptr [ebp - 0x24]
            //   8b470c               | push                eax
            //   85c0                 | push                0
            //   743f                 | push                0xfde9

        $sequence_19 = { 2b8534feffff 3dd0070000 7307 33c0 }
            // n = 4, score = 100
            //   2b8534feffff         | mov                 dword ptr [esp + 0x10], eax
            //   3dd0070000           | add                 esp, 0xc
            //   7307                 | cdq                 
            //   33c0                 | mov                 ecx, 7

        $sequence_20 = { 51 8d45dc 50 6a00 68e9fd0000 ffd3 33c0 }
            // n = 7, score = 100
            //   51                   | inc                 edx
            //   8d45dc               | movzx               edx, byte ptr [edi + ebp]
            //   50                   | dec                 eax
            //   6a00                 | lea                 ecx, dword ptr [0x7bc4]
            //   68e9fd0000           | push                ebp
            //   ffd3                 | mov                 ebp, esp
            //   33c0                 | sub                 esp, 0x448

        $sequence_21 = { c1e810 c1ea18 32d0 418bc0 c1e808 }
            // n = 5, score = 100
            //   c1e810               | mov                 ecx, esi
            //   c1ea18               | dec                 ecx
            //   32d0                 | inc                 ebx
            //   418bc0               | inc                 ecx
            //   c1e808               | cmp                 byte ptr [ebx], 0

        $sequence_22 = { 8bd8 0fbaf31f 3bdf 7325 }
            // n = 4, score = 100
            //   8bd8                 | dec                 eax
            //   0fbaf31f             | add                 eax, 4
            //   3bdf                 | inc                 ecx
            //   7325                 | inc                 ebx

        $sequence_23 = { 49ffc3 41803b00 75df 488d542420 488bcb ff15???????? 488d1512ee0000 }
            // n = 7, score = 100
            //   49ffc3               | mov                 eax, dword ptr [ebx]
            //   41803b00             | dec                 eax
            //   75df                 | test                eax, eax
            //   488d542420           | je                  0xc
            //   488bcb               | call                eax
            //   ff15????????         |                     
            //   488d1512ee0000       | dec                 eax

        $sequence_24 = { 51 e8???????? 83c41c 85c0 0f84d7000000 6a02 55 }
            // n = 7, score = 100
            //   51                   | mov                 dword ptr [ebp - 0xc010], esi
            //   e8????????           |                     
            //   83c41c               | push                0x10
            //   85c0                 | push                eax
            //   0f84d7000000         | push                0x15
            //   6a02                 | add                 esp, 0xc
            //   55                   | cdq                 

        $sequence_25 = { 66898c4570f2ffff 8d8570f2ffff 50 8b855cf2ffff ff700c }
            // n = 5, score = 100
            //   66898c4570f2ffff     | xor                 eax, ebp
            //   8d8570f2ffff         | mov                 dword ptr [ebp - 8], eax
            //   50                   | push                ebx
            //   8b855cf2ffff         | mov                 edi, eax
            //   ff700c               | lea                 edx, dword ptr [ecx + 1]

        $sequence_26 = { 85c0 0f8411010000 8b4c2414 8d442410 }
            // n = 4, score = 100
            //   85c0                 | jb                  0x49
            //   0f8411010000         | lea                 ecx, dword ptr [ebp - 0xc544]
            //   8b4c2414             | mov                 dword ptr [ebp - 0xc018], edi
            //   8d442410             | mov                 dword ptr [ebp - 0xc01c], 4

        $sequence_27 = { ff15???????? 488d15cae70000 488d4c2420 488905???????? ff15???????? 807c242000 4c8d5c2420 }
            // n = 7, score = 100
            //   ff15????????         |                     
            //   488d15cae70000       | dec                 eax
            //   488d4c2420           | lea                 edx, dword ptr [0xe7ca]
            //   488905????????       |                     
            //   ff15????????         |                     
            //   807c242000           | dec                 eax
            //   4c8d5c2420           | lea                 ecx, dword ptr [esp + 0x20]

        $sequence_28 = { 8d44240c 8d4c2420 50 51 6802000080 }
            // n = 5, score = 100
            //   8d44240c             | add                 esp, 0xc
            //   8d4c2420             | cdq                 
            //   50                   | mov                 ecx, 7
            //   51                   | idiv                ecx
            //   6802000080           | add                 esp, 0xc

        $sequence_29 = { 8a5408ff 8a1c08 32da 881c08 48 83f801 7dee }
            // n = 7, score = 100
            //   8a5408ff             | cdq                 
            //   8a1c08               | mov                 ecx, 7
            //   32da                 | idiv                ecx
            //   881c08               | lea                 eax, dword ptr [eax + eax*4]
            //   48                   | lea                 edx, dword ptr [eax + eax*4]
            //   83f801               | lea                 eax, dword ptr [esp + 0xc]
            //   7dee                 | shl                 edx, 5

        $sequence_30 = { 750c 4883c004 41ffc3 483bc3 }
            // n = 4, score = 100
            //   750c                 | cmp                 byte ptr [esp + 0x20], 0
            //   4883c004             | dec                 esp
            //   41ffc3               | lea                 ebx, dword ptr [esp + 0x20]
            //   483bc3               | jne                 0xe

        $sequence_31 = { 0f868dfeffff 803d????????55 488d3dbf870000 0f85b9faffff 660f1f840000000000 }
            // n = 5, score = 100
            //   0f868dfeffff         | add                 ebx, 8
            //   803d????????55       |                     
            //   488d3dbf870000       | je                  0x6a
            //   0f85b9faffff         | mov                 edx, 0x100
            //   660f1f840000000000     | dec    eax

        $sequence_32 = { 80f91e 720e 488d05a8a40000 498982f0af0600 4963c0 420fb68c10711b0000 4863c2 }
            // n = 7, score = 100
            //   80f91e               | jne                 0xffffffe5
            //   720e                 | dec                 eax
            //   488d05a8a40000       | lea                 edx, dword ptr [esp + 0x20]
            //   498982f0af0600       | dec                 eax
            //   4963c0               | mov                 ecx, ebx
            //   420fb68c10711b0000     | dec    eax
            //   4863c2               | lea                 edx, dword ptr [0xee12]

        $sequence_33 = { ff15???????? ffb5b8fbffff 8b35???????? 8d85c4fcffff 50 ffd6 8d45f0 }
            // n = 7, score = 100
            //   ff15????????         |                     
            //   ffb5b8fbffff         | xor                 eax, ebp
            //   8b35????????         |                     
            //   8d85c4fcffff         | mov                 dword ptr [ebp - 8], eax
            //   50                   | push                ebx
            //   ffd6                 | mov                 ebp, esp
            //   8d45f0               | sub                 esp, 0x448

        $sequence_34 = { 6850210000 8bf0 8d8424c4150000 6a00 }
            // n = 4, score = 100
            //   6850210000           | mov                 al, byte ptr [ecx]
            //   8bf0                 | inc                 ecx
            //   8d8424c4150000       | test                al, al
            //   6a00                 | jne                 3

        $sequence_35 = { 7416 8bc1 8bd1 c1f805 83e21f 8b0485401c4200 }
            // n = 6, score = 100
            //   7416                 | test                eax, eax
            //   8bc1                 | je                  0x117
            //   8bd1                 | mov                 ecx, dword ptr [esp + 0x14]
            //   c1f805               | lea                 eax, dword ptr [esp + 0x10]
            //   83e21f               | push                ecx
            //   8b0485401c4200       | add                 esp, 0x1c

        $sequence_36 = { 50 51 6a0c 8bce e8???????? }
            // n = 5, score = 100
            //   50                   | mov                 ecx, 7
            //   51                   | add                 esp, 0xc
            //   6a0c                 | cdq                 
            //   8bce                 | mov                 ecx, 7
            //   e8????????           |                     

        $sequence_37 = { 894de8 894dec 894df0 894df4 894df8 837dd8ff }
            // n = 6, score = 100
            //   894de8               | add                 esp, 0xc
            //   894dec               | cdq                 
            //   894df0               | mov                 ecx, 7
            //   894df4               | idiv                ecx
            //   894df8               | add                 esp, 0xc
            //   837dd8ff             | cdq                 

        $sequence_38 = { 7468 ba00010000 488bce ff15???????? }
            // n = 4, score = 100
            //   7468                 | lea                 edi, dword ptr [0xb14]
            //   ba00010000           | jmp                 0x10
            //   488bce               | dec                 eax
            //   ff15????????         |                     

        $sequence_39 = { 0345f0 be02000000 c745f800000000 8945e4 }
            // n = 4, score = 100
            //   0345f0               | push                edi
            //   be02000000           | sub                 esp, 0x448
            //   c745f800000000       | xor                 eax, ebp
            //   8945e4               | mov                 dword ptr [ebp - 8], eax

        $sequence_40 = { ff15???????? ebc5 8b4dd8 51 ff15???????? }
            // n = 5, score = 100
            //   ff15????????         |                     
            //   ebc5                 | cmp                 eax, 1
            //   8b4dd8               | jge                 0xfffffff4
            //   51                   | je                  0x18
            //   ff15????????         |                     

        $sequence_41 = { 8d0480 8d1480 8d44240c c1e205 }
            // n = 4, score = 100
            //   8d0480               | xor                 ecx, ecx
            //   8d1480               | test                edx, edx
            //   8d44240c             | jle                 0x61
            //   c1e205               | cmp                 edx, 0x20

        $sequence_42 = { c1ff06 6bd030 897df0 8b04bdc8887100 8955e8 }
            // n = 5, score = 100
            //   c1ff06               | jmp                 0xffffffc7
            //   6bd030               | mov                 ecx, dword ptr [ebp - 0x28]
            //   897df0               | push                ecx
            //   8b04bdc8887100       | rep movsd           dword ptr es:[edi], dword ptr [esi]
            //   8955e8               | movsw               word ptr es:[edi], word ptr [esi]

        $sequence_43 = { f3a5 66a5 c705????????06000000 b801000000 5f }
            // n = 5, score = 100
            //   f3a5                 | mov                 eax, ecx
            //   66a5                 | mov                 edx, ecx
            //   c705????????06000000     |     
            //   b801000000           | sar                 eax, 5
            //   5f                   | and                 edx, 0x1f

        $sequence_44 = { 8b0c8dc8887100 c644112800 85f6 740c 56 e8???????? }
            // n = 6, score = 100
            //   8b0c8dc8887100       | mov                 ecx, 7
            //   c644112800           | idiv                ecx
            //   85f6                 | add                 esp, 0xc
            //   740c                 | cdq                 
            //   56                   | mov                 ecx, 7
            //   e8????????           |                     

    condition:
        7 of them and filesize < 860160
}