rule win_komprogo_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.komprogo."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.komprogo"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 899614b80300 89be48410000 8d8e34700300 898e18490000 8d8660b30300 898680b30300 8d8674700300 }
            // n = 7, score = 100
            //   899614b80300         | mov                 dword ptr [esi + 0x3b814], edx
            //   89be48410000         | mov                 dword ptr [esi + 0x4148], edi
            //   8d8e34700300         | lea                 ecx, [esi + 0x37034]
            //   898e18490000         | mov                 dword ptr [esi + 0x4918], ecx
            //   8d8660b30300         | lea                 eax, [esi + 0x3b360]
            //   898680b30300         | mov                 dword ptr [esi + 0x3b380], eax
            //   8d8674700300         | lea                 eax, [esi + 0x37074]

        $sequence_1 = { 8d96ec710300 899615a60000 8d96e8710300 89962ca60000 8d96e4710300 89965aa60000 }
            // n = 6, score = 100
            //   8d96ec710300         | lea                 edx, [esi + 0x371ec]
            //   899615a60000         | mov                 dword ptr [esi + 0xa615], edx
            //   8d96e8710300         | lea                 edx, [esi + 0x371e8]
            //   89962ca60000         | mov                 dword ptr [esi + 0xa62c], edx
            //   8d96e4710300         | lea                 edx, [esi + 0x371e4]
            //   89965aa60000         | mov                 dword ptr [esi + 0xa65a], edx

        $sequence_2 = { 8d968c720300 8996f7150000 8d96b0600300 899699780000 8d96b82c0400 8996f58a0200 8d96a4700300 }
            // n = 7, score = 100
            //   8d968c720300         | lea                 edx, [esi + 0x3728c]
            //   8996f7150000         | mov                 dword ptr [esi + 0x15f7], edx
            //   8d96b0600300         | lea                 edx, [esi + 0x360b0]
            //   899699780000         | mov                 dword ptr [esi + 0x7899], edx
            //   8d96b82c0400         | lea                 edx, [esi + 0x42cb8]
            //   8996f58a0200         | mov                 dword ptr [esi + 0x28af5], edx
            //   8d96a4700300         | lea                 edx, [esi + 0x370a4]

        $sequence_3 = { 8d8e3c710300 898e79510200 8d8e28390400 898e7bde0200 8d9640490400 899688de0200 898e94de0200 }
            // n = 7, score = 100
            //   8d8e3c710300         | lea                 ecx, [esi + 0x3713c]
            //   898e79510200         | mov                 dword ptr [esi + 0x25179], ecx
            //   8d8e28390400         | lea                 ecx, [esi + 0x43928]
            //   898e7bde0200         | mov                 dword ptr [esi + 0x2de7b], ecx
            //   8d9640490400         | lea                 edx, [esi + 0x44940]
            //   899688de0200         | mov                 dword ptr [esi + 0x2de88], edx
            //   898e94de0200         | mov                 dword ptr [esi + 0x2de94], ecx

        $sequence_4 = { 8d86ac950300 89867b590000 8d860c390400 8986d6e40000 8d969c710300 899694b00200 898635e50000 }
            // n = 7, score = 100
            //   8d86ac950300         | lea                 eax, [esi + 0x395ac]
            //   89867b590000         | mov                 dword ptr [esi + 0x597b], eax
            //   8d860c390400         | lea                 eax, [esi + 0x4390c]
            //   8986d6e40000         | mov                 dword ptr [esi + 0xe4d6], eax
            //   8d969c710300         | lea                 edx, [esi + 0x3719c]
            //   899694b00200         | mov                 dword ptr [esi + 0x2b094], edx
            //   898635e50000         | mov                 dword ptr [esi + 0xe535], eax

        $sequence_5 = { 8d8653600000 8986f4b50300 8d8ee8b50300 898e08b60300 8d96b8b50300 899614b60300 8d86f8b50300 }
            // n = 7, score = 100
            //   8d8653600000         | lea                 eax, [esi + 0x6053]
            //   8986f4b50300         | mov                 dword ptr [esi + 0x3b5f4], eax
            //   8d8ee8b50300         | lea                 ecx, [esi + 0x3b5e8]
            //   898e08b60300         | mov                 dword ptr [esi + 0x3b608], ecx
            //   8d96b8b50300         | lea                 edx, [esi + 0x3b5b8]
            //   899614b60300         | mov                 dword ptr [esi + 0x3b614], edx
            //   8d86f8b50300         | lea                 eax, [esi + 0x3b5f8]

        $sequence_6 = { 898658e70300 8d8e596c0300 898e06110000 8d96f8910300 }
            // n = 4, score = 100
            //   898658e70300         | mov                 dword ptr [esi + 0x3e758], eax
            //   8d8e596c0300         | lea                 ecx, [esi + 0x36c59]
            //   898e06110000         | mov                 dword ptr [esi + 0x1106], ecx
            //   8d96f8910300         | lea                 edx, [esi + 0x391f8]

        $sequence_7 = { 8d863c710300 89865c390200 8d86c8970300 898666390200 8d8e40710300 898e74390200 8d8ea82f0400 }
            // n = 7, score = 100
            //   8d863c710300         | lea                 eax, [esi + 0x3713c]
            //   89865c390200         | mov                 dword ptr [esi + 0x2395c], eax
            //   8d86c8970300         | lea                 eax, [esi + 0x397c8]
            //   898666390200         | mov                 dword ptr [esi + 0x23966], eax
            //   8d8e40710300         | lea                 ecx, [esi + 0x37140]
            //   898e74390200         | mov                 dword ptr [esi + 0x23974], ecx
            //   8d8ea82f0400         | lea                 ecx, [esi + 0x42fa8]

        $sequence_8 = { 8986acc10300 8d9690ad0300 8996d4ad0300 8d86902f0400 8986eb8d0200 8d8630710300 }
            // n = 6, score = 100
            //   8986acc10300         | mov                 dword ptr [esi + 0x3c1ac], eax
            //   8d9690ad0300         | lea                 edx, [esi + 0x3ad90]
            //   8996d4ad0300         | mov                 dword ptr [esi + 0x3add4], edx
            //   8d86902f0400         | lea                 eax, [esi + 0x42f90]
            //   8986eb8d0200         | mov                 dword ptr [esi + 0x28deb], eax
            //   8d8630710300         | lea                 eax, [esi + 0x37130]

        $sequence_9 = { 895df0 85f6 7424 8b4d0c 8b11 8b45e8 52 }
            // n = 7, score = 100
            //   895df0               | mov                 dword ptr [ebp - 0x10], ebx
            //   85f6                 | test                esi, esi
            //   7424                 | je                  0x26
            //   8b4d0c               | mov                 ecx, dword ptr [ebp + 0xc]
            //   8b11                 | mov                 edx, dword ptr [ecx]
            //   8b45e8               | mov                 eax, dword ptr [ebp - 0x18]
            //   52                   | push                edx

    condition:
        7 of them and filesize < 1045504
}