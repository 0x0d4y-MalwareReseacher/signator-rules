rule win_kingminer_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-04-08"
        version = "1"
        description = "Describes win.kingminer."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.kingminer"
        malpedia_rule_date = "20220405"
        malpedia_hash = "ecd38294bd47d5589be5cd5490dc8bb4804afc2a"
        malpedia_version = ""
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 50 885df6 56 bb0e000000 }
            // n = 4, score = 100
            //   50                   | push                eax
            //   885df6               | mov                 byte ptr [ebp - 0xa], bl
            //   56                   | push                esi
            //   bb0e000000           | mov                 ebx, 0xe

        $sequence_1 = { 0fb75714 8d4c3a24 85c0 7429 }
            // n = 4, score = 100
            //   0fb75714             | movzx               edx, word ptr [edi + 0x14]
            //   8d4c3a24             | lea                 ecx, dword ptr [edx + edi + 0x24]
            //   85c0                 | test                eax, eax
            //   7429                 | je                  0x2b

        $sequence_2 = { 57 ff15???????? 57 ff15???????? 6a01 ff15???????? 57 }
            // n = 7, score = 100
            //   57                   | push                edi
            //   ff15????????         |                     
            //   57                   | push                edi
            //   ff15????????         |                     
            //   6a01                 | push                1
            //   ff15????????         |                     
            //   57                   | push                edi

        $sequence_3 = { 0bc7 5f 8b4dfc 33cd }
            // n = 4, score = 100
            //   0bc7                 | or                  eax, edi
            //   5f                   | pop                 edi
            //   8b4dfc               | mov                 ecx, dword ptr [ebp - 4]
            //   33cd                 | xor                 ecx, ebp

        $sequence_4 = { ba4d5a0000 663910 0f8523020000 56 }
            // n = 4, score = 100
            //   ba4d5a0000           | mov                 edx, 0x5a4d
            //   663910               | cmp                 word ptr [eax], dx
            //   0f8523020000         | jne                 0x229
            //   56                   | push                esi

        $sequence_5 = { 817de08cc10010 7311 8b45e0 8b00 85c0 7402 ffd0 }
            // n = 7, score = 100
            //   817de08cc10010       | cmp                 dword ptr [ebp - 0x20], 0x1000c18c
            //   7311                 | jae                 0x13
            //   8b45e0               | mov                 eax, dword ptr [ebp - 0x20]
            //   8b00                 | mov                 eax, dword ptr [eax]
            //   85c0                 | test                eax, eax
            //   7402                 | je                  4
            //   ffd0                 | call                eax

        $sequence_6 = { 03c8 8d543112 eb5c 8d45cc 50 56 }
            // n = 6, score = 100
            //   03c8                 | add                 ecx, eax
            //   8d543112             | lea                 edx, dword ptr [ecx + esi + 0x12]
            //   eb5c                 | jmp                 0x5e
            //   8d45cc               | lea                 eax, dword ptr [ebp - 0x34]
            //   50                   | push                eax
            //   56                   | push                esi

        $sequence_7 = { 8b15???????? c64432ff62 a1???????? 885c30fe a1???????? 0fb64c30f9 }
            // n = 6, score = 100
            //   8b15????????         |                     
            //   c64432ff62           | mov                 byte ptr [edx + esi - 1], 0x62
            //   a1????????           |                     
            //   885c30fe             | mov                 byte ptr [eax + esi - 2], bl
            //   a1????????           |                     
            //   0fb64c30f9           | movzx               ecx, byte ptr [eax + esi - 7]

        $sequence_8 = { 8b4d08 8b11 8b45f8 0fb74a06 40 83c628 897dec }
            // n = 7, score = 100
            //   8b4d08               | mov                 ecx, dword ptr [ebp + 8]
            //   8b11                 | mov                 edx, dword ptr [ecx]
            //   8b45f8               | mov                 eax, dword ptr [ebp - 8]
            //   0fb74a06             | movzx               ecx, word ptr [edx + 6]
            //   40                   | inc                 eax
            //   83c628               | add                 esi, 0x28
            //   897dec               | mov                 dword ptr [ebp - 0x14], edi

        $sequence_9 = { ff15???????? 6a00 ff15???????? c3 a1???????? 3b05???????? 0f8d8e010000 }
            // n = 7, score = 100
            //   ff15????????         |                     
            //   6a00                 | push                0
            //   ff15????????         |                     
            //   c3                   | ret                 
            //   a1????????           |                     
            //   3b05????????         |                     
            //   0f8d8e010000         | jge                 0x194

    condition:
        7 of them and filesize < 165888
}