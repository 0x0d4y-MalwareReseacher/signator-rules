rule win_cur1_downloader_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.cur1_downloader."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.cur1_downloader"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 48630424 488b4c2430 0fb60401 8944240c 4863442408 48630c24 488b542430 }
            // n = 7, score = 100
            //   48630424             | mov                 byte ptr [esp + 0x320], 0x49
            //   488b4c2430           | mov                 byte ptr [esp + 0x321], 0x6e
            //   0fb60401             | mov                 byte ptr [esp + 0x322], 0x74
            //   8944240c             | mov                 byte ptr [esp + 0x323], 0x65
            //   4863442408           | mov                 byte ptr [esp + 0x357], 0x49
            //   48630c24             | mov                 byte ptr [esp + 0x358], 0x64
            //   488b542430           | mov                 byte ptr [esp + 0x359], 0x54

        $sequence_1 = { c68424d601000061 c68424d701000074 c68424d801000065 c68424d90100004b }
            // n = 4, score = 100
            //   c68424d601000061     | dec                 eax
            //   c68424d701000074     | add                 edx, ecx
            //   c68424d801000065     | sub                 eax, 0x40
            //   c68424d90100004b     | mov                 dword ptr [esp + 0x54], eax

        $sequence_2 = { 33c0 4883c410 5b c3 4883ec38 488d05c5a90000 }
            // n = 6, score = 100
            //   33c0                 | mov                 byte ptr [esp + 0x189], 0x6c
            //   4883c410             | mov                 byte ptr [esp + 0x18a], 0x6f
            //   5b                   | mov                 byte ptr [esp + 0x18b], 0x63
            //   c3                   | mov                 byte ptr [esp + 0x287], 0x73
            //   4883ec38             | mov                 byte ptr [esp + 0x288], 0
            //   488d05c5a90000       | mov                 byte ptr [esp + 0x1f0], 0x47

        $sequence_3 = { 410fb60a 83e10f 4a0fbe841900e40100 428a8c1910e40100 4c2bd0 418b4048 418b52fc }
            // n = 7, score = 100
            //   410fb60a             | mov                 byte ptr [esp + 0x43], 0x70
            //   83e10f               | mov                 byte ptr [esp + 0x44], 0x69
            //   4a0fbe841900e40100     | mov    byte ptr [esp + 0x45], 0x2e
            //   428a8c1910e40100     | mov                 byte ptr [esp + 0x46], 0x64
            //   4c2bd0               | mov                 byte ptr [esp + 0x47], 0x6c
            //   418b4048             | mov                 byte ptr [esp + 0x43], 0x39
            //   418b52fc             | mov                 byte ptr [esp + 0x44], 0x62

        $sequence_4 = { c684242804000051 c684242904000075 c684242a04000065 c684242b04000072 c684242c04000079 c684242d04000044 c684242e04000061 }
            // n = 7, score = 100
            //   c684242804000051     | dec                 eax
            //   c684242904000075     | mov                 ecx, dword ptr [esp + 0xb0]
            //   c684242a04000065     | dec                 eax
            //   c684242b04000072     | cmp                 dword ptr [esp + 0xb8], 0
            //   c684242c04000079     | dec                 eax
            //   c684242d04000044     | mov                 ecx, dword ptr [esp + 0xb0]
            //   c684242e04000061     | dec                 eax

        $sequence_5 = { 83e841 6bc01a 8b0c24 488b542420 0fb60c0a 8d4408bf 8b0c24 }
            // n = 7, score = 100
            //   83e841               | dec                 eax
            //   6bc01a               | mov                 dword ptr [esp + 0x20], eax
            //   8b0c24               | dec                 eax
            //   488b542420           | mov                 eax, dword ptr [esp + 0x28]
            //   0fb60c0a             | dec                 eax
            //   8d4408bf             | add                 eax, 8
            //   8b0c24               | dec                 eax

        $sequence_6 = { 668984249a000000 b84d000000 668984249c000000 b870000000 668984249e000000 b845000000 66898424a0000000 }
            // n = 7, score = 100
            //   668984249a000000     | mov                 eax, eax
            //   b84d000000           | dec                 eax
            //   668984249c000000     | lea                 edx, [esp + 0xd0]
            //   b870000000           | dec                 eax
            //   668984249e000000     | mov                 ecx, dword ptr [esp + 0x518]
            //   b845000000           | dec                 eax
            //   66898424a0000000     | mov                 eax, dword ptr [esp + 0x518]

        $sequence_7 = { e9???????? 48c744243000000000 c744242800000000 c744242003000000 4533c9 41b801000000 ba00000080 }
            // n = 7, score = 100
            //   e9????????           |                     
            //   48c744243000000000     | dec    ecx
            //   c744242800000000     | add                 edx, eax
            //   c744242003000000     | dec                 esp
            //   4533c9               | lea                 eax, [0xffff484c]
            //   41b801000000         | dec                 eax
            //   ba00000080           | mov                 dword ptr [ecx + 8], edx

        $sequence_8 = { c684244601000078 c684244701000065 c684244801000063 c684244901000075 c684244a01000074 c684244b01000065 c684244c01000057 }
            // n = 7, score = 100
            //   c684244601000078     | dec                 eax
            //   c684244701000065     | mov                 eax, ecx
            //   c684244801000063     | mov                 ecx, 4
            //   c684244901000075     | dec                 eax
            //   c684244a01000074     | imul                ecx, ecx, 2
            //   c684244b01000065     | dec                 eax
            //   c684244c01000057     | arpl                word ptr [eax + ecx], ax

        $sequence_9 = { 7528 48833d????????00 741e 488d0dd8450100 e8???????? 85c0 740e }
            // n = 7, score = 100
            //   7528                 | mov                 ecx, dword ptr [esp + 0x28]
            //   48833d????????00     |                     
            //   741e                 | dec                 eax
            //   488d0dd8450100       | lea                 edx, [esp + 0x400]
            //   e8????????           |                     
            //   85c0                 | dec                 eax
            //   740e                 | mov                 ecx, dword ptr [esp + 0x20]

    condition:
        7 of them and filesize < 402432
}