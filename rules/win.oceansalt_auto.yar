rule win_oceansalt_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-11-21"
        version = "1"
        description = "Detects win.oceansalt."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.oceansalt"
        malpedia_rule_date = "20221118"
        malpedia_hash = "e0702e2e6d1d00da65c8a29a4ebacd0a4c59e1af"
        malpedia_version = "20221125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 0fb785eefbffff 51 52 50 8d8dfcfdffff 68???????? 51 }
            // n = 7, score = 300
            //   0fb785eefbffff       | push                eax
            //   51                   | push                esi
            //   52                   | call                ebx
            //   50                   | cmp                 eax, -1
            //   8d8dfcfdffff         | je                  0x5c
            //   68????????           |                     
            //   51                   | lea                 edx, [ebp - 0x403]

        $sequence_1 = { 40 3bc1 7cf3 56 51 }
            // n = 5, score = 300
            //   40                   | push                edi
            //   3bc1                 | push                eax
            //   7cf3                 | push                edi
            //   56                   | push                0x400
            //   51                   | lea                 eax, [ebp - 0x404]

        $sequence_2 = { 8d85ccfdffff 50 51 e8???????? 85c0 }
            // n = 5, score = 300
            //   8d85ccfdffff         | dec                 eax
            //   50                   | lea                 ecx, [esp + 0x70]
            //   51                   | xor                 edx, edx
            //   e8????????           |                     
            //   85c0                 | dec                 esp

        $sequence_3 = { 52 57 50 ff15???????? 57 ff15???????? }
            // n = 6, score = 300
            //   52                   | mov                 eax, 7
            //   57                   | jb                  0x3c
            //   50                   | dec                 eax
            //   ff15????????         |                     
            //   57                   | lea                 eax, [0xe284]
            //   ff15????????         |                     

        $sequence_4 = { 50 ff15???????? 0fb795f8fbffff 0fb785f6fbffff 8d8dfcfbffff }
            // n = 5, score = 300
            //   50                   | lea                 edx, [esp + 0x358]
            //   ff15????????         |                     
            //   0fb795f8fbffff       | dec                 eax
            //   0fb785f6fbffff       | lea                 ecx, [esp + 0x350]
            //   8d8dfcfbffff         | inc                 ecx

        $sequence_5 = { 8d95fdfbffff 6a00 52 c685fcfbffff00 }
            // n = 4, score = 300
            //   8d95fdfbffff         | stosb               byte ptr es:[edi], al
            //   6a00                 | stosb               byte ptr es:[edi], al
            //   52                   | stosb               byte ptr es:[edi], al
            //   c685fcfbffff00       | sub                 cl, byte ptr [eax + 0x2b]

        $sequence_6 = { 6800040000 8d85fcfbffff 50 56 ffd3 83f8ff 7453 }
            // n = 7, score = 300
            //   6800040000           | dec                 eax
            //   8d85fcfbffff         | cmp                 ebx, eax
            //   50                   | ja                  0x33
            //   56                   | dec                 eax
            //   ffd3                 | mov                 edx, ebx
            //   83f8ff               | dec                 eax
            //   7453                 | mov                 eax, 0xaaaaaaab

        $sequence_7 = { 8d450c 50 51 8d95fcfbffff 6800020000 52 e8???????? }
            // n = 7, score = 300
            //   8d450c               | mov                 dword ptr [esp + 0x1110], ebx
            //   50                   | push                eax
            //   51                   | movzx               edx, word ptr [ebp - 0x408]
            //   8d95fcfbffff         | movzx               eax, word ptr [ebp - 0x40a]
            //   6800020000           | lea                 ecx, [ebp - 0x404]
            //   52                   | push                edx
            //   e8????????           |                     

        $sequence_8 = { 0f859d000000 ffc7 897c2424 488d056fbf0000 e9???????? ba58000000 8d4ac8 }
            // n = 7, score = 100
            //   0f859d000000         | jne                 0x34
            //   ffc7                 | cmp                 byte ptr [esi + 3], 0x74
            //   897c2424             | jne                 0x2e
            //   488d056fbf0000       | jne                 0xa3
            //   e9????????           |                     
            //   ba58000000           | inc                 edi
            //   8d4ac8               | mov                 dword ptr [esp + 0x24], edi

        $sequence_9 = { 753e 807e0178 7538 807e0269 7532 807e0374 752c }
            // n = 7, score = 100
            //   753e                 | jmp                 0x60
            //   807e0178             | dec                 ebx
            //   7538                 | mov                 eax, dword ptr [eax + esi*8 + 0x147a0]
            //   807e0269             | jne                 0x40
            //   7532                 | cmp                 byte ptr [esi + 1], 0x78
            //   807e0374             | jne                 0x3a
            //   752c                 | cmp                 byte ptr [esi + 2], 0x69

        $sequence_10 = { 7508 4863c2 4803d8 eb5e 4b8b84f0a0470100 }
            // n = 5, score = 100
            //   7508                 | jne                 0xa
            //   4863c2               | dec                 eax
            //   4803d8               | arpl                dx, ax
            //   eb5e                 | dec                 eax
            //   4b8b84f0a0470100     | add                 ebx, eax

        $sequence_11 = { 75ea f644246010 740d c78424a002000044495200 eb1c 33c9 0f1f4000 }
            // n = 7, score = 100
            //   75ea                 | lea                 ecx, [edx - 0x38]
            //   f644246010           | dec                 eax
            //   740d                 | mov                 edi, ecx
            //   c78424a002000044495200     | xor    ebp, ebp
            //   eb1c                 | dec                 eax
            //   33c9                 | mov                 dword ptr [esp + 0x30], ebp
            //   0f1f4000             | jne                 0xffffffec

        $sequence_12 = { 488bf9 ff15???????? 33ed 48896c2430 }
            // n = 4, score = 100
            //   488bf9               | dec                 eax
            //   ff15????????         |                     
            //   33ed                 | lea                 eax, [0xbf6f]
            //   48896c2430           | mov                 edx, 0x58

        $sequence_13 = { 723a 488d0584e20000 483bd8 772e 488bd3 48b8abaaaaaaaaaaaa2a 482bd1 }
            // n = 7, score = 100
            //   723a                 | lea                 edx, [0x37da]
            //   488d0584e20000       | dec                 eax
            //   483bd8               | mov                 ecx, esi
            //   772e                 | dec                 eax
            //   488bd3               | mov                 ecx, eax
            //   48b8abaaaaaaaaaaaa2a     | dec    eax
            //   482bd1               | lea                 edx, [esp + 0x350]

        $sequence_14 = { ff15???????? 488d942450030000 488d0d36be0000 e8???????? 488d942458030000 488d8c2450030000 41b807000000 }
            // n = 7, score = 100
            //   ff15????????         |                     
            //   488d942450030000     | xor                 ecx, ecx
            //   488d0d36be0000       | nop                 dword ptr [eax]
            //   e8????????           |                     
            //   488d942458030000     | dec                 eax
            //   488d8c2450030000     | mov                 ecx, eax
            //   41b807000000         | dec                 eax

        $sequence_15 = { 488bc8 e8???????? 488d15da370000 488bce 488905???????? ff15???????? 488bc8 }
            // n = 7, score = 100
            //   488bc8               | test                byte ptr [esp + 0x60], 0x10
            //   e8????????           |                     
            //   488d15da370000       | je                  0xf
            //   488bce               | mov                 dword ptr [esp + 0x2a0], 0x524944
            //   488905????????       |                     
            //   ff15????????         |                     
            //   488bc8               | jmp                 0x2b

    condition:
        7 of them and filesize < 212992
}