rule win_protonbot_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-04-08"
        version = "1"
        description = "Describes win.protonbot."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.protonbot"
        malpedia_rule_date = "20220405"
        malpedia_hash = "ecd38294bd47d5589be5cd5490dc8bb4804afc2a"
        malpedia_version = ""
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 56 0f1f440000 6a06 6a01 6a02 }
            // n = 5, score = 400
            //   56                   | push                esi
            //   0f1f440000           | nop                 dword ptr [eax + eax]
            //   6a06                 | push                6
            //   6a01                 | push                1
            //   6a02                 | push                2

        $sequence_1 = { 8b55e8 83fe10 c78550ecffff70020000 0f43c7 }
            // n = 4, score = 400
            //   8b55e8               | mov                 edx, dword ptr [ebp - 0x18]
            //   83fe10               | cmp                 esi, 0x10
            //   c78550ecffff70020000     | mov    dword ptr [ebp - 0x13b0], 0x270
            //   0f43c7               | cmovae              eax, edi

        $sequence_2 = { 8d4d20 6a00 0f434d20 8d4550 837d6410 6800000080 0f434550 }
            // n = 7, score = 400
            //   8d4d20               | lea                 ecx, dword ptr [ebp + 0x20]
            //   6a00                 | push                0
            //   0f434d20             | cmovae              ecx, dword ptr [ebp + 0x20]
            //   8d4550               | lea                 eax, dword ptr [ebp + 0x50]
            //   837d6410             | cmp                 dword ptr [ebp + 0x64], 0x10
            //   6800000080           | push                0x80000000
            //   0f434550             | cmovae              eax, dword ptr [ebp + 0x50]

        $sequence_3 = { c785b8fdffff00000000 0f1000 0f1185a4fdffff f30f7e4010 }
            // n = 4, score = 400
            //   c785b8fdffff00000000     | mov    dword ptr [ebp - 0x248], 0
            //   0f1000               | movups              xmm0, xmmword ptr [eax]
            //   0f1185a4fdffff       | movups              xmmword ptr [ebp - 0x25c], xmm0
            //   f30f7e4010           | movq                xmm0, qword ptr [eax + 0x10]

        $sequence_4 = { 83f8ff 7412 b001 5e 8b4c2408 }
            // n = 5, score = 400
            //   83f8ff               | cmp                 eax, -1
            //   7412                 | je                  0x14
            //   b001                 | mov                 al, 1
            //   5e                   | pop                 esi
            //   8b4c2408             | mov                 ecx, dword ptr [esp + 8]

        $sequence_5 = { e8???????? ffb588fdffff e8???????? 83c40c 8d85d8feffff 6a00 6a00 }
            // n = 7, score = 400
            //   e8????????           |                     
            //   ffb588fdffff         | push                dword ptr [ebp - 0x278]
            //   e8????????           |                     
            //   83c40c               | add                 esp, 0xc
            //   8d85d8feffff         | lea                 eax, dword ptr [ebp - 0x128]
            //   6a00                 | push                0
            //   6a00                 | push                0

        $sequence_6 = { 740e 6a05 ffd3 85ff 8bbdf4fffeff 7f8d }
            // n = 6, score = 400
            //   740e                 | je                  0x10
            //   6a05                 | push                5
            //   ffd3                 | call                ebx
            //   85ff                 | test                edi, edi
            //   8bbdf4fffeff         | mov                 edi, dword ptr [ebp - 0x1000c]
            //   7f8d                 | jg                  0xffffff8f

        $sequence_7 = { 8d95d4feffff c785b4feffff00000000 0f4395d4feffff 8bca c785b8feffff0f000000 c685a4feffff00 8d7101 }
            // n = 7, score = 400
            //   8d95d4feffff         | lea                 edx, dword ptr [ebp - 0x12c]
            //   c785b4feffff00000000     | mov    dword ptr [ebp - 0x14c], 0
            //   0f4395d4feffff       | cmovae              edx, dword ptr [ebp - 0x12c]
            //   8bca                 | mov                 ecx, edx
            //   c785b8feffff0f000000     | mov    dword ptr [ebp - 0x148], 0xf
            //   c685a4feffff00       | mov                 byte ptr [ebp - 0x15c], 0
            //   8d7101               | lea                 esi, dword ptr [ecx + 1]

        $sequence_8 = { 33c2 69d06589076c 03d1 89948d54ecffff 41 81f970020000 7ce1 }
            // n = 7, score = 400
            //   33c2                 | xor                 eax, edx
            //   69d06589076c         | imul                edx, eax, 0x6c078965
            //   03d1                 | add                 edx, ecx
            //   89948d54ecffff       | mov                 dword ptr [ebp + ecx*4 - 0x13ac], edx
            //   41                   | inc                 ecx
            //   81f970020000         | cmp                 ecx, 0x270
            //   7ce1                 | jl                  0xffffffe3

        $sequence_9 = { 837e1410 8955a0 8bc6 7202 8b06 8d1438 }
            // n = 6, score = 400
            //   837e1410             | cmp                 dword ptr [esi + 0x14], 0x10
            //   8955a0               | mov                 dword ptr [ebp - 0x60], edx
            //   8bc6                 | mov                 eax, esi
            //   7202                 | jb                  4
            //   8b06                 | mov                 eax, dword ptr [esi]
            //   8d1438               | lea                 edx, dword ptr [eax + edi]

    condition:
        7 of them and filesize < 1073152
}