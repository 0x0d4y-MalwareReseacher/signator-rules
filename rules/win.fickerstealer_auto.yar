rule win_fickerstealer_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-08-05"
        version = "1"
        description = "Detects win.fickerstealer."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.fickerstealer"
        malpedia_rule_date = "20220805"
        malpedia_hash = "6ec06c64bcfdbeda64eff021c766b4ce34542b71"
        malpedia_version = "20220808"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { d945e8 83c40c 5e 5f 5b 5d c3 }
            // n = 7, score = 200
            //   d945e8               | fld                 dword ptr [ebp - 0x18]
            //   83c40c               | add                 esp, 0xc
            //   5e                   | pop                 esi
            //   5f                   | pop                 edi
            //   5b                   | pop                 ebx
            //   5d                   | pop                 ebp
            //   c3                   | ret                 

        $sequence_1 = { d3e3 b120 84ca 89d9 0f45c8 0f45f7 0f45f8 }
            // n = 7, score = 200
            //   d3e3                 | shl                 ebx, cl
            //   b120                 | mov                 cl, 0x20
            //   84ca                 | test                dl, cl
            //   89d9                 | mov                 ecx, ebx
            //   0f45c8               | cmovne              ecx, eax
            //   0f45f7               | cmovne              esi, edi
            //   0f45f8               | cmovne              edi, eax

        $sequence_2 = { eb0f b001 eb0b 39d1 7ff4 0f94c1 b002 }
            // n = 7, score = 200
            //   eb0f                 | jmp                 0x11
            //   b001                 | mov                 al, 1
            //   eb0b                 | jmp                 0xd
            //   39d1                 | cmp                 ecx, edx
            //   7ff4                 | jg                  0xfffffff6
            //   0f94c1               | sete                cl
            //   b002                 | mov                 al, 2

        $sequence_3 = { eb0c 8364245000 8364246000 31c0 8d4c244c 8d742418 }
            // n = 6, score = 200
            //   eb0c                 | jmp                 0xe
            //   8364245000           | and                 dword ptr [esp + 0x50], 0
            //   8364246000           | and                 dword ptr [esp + 0x60], 0
            //   31c0                 | xor                 eax, eax
            //   8d4c244c             | lea                 ecx, [esp + 0x4c]
            //   8d742418             | lea                 esi, [esp + 0x18]

        $sequence_4 = { eb31 81fe0000807f 7512 81fb0000807f 7519 660f6e05???????? eb1b }
            // n = 7, score = 200
            //   eb31                 | jmp                 0x33
            //   81fe0000807f         | cmp                 esi, 0x7f800000
            //   7512                 | jne                 0x14
            //   81fb0000807f         | cmp                 ebx, 0x7f800000
            //   7519                 | jne                 0x1b
            //   660f6e05????????     |                     
            //   eb1b                 | jmp                 0x1d

        $sequence_5 = { eb14 89fa 89d9 ff761c ff7618 e8???????? 59 }
            // n = 7, score = 200
            //   eb14                 | jmp                 0x16
            //   89fa                 | mov                 edx, edi
            //   89d9                 | mov                 ecx, ebx
            //   ff761c               | push                dword ptr [esi + 0x1c]
            //   ff7618               | push                dword ptr [esi + 0x18]
            //   e8????????           |                     
            //   59                   | pop                 ecx

        $sequence_6 = { f20f114610 f20f114e08 f20f1116 56 e8???????? 59 83c418 }
            // n = 7, score = 200
            //   f20f114610           | movsd               qword ptr [esi + 0x10], xmm0
            //   f20f114e08           | movsd               qword ptr [esi + 8], xmm1
            //   f20f1116             | movsd               qword ptr [esi], xmm2
            //   56                   | push                esi
            //   e8????????           |                     
            //   59                   | pop                 ecx
            //   83c418               | add                 esp, 0x18

        $sequence_7 = { f20f104d9d 894dbb f20f114db4 f20f1145ac 8a55a9 8975d0 897dd4 }
            // n = 7, score = 200
            //   f20f104d9d           | movsd               xmm1, qword ptr [ebp - 0x63]
            //   894dbb               | mov                 dword ptr [ebp - 0x45], ecx
            //   f20f114db4           | movsd               qword ptr [ebp - 0x4c], xmm1
            //   f20f1145ac           | movsd               qword ptr [ebp - 0x54], xmm0
            //   8a55a9               | mov                 dl, byte ptr [ebp - 0x57]
            //   8975d0               | mov                 dword ptr [ebp - 0x30], esi
            //   897dd4               | mov                 dword ptr [ebp - 0x2c], edi

        $sequence_8 = { e8???????? 58 8b8d54feffff b801010101 89fa 21c1 898d28feffff }
            // n = 7, score = 200
            //   e8????????           |                     
            //   58                   | pop                 eax
            //   8b8d54feffff         | mov                 ecx, dword ptr [ebp - 0x1ac]
            //   b801010101           | mov                 eax, 0x1010101
            //   89fa                 | mov                 edx, edi
            //   21c1                 | and                 ecx, eax
            //   898d28feffff         | mov                 dword ptr [ebp - 0x1d8], ecx

        $sequence_9 = { f7e6 89d6 0fa4c601 89f0 f7e1 89f0 }
            // n = 6, score = 200
            //   f7e6                 | mul                 esi
            //   89d6                 | mov                 esi, edx
            //   0fa4c601             | shld                esi, eax, 1
            //   89f0                 | mov                 eax, esi
            //   f7e1                 | mul                 ecx
            //   89f0                 | mov                 eax, esi

    condition:
        7 of them and filesize < 598016
}