rule win_ngioweb_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.ngioweb."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.ngioweb"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { ff4dec 759a 8365fc00 837e0400 7e3d 8b5508 8b7df8 }
            // n = 7, score = 500
            //   ff4dec               | dec                 dword ptr [ebp - 0x14]
            //   759a                 | jne                 0xffffff9c
            //   8365fc00             | and                 dword ptr [ebp - 4], 0
            //   837e0400             | cmp                 dword ptr [esi + 4], 0
            //   7e3d                 | jle                 0x3f
            //   8b5508               | mov                 edx, dword ptr [ebp + 8]
            //   8b7df8               | mov                 edi, dword ptr [ebp - 8]

        $sequence_1 = { e8???????? ff75f8 ffd0 5e 5f 8b45f4 }
            // n = 6, score = 500
            //   e8????????           |                     
            //   ff75f8               | push                dword ptr [ebp - 8]
            //   ffd0                 | call                eax
            //   5e                   | pop                 esi
            //   5f                   | pop                 edi
            //   8b45f4               | mov                 eax, dword ptr [ebp - 0xc]

        $sequence_2 = { e8???????? 85c0 7418 0fb74018 663d0b02 7505 6a02 }
            // n = 7, score = 500
            //   e8????????           |                     
            //   85c0                 | test                eax, eax
            //   7418                 | je                  0x1a
            //   0fb74018             | movzx               eax, word ptr [eax + 0x18]
            //   663d0b02             | cmp                 ax, 0x20b
            //   7505                 | jne                 7
            //   6a02                 | push                2

        $sequence_3 = { 3bfe 5f 770b 52 51 ff7518 50 }
            // n = 7, score = 500
            //   3bfe                 | cmp                 edi, esi
            //   5f                   | pop                 edi
            //   770b                 | ja                  0xd
            //   52                   | push                edx
            //   51                   | push                ecx
            //   ff7518               | push                dword ptr [ebp + 0x18]
            //   50                   | push                eax

        $sequence_4 = { 03d0 85c0 761c 56 2bd1 8bf0 49 }
            // n = 7, score = 500
            //   03d0                 | add                 edx, eax
            //   85c0                 | test                eax, eax
            //   761c                 | jbe                 0x1e
            //   56                   | push                esi
            //   2bd1                 | sub                 edx, ecx
            //   8bf0                 | mov                 esi, eax
            //   49                   | dec                 ecx

        $sequence_5 = { 8945fc 0fb74618 663d0b02 7508 8b9e84000000 eb0d 663d0b01 }
            // n = 7, score = 500
            //   8945fc               | mov                 dword ptr [ebp - 4], eax
            //   0fb74618             | movzx               eax, word ptr [esi + 0x18]
            //   663d0b02             | cmp                 ax, 0x20b
            //   7508                 | jne                 0xa
            //   8b9e84000000         | mov                 ebx, dword ptr [esi + 0x84]
            //   eb0d                 | jmp                 0xf
            //   663d0b01             | cmp                 ax, 0x10b

        $sequence_6 = { 51 ffd0 8bf8 f7df 1bff f7df 7413 }
            // n = 7, score = 500
            //   51                   | push                ecx
            //   ffd0                 | call                eax
            //   8bf8                 | mov                 edi, eax
            //   f7df                 | neg                 edi
            //   1bff                 | sbb                 edi, edi
            //   f7df                 | neg                 edi
            //   7413                 | je                  0x15

        $sequence_7 = { 66894de0 66c745de7400 66c745dc6e00 66c745da6f00 66c745d84300 66c745d67400 66c745d46e00 }
            // n = 7, score = 500
            //   66894de0             | mov                 word ptr [ebp - 0x20], cx
            //   66c745de7400         | mov                 word ptr [ebp - 0x22], 0x74
            //   66c745dc6e00         | mov                 word ptr [ebp - 0x24], 0x6e
            //   66c745da6f00         | mov                 word ptr [ebp - 0x26], 0x6f
            //   66c745d84300         | mov                 word ptr [ebp - 0x28], 0x43
            //   66c745d67400         | mov                 word ptr [ebp - 0x2a], 0x74
            //   66c745d46e00         | mov                 word ptr [ebp - 0x2c], 0x6e

        $sequence_8 = { 66c745e86500 66c745e66400 66c745e44900 66c745e22e00 66c745e06500 66c745de6e00 }
            // n = 6, score = 500
            //   66c745e86500         | mov                 word ptr [ebp - 0x18], 0x65
            //   66c745e66400         | mov                 word ptr [ebp - 0x1a], 0x64
            //   66c745e44900         | mov                 word ptr [ebp - 0x1c], 0x49
            //   66c745e22e00         | mov                 word ptr [ebp - 0x1e], 0x2e
            //   66c745e06500         | mov                 word ptr [ebp - 0x20], 0x65
            //   66c745de6e00         | mov                 word ptr [ebp - 0x22], 0x6e

        $sequence_9 = { 66c745da7600 66897dd8 66895dd6 66c745d45000 66c745d27000 66c745d07500 66c745ce6b00 }
            // n = 7, score = 500
            //   66c745da7600         | mov                 word ptr [ebp - 0x26], 0x76
            //   66897dd8             | mov                 word ptr [ebp - 0x28], di
            //   66895dd6             | mov                 word ptr [ebp - 0x2a], bx
            //   66c745d45000         | mov                 word ptr [ebp - 0x2c], 0x50
            //   66c745d27000         | mov                 word ptr [ebp - 0x2e], 0x70
            //   66c745d07500         | mov                 word ptr [ebp - 0x30], 0x75
            //   66c745ce6b00         | mov                 word ptr [ebp - 0x32], 0x6b

    condition:
        7 of them and filesize < 204800
}