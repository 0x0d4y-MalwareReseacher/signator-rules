rule win_misfox_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.misfox."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.misfox"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 83fa39 7e08 8d429f 83f819 7706 885435e0 }
            // n = 6, score = 300
            //   83fa39               | lea                 ecx, [0xc318]
            //   7e08                 | dec                 eax
            //   8d429f               | arpl                cx, ax
            //   83f819               | dec                 eax
            //   7706                 | mov                 esi, eax
            //   885435e0             | dec                 eax

        $sequence_1 = { a0???????? 68???????? 8845ee 8d85c8faffff f30f7f45d0 }
            // n = 5, score = 300
            //   a0????????           |                     
            //   68????????           |                     
            //   8845ee               | sar                 esi, 5
            //   8d85c8faffff         | dec                 esp
            //   f30f7f45d0           | lea                 edi, [0xd67e]

        $sequence_2 = { 817e5c68180110 7409 ff765c e8???????? 59 }
            // n = 5, score = 300
            //   817e5c68180110       | dec                 ecx
            //   7409                 | mov                 edi, eax
            //   ff765c               | mov                 ebp, edx
            //   e8????????           |                     
            //   59                   | dec                 eax

        $sequence_3 = { e8???????? ff7708 6a00 ff37 e8???????? 8b4608 }
            // n = 6, score = 300
            //   e8????????           |                     
            //   ff7708               | lea                 ecx, [0x3377]
            //   6a00                 | dec                 eax
            //   ff37                 | lea                 edx, [0xc33f]
            //   e8????????           |                     
            //   8b4608               | dec                 eax

        $sequence_4 = { 8b35???????? e9???????? 8d8594eaffff 50 }
            // n = 4, score = 300
            //   8b35????????         |                     
            //   e9????????           |                     
            //   8d8594eaffff         | add                 esi, ecx
            //   50                   | add                 esi, eax

        $sequence_5 = { 33c0 5b 8be5 5d c20400 56 68???????? }
            // n = 7, score = 300
            //   33c0                 | movzx               ecx, word ptr [esp + 0x20]
            //   5b                   | mov                 ecx, 0xe
            //   8be5                 | mov                 eax, 0x2aaaaaab
            //   5d                   | inc                 ecx
            //   c20400               | sub                 ecx, eax
            //   56                   | dec                 eax
            //   68????????           |                     

        $sequence_6 = { 8bf2 c1ee1f 03f1 03f0 }
            // n = 4, score = 300
            //   8bf2                 | mov                 eax, esi
            //   c1ee1f               | dec                 eax
            //   03f1                 | mov                 edx, edi
            //   03f0                 | inc                 esp

        $sequence_7 = { 8d45f4 c645f40d 50 8b8528e5ffff 8b048550870110 }
            // n = 5, score = 300
            //   8d45f4               | mov                 ebx, ecx
            //   c645f40d             | dec                 esp
            //   50                   | lea                 edx, [esp + 8]
            //   8b8528e5ffff         | mov                 esi, edx
            //   8b048550870110       | shr                 esi, 0x1f

        $sequence_8 = { 440fb74c2420 b90e000000 b8abaaaa2a 412bc8 }
            // n = 4, score = 100
            //   440fb74c2420         | mov                 ecx, dword ptr [edi]
            //   b90e000000           | dec                 eax
            //   b8abaaaa2a           | lea                 edx, [0x16bdd]
            //   412bc8               | dec                 eax

        $sequence_9 = { 488d0d77330000 e8???????? 488d153fc30000 488d0d18c30000 e8???????? }
            // n = 5, score = 100
            //   488d0d77330000       | test                eax, eax
            //   e8????????           |                     
            //   488d153fc30000       | dec                 eax
            //   488d0d18c30000       | mov                 ebx, eax
            //   e8????????           |                     

        $sequence_10 = { 4863c1 488bf0 48c1fe05 4c8d3d7ed60000 }
            // n = 4, score = 100
            //   4863c1               | dec                 eax
            //   488bf0               | cmp                 eax, -1
            //   48c1fe05             | je                  0x39
            //   4c8d3d7ed60000       | dec                 esp

        $sequence_11 = { 85c0 0f857e020000 488d4dff ba00020000 c745cb00020000 }
            // n = 5, score = 100
            //   85c0                 | dec                 eax
            //   0f857e020000         | mov                 ecx, dword ptr [ecx + eax*8]
            //   488d4dff             | dec                 eax
            //   ba00020000           | mov                 ecx, ebx
            //   c745cb00020000       | dec                 eax

        $sequence_12 = { 448be8 85c0 0f8470010000 488b442448 488d0d1bdf0000 4c8d4c2460 488b0cc1 }
            // n = 7, score = 100
            //   448be8               | inc                 esp
            //   85c0                 | mov                 ebp, eax
            //   0f8470010000         | test                eax, eax
            //   488b442448           | je                  0x176
            //   488d0d1bdf0000       | dec                 eax
            //   4c8d4c2460           | mov                 eax, dword ptr [esp + 0x48]
            //   488b0cc1             | dec                 eax

        $sequence_13 = { ff15???????? 85c0 7547 488b0f 488d15dd6b0100 ff15???????? 4885c0 }
            // n = 7, score = 100
            //   ff15????????         |                     
            //   85c0                 | lea                 edx, [0xbd17]
            //   7547                 | dec                 eax
            //   488b0f               | mov                 ecx, ebx
            //   488d15dd6b0100       | test                eax, eax
            //   ff15????????         |                     
            //   4885c0               | jne                 0x286

        $sequence_14 = { 488bcb 488905???????? ff15???????? 488d1517bd0000 483305???????? 488bcb }
            // n = 6, score = 100
            //   488bcb               | lea                 ecx, [0xdf1b]
            //   488905????????       |                     
            //   ff15????????         |                     
            //   488d1517bd0000       | dec                 esp
            //   483305????????       |                     
            //   488bcb               | lea                 ecx, [esp + 0x60]

        $sequence_15 = { 488bd8 4883f8ff 7430 4c89742420 4c8d4c2450 448bc6 488bd7 }
            // n = 7, score = 100
            //   488bd8               | dec                 eax
            //   4883f8ff             | lea                 ecx, [ebp - 1]
            //   7430                 | mov                 edx, 0x200
            //   4c89742420           | mov                 dword ptr [ebp - 0x35], 0x200
            //   4c8d4c2450           | test                eax, eax
            //   448bc6               | jne                 0x4b
            //   488bd7               | dec                 eax

    condition:
        7 of them and filesize < 266240
}