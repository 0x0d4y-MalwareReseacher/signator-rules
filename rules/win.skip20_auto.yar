rule win_skip20_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.skip20."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.skip20"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 0fb648ff c644bb2201 66448944bb24 83e107 }
            // n = 4, score = 200
            //   0fb648ff             | lea                 ecx, [ecx + 0x40]
            //   c644bb2201           | movzx               ecx, byte ptr [eax - 1]
            //   66448944bb24         | mov                 byte ptr [ebx + edi*4 + 0x22], 1
            //   83e107               | inc                 sp

        $sequence_1 = { 488d1526e4ffff 488bcb e8???????? 440fb74c2472 440fb7442470 85c0 7447 }
            // n = 7, score = 200
            //   488d1526e4ffff       | mov                 dword ptr [ebx + edi*4 + 0x24], eax
            //   488bcb               | and                 ecx, 7
            //   e8????????           |                     
            //   440fb74c2472         | dec                 eax
            //   440fb7442470         | lea                 edx, [0xffffe426]
            //   85c0                 | dec                 eax
            //   7447                 | mov                 ecx, ebx

        $sequence_2 = { 4885c0 0f8492000000 4889442450 488d15b5f4ffff 488bc8 e8???????? }
            // n = 6, score = 200
            //   4885c0               | je                  0x4b
            //   0f8492000000         | test                al, 1
            //   4889442450           | dec                 esp
            //   488d15b5f4ffff       | cmovne              ebp, ecx
            //   488bc8               | movzx               eax, byte ptr [edx + 0x32]
            //   e8????????           |                     

        $sequence_3 = { 7505 8d4110 eb2b 83f902 7513 }
            // n = 5, score = 200
            //   7505                 | test                eax, eax
            //   8d4110               | je                  0x9b
            //   eb2b                 | dec                 eax
            //   83f902               | mov                 dword ptr [esp + 0x50], eax
            //   7513                 | dec                 eax

        $sequence_4 = { 488bd1 41b901000000 443301 410fbae019 7312 }
            // n = 5, score = 200
            //   488bd1               | lea                 edx, [0xfffff4b5]
            //   41b901000000         | dec                 eax
            //   443301               | mov                 ecx, eax
            //   410fbae019           | add                 ecx, 0x3c
            //   7312                 | mov                 ecx, dword ptr [esp + 0x98]

        $sequence_5 = { 448d4940 ff15???????? 488905???????? 8b15???????? }
            // n = 4, score = 200
            //   448d4940             | inc                 esp
            //   ff15????????         |                     
            //   488905????????       |                     
            //   8b15????????         |                     

        $sequence_6 = { 83c13c e9???????? 8b8c2498000000 83c130 e9???????? 8b8c2498000000 ba40000000 }
            // n = 7, score = 200
            //   83c13c               | dec                 eax
            //   e9????????           |                     
            //   8b8c2498000000       | mov                 dword ptr [esp + 0x58], ebx
            //   83c130               | inc                 ecx
            //   e9????????           |                     
            //   8b8c2498000000       | mov                 dword ptr [eax + 0x9c], eax
            //   ba40000000           | dec                 eax

        $sequence_7 = { a801 4c0f45e9 0fb64232 48895c2458 4189809c000000 }
            // n = 5, score = 200
            //   a801                 | inc                 esp
            //   4c0f45e9             | movzx               ecx, word ptr [esp + 0x72]
            //   0fb64232             | inc                 esp
            //   48895c2458           | movzx               eax, word ptr [esp + 0x70]
            //   4189809c000000       | test                eax, eax

    condition:
        7 of them and filesize < 794624
}