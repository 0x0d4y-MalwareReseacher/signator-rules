rule win_skip20_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-11-21"
        version = "1"
        description = "Detects win.skip20."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.skip20"
        malpedia_rule_date = "20221118"
        malpedia_hash = "e0702e2e6d1d00da65c8a29a4ebacd0a4c59e1af"
        malpedia_version = "20221125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 664109402c 4589583c e9???????? 41830810 418b4840 83f9ff 740d }
            // n = 7, score = 200
            //   664109402c           | cwde                
            //   4589583c             | cmp                 cx, dx
            //   e9????????           |                     
            //   41830810             | jne                 0x8af
            //   418b4840             | dec                 ecx
            //   83f9ff               | lea                 eax, [ecx + eax*4 + 0x18c40]
            //   740d                 | ret                 

        $sequence_1 = { 488d150f2e0100 e9???????? 4c896c2450 c7842490000000204963d8 c7842494000000488bf248 c78424980000008bf94585 c684249c000000c0 }
            // n = 7, score = 200
            //   488d150f2e0100       | mov                 eax, 0x10
            //   e9????????           |                     
            //   4c896c2450           | test                eax, eax
            //   c7842490000000204963d8     | je    0x669
            //   c7842494000000488bf248     | dec    eax
            //   c78424980000008bf94585     | arpl    di, bp
            //   c684249c000000c0     | dec                 eax

        $sequence_2 = { 440f44d0 448854bb23 4c8d15e391ffff e9???????? }
            // n = 4, score = 200
            //   440f44d0             | je                  0x9b
            //   448854bb23           | inc                 ecx
            //   4c8d15e391ffff       | cmp                 ebx, 3
            //   e9????????           |                     

        $sequence_3 = { c784242c02000001000048 c7842430020000c78424e8 c7842434020000000000fe 66c7842438020000ffff }
            // n = 4, score = 200
            //   c784242c02000001000048     | mov    al, byte ptr [edi + ebx]
            //   c7842430020000c78424e8     | jb    0x587
            //   c7842434020000000000fe     | cmp    edx, 7
            //   66c7842438020000ffff     | jbe    0xffffff45

        $sequence_4 = { 41810800200000 418b4848 83f9ff 740d b801000000 66d3e0 664109402c }
            // n = 7, score = 200
            //   41810800200000       | and                 eax, ebp
            //   418b4848             | dec                 ecx
            //   83f9ff               | lea                 ecx, [eax + 0x34]
            //   740d                 | dec                 ecx
            //   b801000000           | mov                 dword ptr [eax + 0xa0], eax
            //   66d3e0               | dec                 eax
            //   664109402c           | lea                 edx, [0xc198]

        $sequence_5 = { 7312 8b4a48 83f9ff 740a 418bc1 66d3e0 }
            // n = 6, score = 200
            //   7312                 | inc                 esp
            //   8b4a48               | mov                 eax, dword ptr [esp + 0x38]
            //   83f9ff               | mov                 word ptr [edi], 0x25ff
            //   740a                 | mov                 dword ptr [edi + 2], 0
            //   418bc1               | dec                 esp
            //   66d3e0               | lea                 ecx, [esp + 0x40]

        $sequence_6 = { 0fb64504 448b8424b8000000 a804 7406 41f6c008 }
            // n = 5, score = 200
            //   0fb64504             | and                 eax, 7
            //   448b8424b8000000     | inc                 ecx
            //   a804                 | or                  dword ptr [eax + 0x38], eax
            //   7406                 | movzx               edx, byte ptr [ecx + 1]
            //   41f6c008             | inc                 ecx

        $sequence_7 = { 410fb7c3 44895d0c 4c895d04 66f3ab 488d3d36210100 482bfd 8a041f }
            // n = 7, score = 200
            //   410fb7c3             | mov                 eax, dword ptr [esp + 0x50]
            //   44895d0c             | dec                 eax
            //   4c895d04             | lea                 ecx, [0x501a9]
            //   66f3ab               | dec                 eax
            //   488d3d36210100       | mov                 ecx, dword ptr [ecx + eax*8]
            //   482bfd               | dec                 eax
            //   8a041f               | lea                 ecx, [esp + 0xc8]

        $sequence_8 = { 0f84ea000000 448b4db3 4c8d45bf 418bd7 498bce e8???????? }
            // n = 6, score = 200
            //   0f84ea000000         | mov                 dword ptr [esp + 0x50], esi
            //   448b4db3             | dec                 eax
            //   4c8d45bf             | test                esi, esi
            //   418bd7               | je                  0x4dc
            //   498bce               | dec                 eax
            //   e8????????           |                     

        $sequence_9 = { 89542428 488d15562e0100 440fb7542476 4489542420 488d0d542b0100 e8???????? c78424b8020000fff54156 }
            // n = 7, score = 200
            //   89542428             | mov                 eax, 0x100
            //   488d15562e0100       | or                  word ptr [ebx + 0x18], ax
            //   440fb7542476         | bt                  esi, 0x10
            //   4489542420           | inc                 ecx
            //   488d0d542b0100       | movzx               eax, word ptr [edx + eax*2 + 0x1eaf0]
            //   e8????????           |                     
            //   c78424b8020000fff54156     | add    ax, word ptr [ebp + 2]

    condition:
        7 of them and filesize < 794624
}