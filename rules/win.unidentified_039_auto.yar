rule win_unidentified_039_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-04-08"
        version = "1"
        description = "Describes win.unidentified_039."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.unidentified_039"
        malpedia_rule_date = "20220405"
        malpedia_hash = "ecd38294bd47d5589be5cd5490dc8bb4804afc2a"
        malpedia_version = ""
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { c745902e150000 c74580745a0000 c7458462750000 c7458cc83f0000 8b4584 }
            // n = 5, score = 100
            //   c745902e150000       | mov                 dword ptr [ebp - 0x70], 0x152e
            //   c74580745a0000       | mov                 dword ptr [ebp - 0x80], 0x5a74
            //   c7458462750000       | mov                 dword ptr [ebp - 0x7c], 0x7562
            //   c7458cc83f0000       | mov                 dword ptr [ebp - 0x74], 0x3fc8
            //   8b4584               | mov                 eax, dword ptr [ebp - 0x7c]

        $sequence_1 = { 8b45dc 8b4de0 0fafc1 0345e4 8b4d10 25d55b0000 33c1 }
            // n = 7, score = 100
            //   8b45dc               | mov                 eax, dword ptr [ebp - 0x24]
            //   8b4de0               | mov                 ecx, dword ptr [ebp - 0x20]
            //   0fafc1               | imul                eax, ecx
            //   0345e4               | add                 eax, dword ptr [ebp - 0x1c]
            //   8b4d10               | mov                 ecx, dword ptr [ebp + 0x10]
            //   25d55b0000           | and                 eax, 0x5bd5
            //   33c1                 | xor                 eax, ecx

        $sequence_2 = { 41 42 42 6685c0 75f1 5f 5e }
            // n = 7, score = 100
            //   41                   | inc                 ecx
            //   42                   | inc                 edx
            //   42                   | inc                 edx
            //   6685c0               | test                ax, ax
            //   75f1                 | jne                 0xfffffff3
            //   5f                   | pop                 edi
            //   5e                   | pop                 esi

        $sequence_3 = { a3???????? ff7508 e8???????? 83c40c 85c0 0f85f2000000 c745f447560000 }
            // n = 7, score = 100
            //   a3????????           |                     
            //   ff7508               | push                dword ptr [ebp + 8]
            //   e8????????           |                     
            //   83c40c               | add                 esp, 0xc
            //   85c0                 | test                eax, eax
            //   0f85f2000000         | jne                 0xf8
            //   c745f447560000       | mov                 dword ptr [ebp - 0xc], 0x5647

        $sequence_4 = { 8b4538 8b4d28 05ef290000 23c1 8b4d2c 8b5534 23ca }
            // n = 7, score = 100
            //   8b4538               | mov                 eax, dword ptr [ebp + 0x38]
            //   8b4d28               | mov                 ecx, dword ptr [ebp + 0x28]
            //   05ef290000           | add                 eax, 0x29ef
            //   23c1                 | and                 eax, ecx
            //   8b4d2c               | mov                 ecx, dword ptr [ebp + 0x2c]
            //   8b5534               | mov                 edx, dword ptr [ebp + 0x34]
            //   23ca                 | and                 ecx, edx

        $sequence_5 = { ff15???????? 8945ec 8a0437 30041e 46 81fe0c040000 7287 }
            // n = 7, score = 100
            //   ff15????????         |                     
            //   8945ec               | mov                 dword ptr [ebp - 0x14], eax
            //   8a0437               | mov                 al, byte ptr [edi + esi]
            //   30041e               | xor                 byte ptr [esi + ebx], al
            //   46                   | inc                 esi
            //   81fe0c040000         | cmp                 esi, 0x40c
            //   7287                 | jb                  0xffffff89

        $sequence_6 = { ff742404 e8???????? 59 c20400 55 8dac2454f8ffff 81ec2c080000 }
            // n = 7, score = 100
            //   ff742404             | push                dword ptr [esp + 4]
            //   e8????????           |                     
            //   59                   | pop                 ecx
            //   c20400               | ret                 4
            //   55                   | push                ebp
            //   8dac2454f8ffff       | lea                 ebp, dword ptr [esp - 0x7ac]
            //   81ec2c080000         | sub                 esp, 0x82c

        $sequence_7 = { c745087a210000 c745f47e1f0000 c745ec977e0000 8b45f4 8b4d08 0fafc1 8b4dec }
            // n = 7, score = 100
            //   c745087a210000       | mov                 dword ptr [ebp + 8], 0x217a
            //   c745f47e1f0000       | mov                 dword ptr [ebp - 0xc], 0x1f7e
            //   c745ec977e0000       | mov                 dword ptr [ebp - 0x14], 0x7e97
            //   8b45f4               | mov                 eax, dword ptr [ebp - 0xc]
            //   8b4d08               | mov                 ecx, dword ptr [ebp + 8]
            //   0fafc1               | imul                eax, ecx
            //   8b4dec               | mov                 ecx, dword ptr [ebp - 0x14]

        $sequence_8 = { e8???????? c745e4907f0000 c745f8110b0000 c745f4ed040000 c745fcee1a0000 c745e41e040000 }
            // n = 6, score = 100
            //   e8????????           |                     
            //   c745e4907f0000       | mov                 dword ptr [ebp - 0x1c], 0x7f90
            //   c745f8110b0000       | mov                 dword ptr [ebp - 8], 0xb11
            //   c745f4ed040000       | mov                 dword ptr [ebp - 0xc], 0x4ed
            //   c745fcee1a0000       | mov                 dword ptr [ebp - 4], 0x1aee
            //   c745e41e040000       | mov                 dword ptr [ebp - 0x1c], 0x41e

        $sequence_9 = { 35c0320000 33f6 3935???????? 57 8945f4 0f842f010000 }
            // n = 6, score = 100
            //   35c0320000           | xor                 eax, 0x32c0
            //   33f6                 | xor                 esi, esi
            //   3935????????         |                     
            //   57                   | push                edi
            //   8945f4               | mov                 dword ptr [ebp - 0xc], eax
            //   0f842f010000         | je                  0x135

    condition:
        7 of them and filesize < 262144
}