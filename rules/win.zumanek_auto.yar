rule win_zumanek_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-11-21"
        version = "1"
        description = "Detects win.zumanek."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.zumanek"
        malpedia_rule_date = "20221118"
        malpedia_hash = "e0702e2e6d1d00da65c8a29a4ebacd0a4c59e1af"
        malpedia_version = "20221125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 1e e090 84e1 c57cf99b 0fc07581 08e2 }
            // n = 6, score = 100
            //   1e                   | push                ds
            //   e090                 | loopne              0xffffff92
            //   84e1                 | test                cl, ah
            //   c57cf99b             | lds                 edi, ptr [ecx + edi*8 - 0x65]
            //   0fc07581             | xadd                byte ptr [ebp - 0x7f], dh
            //   08e2                 | or                  dl, ah

        $sequence_1 = { 1e fb 1b49ba 19c1 e367 }
            // n = 5, score = 100
            //   1e                   | push                ds
            //   fb                   | sti                 
            //   1b49ba               | sbb                 ecx, dword ptr [ecx - 0x46]
            //   19c1                 | sbb                 ecx, eax
            //   e367                 | jecxz               0x69

        $sequence_2 = { ef 7f69 02e0 a6 }
            // n = 4, score = 100
            //   ef                   | out                 dx, eax
            //   7f69                 | jg                  0x6b
            //   02e0                 | add                 ah, al
            //   a6                   | cmpsb               byte ptr [esi], byte ptr es:[edi]

        $sequence_3 = { f22610e2 f6c554 40 ed a94c6bbe3a 91 c45950 }
            // n = 7, score = 100
            //   f22610e2             | adc                 dl, ah
            //   f6c554               | test                ch, 0x54
            //   40                   | inc                 eax
            //   ed                   | in                  eax, dx
            //   a94c6bbe3a           | test                eax, 0x3abe6b4c
            //   91                   | xchg                eax, ecx
            //   c45950               | les                 ebx, ptr [ecx + 0x50]

        $sequence_4 = { 64250c072536 c2228d e6fc 06 ed 42 94 }
            // n = 7, score = 100
            //   64250c072536         | and                 eax, 0x3625070c
            //   c2228d               | ret                 0x8d22
            //   e6fc                 | out                 0xfc, al
            //   06                   | push                es
            //   ed                   | in                  eax, dx
            //   42                   | inc                 edx
            //   94                   | xchg                eax, esp

        $sequence_5 = { 8349b0ba 6b3e4f 5d d139 }
            // n = 4, score = 100
            //   8349b0ba             | or                  dword ptr [ecx - 0x50], 0xffffffba
            //   6b3e4f               | imul                edi, dword ptr [esi], 0x4f
            //   5d                   | pop                 ebp
            //   d139                 | sar                 dword ptr [ecx], 1

        $sequence_6 = { 49 01ad6a105e70 4d 8058ed70 4e }
            // n = 5, score = 100
            //   49                   | dec                 ecx
            //   01ad6a105e70         | add                 dword ptr [ebp + 0x705e106a], ebp
            //   4d                   | dec                 ebp
            //   8058ed70             | sbb                 byte ptr [eax - 0x13], 0x70
            //   4e                   | dec                 esi

        $sequence_7 = { e0d8 8aa473fa63c372 702a 7949 }
            // n = 4, score = 100
            //   e0d8                 | loopne              0xffffffda
            //   8aa473fa63c372       | mov                 ah, byte ptr [ebx + esi*2 + 0x72c363fa]
            //   702a                 | jo                  0x2c
            //   7949                 | jns                 0x4b

        $sequence_8 = { 40 77d1 92 7aea bdf4e48993 57 dcac58048db0e6 }
            // n = 7, score = 100
            //   40                   | inc                 eax
            //   77d1                 | ja                  0xffffffd3
            //   92                   | xchg                eax, edx
            //   7aea                 | jp                  0xffffffec
            //   bdf4e48993           | mov                 ebp, 0x9389e4f4
            //   57                   | push                edi
            //   dcac58048db0e6       | fsubr               qword ptr [eax + ebx*2 - 0x194f72fc]

        $sequence_9 = { 22f9 17 c8be45f2 2f 91 7c89 52 }
            // n = 7, score = 100
            //   22f9                 | and                 bh, cl
            //   17                   | pop                 ss
            //   c8be45f2             | enter               0x45be, -0xe
            //   2f                   | das                 
            //   91                   | xchg                eax, ecx
            //   7c89                 | jl                  0xffffff8b
            //   52                   | push                edx

    condition:
        7 of them and filesize < 58867712
}