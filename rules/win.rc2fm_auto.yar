rule win_rc2fm_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-08-05"
        version = "1"
        description = "Detects win.rc2fm."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.rc2fm"
        malpedia_rule_date = "20220805"
        malpedia_hash = "6ec06c64bcfdbeda64eff021c766b4ce34542b71"
        malpedia_version = "20220808"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 4885c0 0f84f6000000 833d????????06 48895c2430 c605????????00 726d 488d0d2a080200 }
            // n = 7, score = 100
            //   4885c0               | dec                 eax
            //   0f84f6000000         | mov                 ebx, eax
            //   833d????????06       |                     
            //   48895c2430           | dec                 eax
            //   c605????????00       |                     
            //   726d                 | test                eax, eax
            //   488d0d2a080200       | je                  0x974

        $sequence_1 = { 8905???????? 0fb6c0 8905???????? 0fb605???????? 8905???????? e8???????? 488bd8 }
            // n = 7, score = 100
            //   8905????????         |                     
            //   0fb6c0               | mov                 edi, eax
            //   8905????????         |                     
            //   0fb605????????       |                     
            //   8905????????         |                     
            //   e8????????           |                     
            //   488bd8               | dec                 eax

        $sequence_2 = { 85c0 743b 3d02010000 7424 83f8ff 7407 ba01000400 }
            // n = 7, score = 100
            //   85c0                 | mov                 eax, eax
            //   743b                 | mov                 ecx, 0x10000
            //   3d02010000           | jmp                 0x13e1
            //   7424                 | dec                 eax
            //   83f8ff               | mov                 ecx, edi
            //   7407                 | test                eax, eax
            //   ba01000400           | je                  0x13fa

        $sequence_3 = { 5b c3 ff15???????? ba00000400 b913000100 448bc0 }
            // n = 6, score = 100
            //   5b                   | mov                 dword ptr [esp + 0x20], 2
            //   c3                   | dec                 eax
            //   ff15????????         |                     
            //   ba00000400           | mov                 edi, eax
            //   b913000100           | dec                 eax
            //   448bc0               | cmp                 eax, -1

        $sequence_4 = { 03c8 4803d9 4803f9 4584db 757c 4533db 85f6 }
            // n = 7, score = 100
            //   03c8                 | push                edi
            //   4803d9               | dec                 eax
            //   4803f9               | sub                 esp, 0x20
            //   4584db               | mov                 edi, ecx
            //   757c                 | add                 edi, eax
            //   4533db               | dec                 eax
            //   85f6                 | mov                 dword ptr [esp + 8], ebx

        $sequence_5 = { 40b601 33db e9???????? 4084ff 0f84d3000000 4032ff }
            // n = 6, score = 100
            //   40b601               | lea                 ecx, [esp + 0x40]
            //   33db                 | mov                 edx, 0x10000003
            //   e9????????           |                     
            //   4084ff               | push                edi
            //   0f84d3000000         | dec                 eax
            //   4032ff               | sub                 esp, 0x30

        $sequence_6 = { e9???????? 448bc0 ba0e000500 b900000100 e8???????? 40b701 33db }
            // n = 7, score = 100
            //   e9????????           |                     
            //   448bc0               | sub                 edi, esi
            //   ba0e000500           | inc                 edi
            //   b900000100           | dec                 esp
            //   e8????????           |                     
            //   40b701               | lea                 ecx, [esp + 0x68]
            //   33db                 | dec                 esp

        $sequence_7 = { 4883ec28 e8???????? 84c0 7408 0fb6c0 4883c428 c3 }
            // n = 7, score = 100
            //   4883ec28             | movzx               eax, byte ptr [ecx + eax]
            //   e8????????           |                     
            //   84c0                 | dec                 eax
            //   7408                 | lea                 ecx, [ecx + 1]
            //   0fb6c0               | dec                 ecx
            //   4883c428             | lea                 ecx, [edi + 0xc]
            //   c3                   | dec                 ecx

        $sequence_8 = { 4533c9 81e100000002 458d4101 894c2428 488d4df0 c744242003000000 ff15???????? }
            // n = 7, score = 100
            //   4533c9               | dec                 esp
            //   81e100000002         | mov                 eax, dword ptr [esp + 0x78]
            //   458d4101             | dec                 eax
            //   894c2428             | mov                 eax, 0xd53e8000
            //   488d4df0             | fidiv               word ptr [ecx - 0x74b7fe63]
            //   c744242003000000     | int1                
            //   ff15????????         |                     

        $sequence_9 = { ff15???????? 488bf0 4885c0 0f84fe000000 488b442468 0fb7d7 }
            // n = 6, score = 100
            //   ff15????????         |                     
            //   488bf0               | test                eax, eax
            //   4885c0               | je                  0x1063
            //   0f84fe000000         | inc                 ecx
            //   488b442468           | inc                 esi
            //   0fb7d7               | dec                 eax

    condition:
        7 of them and filesize < 410624
}