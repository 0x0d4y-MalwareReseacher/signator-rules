rule win_electricfish_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2022-11-21"
        version = "1"
        description = "Detects win.electricfish."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.electricfish"
        malpedia_rule_date = "20221118"
        malpedia_hash = "e0702e2e6d1d00da65c8a29a4ebacd0a4c59e1af"
        malpedia_version = "20221125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 3bf5 0f8498030000 3bc5 0f8490030000 6a0f 57 e8???????? }
            // n = 7, score = 1200
            //   3bf5                 | cmp                 esi, ebp
            //   0f8498030000         | je                  0x39e
            //   3bc5                 | cmp                 eax, ebp
            //   0f8490030000         | je                  0x396
            //   6a0f                 | push                0xf
            //   57                   | push                edi
            //   e8????????           |                     

        $sequence_1 = { 681f0b0000 68???????? 687d010000 e9???????? 8b908c000000 52 e8???????? }
            // n = 7, score = 1200
            //   681f0b0000           | push                0xb1f
            //   68????????           |                     
            //   687d010000           | push                0x17d
            //   e9????????           |                     
            //   8b908c000000         | mov                 edx, dword ptr [eax + 0x8c]
            //   52                   | push                edx
            //   e8????????           |                     

        $sequence_2 = { e8???????? 8bf0 3bf7 0f8413020000 53 55 56 }
            // n = 7, score = 1200
            //   e8????????           |                     
            //   8bf0                 | mov                 esi, eax
            //   3bf7                 | cmp                 esi, edi
            //   0f8413020000         | je                  0x219
            //   53                   | push                ebx
            //   55                   | push                ebp
            //   56                   | push                esi

        $sequence_3 = { e9???????? 8bb3e00a0000 c7431401000000 89742410 3bfe 7314 6867010000 }
            // n = 7, score = 1200
            //   e9????????           |                     
            //   8bb3e00a0000         | mov                 esi, dword ptr [ebx + 0xae0]
            //   c7431401000000       | mov                 dword ptr [ebx + 0x14], 1
            //   89742410             | mov                 dword ptr [esp + 0x10], esi
            //   3bfe                 | cmp                 edi, esi
            //   7314                 | jae                 0x16
            //   6867010000           | push                0x167

        $sequence_4 = { 83ceff c744240800000000 85ff 7521 6a61 68???????? 6a43 }
            // n = 7, score = 1200
            //   83ceff               | or                  esi, 0xffffffff
            //   c744240800000000     | mov                 dword ptr [esp + 8], 0
            //   85ff                 | test                edi, edi
            //   7521                 | jne                 0x23
            //   6a61                 | push                0x61
            //   68????????           |                     
            //   6a43                 | push                0x43

        $sequence_5 = { 7521 8b442418 68cf050000 68???????? 50 e8???????? }
            // n = 6, score = 1200
            //   7521                 | jne                 0x23
            //   8b442418             | mov                 eax, dword ptr [esp + 0x18]
            //   68cf050000           | push                0x5cf
            //   68????????           |                     
            //   50                   | push                eax
            //   e8????????           |                     

        $sequence_6 = { 8b4c2408 68dd000000 68???????? 51 e8???????? 8b542418 }
            // n = 6, score = 1200
            //   8b4c2408             | mov                 ecx, dword ptr [esp + 8]
            //   68dd000000           | push                0xdd
            //   68????????           |                     
            //   51                   | push                ecx
            //   e8????????           |                     
            //   8b542418             | mov                 edx, dword ptr [esp + 0x18]

        $sequence_7 = { ebcd 83f814 7461 83bfdc04000017 0f8594030000 8b4768 }
            // n = 6, score = 1200
            //   ebcd                 | jmp                 0xffffffcf
            //   83f814               | cmp                 eax, 0x14
            //   7461                 | je                  0x63
            //   83bfdc04000017       | cmp                 dword ptr [edi + 0x4dc], 0x17
            //   0f8594030000         | jne                 0x39a
            //   8b4768               | mov                 eax, dword ptr [edi + 0x68]

        $sequence_8 = { 8be8 83c40c 3beb 750a 684a020000 e9???????? c744b50000000000 }
            // n = 7, score = 1200
            //   8be8                 | mov                 ebp, eax
            //   83c40c               | add                 esp, 0xc
            //   3beb                 | cmp                 ebp, ebx
            //   750a                 | jne                 0xc
            //   684a020000           | push                0x24a
            //   e9????????           |                     
            //   c744b50000000000     | mov                 dword ptr [ebp + esi*4], 0

        $sequence_9 = { c3 6873030000 68???????? be32000000 689f000000 6882010000 6a14 }
            // n = 7, score = 1200
            //   c3                   | ret                 
            //   6873030000           | push                0x373
            //   68????????           |                     
            //   be32000000           | mov                 esi, 0x32
            //   689f000000           | push                0x9f
            //   6882010000           | push                0x182
            //   6a14                 | push                0x14

    condition:
        7 of them and filesize < 3162112
}