rule win_retro_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.retro."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.retro"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 488bd7 488bcb 85c0 7407 e8???????? eb12 e8???????? }
            // n = 7, score = 200
            //   488bd7               | inc                 ecx
            //   488bcb               | comiss              xmm0, xmmword ptr [eax + 4]
            //   85c0                 | jbe                 0x22e
            //   7407                 | movss               xmm0, dword ptr [ebx + 8]
            //   e8????????           |                     
            //   eb12                 | inc                 ecx
            //   e8????????           |                     

        $sequence_1 = { 4585c0 0f841e010000 f20f101d???????? 4a8d8c8900090000 4a8d1488 478d0c41 66666666660f1f840000000000 }
            // n = 7, score = 200
            //   4585c0               | lea                 ecx, [0x4576f]
            //   0f841e010000         | unpcklps            xmm0, xmm0
            //   f20f101d????????     |                     
            //   4a8d8c8900090000     | mov                 edx, eax
            //   4a8d1488             | dec                 eax
            //   478d0c41             | mov                 ecx, esi
            //   66666666660f1f840000000000     | dec    eax

        $sequence_2 = { 7d0a f30f1035???????? eb28 486381a4000000 488d15bc3a0300 f30f100482 0f28f0 }
            // n = 7, score = 200
            //   7d0a                 | dec                 edx
            //   f30f1035????????     |                     
            //   eb28                 | lea                 eax, [ebp + esi + 0x13f0]
            //   486381a4000000       | dec                 esi
            //   488d15bc3a0300       | arpl                word ptr [eax + 0x53b0], cx
            //   f30f100482           | jne                 0x70b
            //   0f28f0               | inc                 dword ptr [ebx + 0x130]

        $sequence_3 = { 4803c9 488d94cbeca50000 48638b30010000 48038b20010000 e8???????? 448b5b18 44019b30010000 }
            // n = 7, score = 200
            //   4803c9               | test                ebp, ebp
            //   488d94cbeca50000     | je                  0x1cbd
            //   48638b30010000       | cdq                 
            //   48038b20010000       | sub                 eax, edx
            //   e8????????           |                     
            //   448b5b18             | sar                 eax, 1
            //   44019b30010000       | mov                 ebp, eax

        $sequence_4 = { f30f5cd0 0f28c1 f3410f594128 f3410f114028 f3410f59491c 0f28c2 f3410f11481c }
            // n = 7, score = 200
            //   f30f5cd0             | dec                 eax
            //   0f28c1               | mov                 edi, edx
            //   f3410f594128         | dec                 esp
            //   f3410f114028         | mov                 dword ptr [eax - 0x30], ebp
            //   f3410f59491c         | dec                 eax
            //   0f28c2               | mov                 esi, ecx
            //   f3410f11481c         | dec                 eax

        $sequence_5 = { 0f8486000000 c68424f000000000 488d8424f1000000 488bf8 33c0 b909000000 f3aa }
            // n = 7, score = 200
            //   0f8486000000         | jbe                 0x13d0
            //   c68424f000000000     | movaps              xmm2, xmm1
            //   488d8424f1000000     | inc                 ecx
            //   488bf8               | mov                 edx, esp
            //   33c0                 | inc                 ecx
            //   b909000000           | movups              xmmword ptr [esi + 0xc0], xmm2
            //   f3aa                 | comisd              xmm0, xmm1

        $sequence_6 = { 4c8b4c2450 4c8b542448 4c8b5c2440 66410f6e843958acffff 488b85b8590100 0f5bc0 f20f101406 }
            // n = 7, score = 200
            //   4c8b4c2450           | inc                 ecx
            //   4c8b542448           | addps               xmm0, xmm2
            //   4c8b5c2440           | inc                 ecx
            //   66410f6e843958acffff     | subps    xmm0, xmm0
            //   488b85b8590100       | inc                 ecx
            //   0f5bc0               | addps               xmm0, xmmword ptr [esi + 0xb4]
            //   f20f101406           | inc                 ecx

        $sequence_7 = { 898694000000 44396b24 750b 4c896b3c 4489ae84000000 8b433c 898680000000 }
            // n = 7, score = 200
            //   898694000000         | movaps              xmm4, xmm2
            //   44396b24             | inc                 esp
            //   750b                 | movaps              xmm3, xmm6
            //   4c896b3c             | movaps              xmm6, xmm3
            //   4489ae84000000       | inc                 ecx
            //   8b433c               | movaps              xmm6, xmm0
            //   898680000000         | inc                 esp

        $sequence_8 = { f3410f10490c f3410f584908 f3410f114808 f3410f10410c f3410f5c4108 f30f59c6 f3410f11400c }
            // n = 7, score = 200
            //   f3410f10490c         | movups              xmmword ptr [eax + 4], xmm0
            //   f3410f584908         | inc                 ecx
            //   f3410f114808         | movups              xmmword ptr [ecx], xmm2
            //   f3410f10410c         | inc                 ecx
            //   f3410f5c4108         | movups              xmm0, xmmword ptr [eax]
            //   f30f59c6             | inc                 ecx
            //   f3410f11400c         | subps               xmm0, xmmword ptr [eax + 0x3c]

        $sequence_9 = { 488d15e2af0300 488d0d63b60300 41b8e3020000 e8???????? 4533ed 4183be6cfeffff02 }
            // n = 6, score = 200
            //   488d15e2af0300       | inc                 ecx
            //   488d0d63b60300       | mulps               xmm1, xmmword ptr [ecx + 0x28]
            //   41b8e3020000         | addsd               xmm4, xmm0
            //   e8????????           |                     
            //   4533ed               | unpcklps            xmm1, xmm1
            //   4183be6cfeffff02     | unpcklps            xmm1, xmm1

    condition:
        7 of them and filesize < 1409024
}