rule win_retro_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-06-10"
        version = "1"
        description = "Detects win.retro."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.retro"
        malpedia_rule_date = "20210604"
        malpedia_hash = "be09d5d71e77373c0f538068be31a2ad4c69cfbd"
        malpedia_version = "20210616"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { f2440f102d???????? 440f297c2420 0f1f440000 660f6ecf 66410f28c6 f30fe6c9 f2410f59cd }
            // n = 7, score = 200
            //   f2440f102d????????     |     
            //   440f297c2420         | mov                 dword ptr [esp + 0x48], esp
            //   0f1f440000           | cmp                 edi, 2
            //   660f6ecf             | dec                 esp
            //   66410f28c6           | lea                 esp, dword ptr [ebx + 0x900]
            //   f30fe6c9             | dec                 eax
            //   f2410f59cd           | arpl                word ptr [ebp + 0x1204], ax

        $sequence_1 = { 770e f30f104c1c38 488bcf e8???????? 488bcf e8???????? }
            // n = 6, score = 200
            //   770e                 | dec                 eax
            //   f30f104c1c38         | arpl                cx, ax
            //   488bcf               | and                 ecx, 7
            //   e8????????           |                     
            //   488bcf               | dec                 ecx
            //   e8????????           |                     

        $sequence_2 = { 8bc6 e9???????? 8bcb e8???????? 90 33ff 488d05ffe30400 }
            // n = 7, score = 200
            //   8bc6                 | imul                edx, edx, 0x204
            //   e9????????           |                     
            //   8bcb                 | dec                 eax
            //   e8????????           |                     
            //   90                   | add                 edx, edi
            //   33ff                 | dec                 esp
            //   488d05ffe30400       | lea                 ecx, dword ptr [esp + 0x60]

        $sequence_3 = { 89afd8120000 4f0fbeac27bb560100 418d442d02 4489afdc120000 83f815 7c19 488d15fa110300 }
            // n = 7, score = 200
            //   89afd8120000         | inc                 ecx
            //   4f0fbeac27bb560100     | pop    edi
            //   418d442d02           | inc                 ecx
            //   4489afdc120000       | pop                 esi
            //   83f815               | dec                 eax
            //   7c19                 | mov                 ecx, dword ptr [esp + 0x160]
            //   488d15fa110300       | dec                 eax

        $sequence_4 = { 488b4c2420 ff542438 85c0 7529 b905000000 ff15???????? ff15???????? }
            // n = 7, score = 200
            //   488b4c2420           | mov                 edx, esp
            //   ff542438             | dec                 ecx
            //   85c0                 | je                  0x881
            //   7529                 | dec                 ecx
            //   b905000000           | je                  0x867
            //   ff15????????         |                     
            //   ff15????????         |                     

        $sequence_5 = { 48894c2458 4c89442460 0f1f4000 450fb74d00 4d8bfc 6644894c2424 4885f6 }
            // n = 7, score = 200
            //   48894c2458           | mulss               xmm0, dword ptr [ecx - 0x200]
            //   4c89442460           | inc                 ecx
            //   0f1f4000             | mulps               xmm1, xmmword ptr [eax - 0x100]
            //   450fb74d00           | addss               xmm3, xmm0
            //   4d8bfc               | movss               xmm2, dword ptr [eax + 0x10]
            //   6644894c2424         | subss               xmm4, xmm1
            //   4885f6               | movss               xmm1, dword ptr [eax + 0x14]

        $sequence_6 = { 488bd3 488bce f20f5ac8 f30f118efc550100 e8???????? 4c8bcf }
            // n = 6, score = 200
            //   488bd3               | lea                 eax, dword ptr [ebp + 0x850]
            //   488bce               | dec                 ecx
            //   f20f5ac8             | mov                 edx, esp
            //   f30f118efc550100     | cmp                 eax, ebx
            //   e8????????           |                     
            //   4c8bcf               | jg                  0x4f2

        $sequence_7 = { f2440f1035???????? 66660f1f840000000000 488b8c2468010000 448b8c2430010000 89542428 4963c4 498bd5 }
            // n = 7, score = 200
            //   f2440f1035????????     |     
            //   66660f1f840000000000     | inc    ebp
            //   488b8c2468010000     | lea                 eax, dword ptr [ebp - 9]
            //   448b8c2430010000     | inc                 ecx
            //   89542428             | mov                 ecx, eax
            //   4963c4               | inc                 ecx
            //   498bd5               | sub                 ecx, dword ptr [edx]

        $sequence_8 = { 410bc8 410bc0 81c9c0000000 0fbae807 894af8 8942f4 4183f904 }
            // n = 7, score = 200
            //   410bc8               | mov                 byte ptr [ebp - 0xd], al
            //   410bc0               | mov                 byte ptr [ebp - 0x28], al
            //   81c9c0000000         | mov                 byte ptr [ecx + 0x174], 0x43
            //   0fbae807             | mov                 byte ptr [ecx + 0x1f7], 0x43
            //   894af8               | dec                 eax
            //   8942f4               | lea                 eax, dword ptr [0x21028]
            //   4183f904             | dec                 eax

        $sequence_9 = { f20f59ca f20f581d???????? f20f580d???????? f20f59d8 f20f5ed9 f20f5cde }
            // n = 6, score = 200
            //   f20f59ca             | dec                 eax
            //   f20f581d????????     |                     
            //   f20f580d????????     |                     
            //   f20f59d8             | arpl                cx, di
            //   f20f5ed9             | dec                 eax
            //   f20f5cde             | or                  edi, eax

    condition:
        7 of them and filesize < 1409024
}