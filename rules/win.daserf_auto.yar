rule win_daserf_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-06-10"
        version = "1"
        description = "Detects win.daserf."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.daserf"
        malpedia_rule_date = "20210604"
        malpedia_hash = "be09d5d71e77373c0f538068be31a2ad4c69cfbd"
        malpedia_version = "20210616"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 50 8d85dccfffff 50 ffd3 68???????? }
            // n = 5, score = 100
            //   50                   | push                eax
            //   8d85dccfffff         | lea                 eax, dword ptr [ebp - 0x3024]
            //   50                   | push                eax
            //   ffd3                 | call                ebx
            //   68????????           |                     

        $sequence_1 = { bf???????? 50 c745d406000000 8975d8 }
            // n = 4, score = 100
            //   bf????????           |                     
            //   50                   | push                eax
            //   c745d406000000       | mov                 dword ptr [ebp - 0x2c], 6
            //   8975d8               | mov                 dword ptr [ebp - 0x28], esi

        $sequence_2 = { 05986797f3 90 2d3b605dc9 87c0 }
            // n = 4, score = 100
            //   05986797f3           | add                 eax, 0xf3976798
            //   90                   | nop                 
            //   2d3b605dc9           | sub                 eax, 0xc95d603b
            //   87c0                 | xchg                eax, eax

        $sequence_3 = { 8b842410f2ffff 81eb3abfa5d9 90 81ebe94330bf }
            // n = 4, score = 100
            //   8b842410f2ffff       | mov                 eax, dword ptr [esp - 0xdf0]
            //   81eb3abfa5d9         | sub                 ebx, 0xd9a5bf3a
            //   90                   | nop                 
            //   81ebe94330bf         | sub                 ebx, 0xbf3043e9

        $sequence_4 = { 2d3b605dc9 87c0 81ebdcf287d2 90 81c3a28c0de9 97 }
            // n = 6, score = 100
            //   2d3b605dc9           | sub                 eax, 0xc95d603b
            //   87c0                 | xchg                eax, eax
            //   81ebdcf287d2         | sub                 ebx, 0xd287f2dc
            //   90                   | nop                 
            //   81c3a28c0de9         | add                 ebx, 0xe90d8ca2
            //   97                   | xchg                eax, edi

        $sequence_5 = { 057b3e2b33 2d12a5f5a2 81eb8ca6da48 81c35f428f21 05cdd5c7ea 81c34ec6d46d }
            // n = 6, score = 100
            //   057b3e2b33           | add                 eax, 0x332b3e7b
            //   2d12a5f5a2           | sub                 eax, 0xa2f5a512
            //   81eb8ca6da48         | sub                 ebx, 0x48daa68c
            //   81c35f428f21         | add                 ebx, 0x218f425f
            //   05cdd5c7ea           | add                 eax, 0xeac7d5cd
            //   81c34ec6d46d         | add                 ebx, 0x6dd4c64e

        $sequence_6 = { 8bd0 8b842400f3ffff 81eb86a52fc3 87ff 2d7cfcea54 8be4 2d49801440 }
            // n = 7, score = 100
            //   8bd0                 | mov                 edx, eax
            //   8b842400f3ffff       | mov                 eax, dword ptr [esp - 0xd00]
            //   81eb86a52fc3         | sub                 ebx, 0xc32fa586
            //   87ff                 | xchg                edi, edi
            //   2d7cfcea54           | sub                 eax, 0x54eafc7c
            //   8be4                 | mov                 esp, esp
            //   2d49801440           | sub                 eax, 0x40148049

        $sequence_7 = { 81eb3c526349 2dd6761b05 2d57022590 81c315584eb7 81eb34e5384c }
            // n = 5, score = 100
            //   81eb3c526349         | sub                 ebx, 0x4963523c
            //   2dd6761b05           | sub                 eax, 0x51b76d6
            //   2d57022590           | sub                 eax, 0x90250257
            //   81c315584eb7         | add                 ebx, 0xb74e5815
            //   81eb34e5384c         | sub                 ebx, 0x4c38e534

        $sequence_8 = { f7d2 f7d2 057b2549e1 8bdb }
            // n = 4, score = 100
            //   f7d2                 | not                 edx
            //   f7d2                 | not                 edx
            //   057b2549e1           | add                 eax, 0xe149257b
            //   8bdb                 | mov                 ebx, ebx

        $sequence_9 = { 8d36 81eb2a36497e 90 2d0000aaf9 }
            // n = 4, score = 100
            //   8d36                 | lea                 esi, dword ptr [esi]
            //   81eb2a36497e         | sub                 ebx, 0x7e49362a
            //   90                   | nop                 
            //   2d0000aaf9           | sub                 eax, 0xf9aa0000

        $sequence_10 = { 90 50 8d1b 53 8bdb }
            // n = 5, score = 100
            //   90                   | nop                 
            //   50                   | push                eax
            //   8d1b                 | lea                 ebx, dword ptr [ebx]
            //   53                   | push                ebx
            //   8bdb                 | mov                 ebx, ebx

        $sequence_11 = { 2de339226e 81c368780090 81c3f215efea 81eb33a8c4a5 }
            // n = 4, score = 100
            //   2de339226e           | sub                 eax, 0x6e2239e3
            //   81c368780090         | add                 ebx, 0x90007868
            //   81c3f215efea         | add                 ebx, 0xeaef15f2
            //   81eb33a8c4a5         | sub                 ebx, 0xa5c4a833

        $sequence_12 = { 81ebf79692b4 05a1e6a1cc 81c335b6ebe6 2d09875603 81c308c970da 81eb511b8ed3 }
            // n = 6, score = 100
            //   81ebf79692b4         | sub                 ebx, 0xb49296f7
            //   05a1e6a1cc           | add                 eax, 0xcca1e6a1
            //   81c335b6ebe6         | add                 ebx, 0xe6ebb635
            //   2d09875603           | sub                 eax, 0x3568709
            //   81c308c970da         | add                 ebx, 0xda70c908
            //   81eb511b8ed3         | sub                 ebx, 0xd38e1b51

        $sequence_13 = { 50 ff75ac ff15???????? 817dd803010000 }
            // n = 4, score = 100
            //   50                   | push                eax
            //   ff75ac               | push                dword ptr [ebp - 0x54]
            //   ff15????????         |                     
            //   817dd803010000       | cmp                 dword ptr [ebp - 0x28], 0x103

        $sequence_14 = { 81eba0c1e5f7 87db 053e3b27ce 8bf6 81c3dcb468a4 }
            // n = 5, score = 100
            //   81eba0c1e5f7         | sub                 ebx, 0xf7e5c1a0
            //   87db                 | xchg                ebx, ebx
            //   053e3b27ce           | add                 eax, 0xce273b3e
            //   8bf6                 | mov                 esi, esi
            //   81c3dcb468a4         | add                 ebx, 0xa468b4dc

        $sequence_15 = { 8d8594fcffff 50 ff750c ffd6 68???????? }
            // n = 5, score = 100
            //   8d8594fcffff         | lea                 eax, dword ptr [ebp - 0x36c]
            //   50                   | push                eax
            //   ff750c               | push                dword ptr [ebp + 0xc]
            //   ffd6                 | call                esi
            //   68????????           |                     

    condition:
        7 of them and filesize < 245760
}