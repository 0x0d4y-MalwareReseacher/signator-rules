rule win_daserf_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.daserf."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.daserf"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8bd8 8b842410f3ffff 81c3c6995cb4 e9???????? 81c31ecc9a00 90 89842410f2ffff }
            // n = 7, score = 100
            //   8bd8                 | mov                 ebx, eax
            //   8b842410f3ffff       | mov                 eax, dword ptr [esp - 0xcf0]
            //   81c3c6995cb4         | add                 ebx, 0xb45c99c6
            //   e9????????           |                     
            //   81c31ecc9a00         | add                 ebx, 0x9acc1e
            //   90                   | nop                 
            //   89842410f2ffff       | mov                 dword ptr [esp - 0xdf0], eax

        $sequence_1 = { 8d1b ff15???????? 93 899c2440f1ffff 8bd8 }
            // n = 5, score = 100
            //   8d1b                 | lea                 ebx, [ebx]
            //   ff15????????         |                     
            //   93                   | xchg                eax, ebx
            //   899c2440f1ffff       | mov                 dword ptr [esp - 0xec0], ebx
            //   8bd8                 | mov                 ebx, eax

        $sequence_2 = { 05b5a84f62 9b 050c284048 93 899c2420f5ffff }
            // n = 5, score = 100
            //   05b5a84f62           | add                 eax, 0x624fa8b5
            //   9b                   | wait                
            //   050c284048           | add                 eax, 0x4840280c
            //   93                   | xchg                eax, ebx
            //   899c2420f5ffff       | mov                 dword ptr [esp - 0xae0], ebx

        $sequence_3 = { 81c3e23d36e0 81c3c013fd73 81eba41b7dd9 81c399ce028f 05bc5c00f8 }
            // n = 5, score = 100
            //   81c3e23d36e0         | add                 ebx, 0xe0363de2
            //   81c3c013fd73         | add                 ebx, 0x73fd13c0
            //   81eba41b7dd9         | sub                 ebx, 0xd97d1ba4
            //   81c399ce028f         | add                 ebx, 0x8f02ce99
            //   05bc5c00f8           | add                 eax, 0xf8005cbc

        $sequence_4 = { 2d0018fe79 87d2 81eb7985603a 7500 2d4ad5c0be 95 }
            // n = 6, score = 100
            //   2d0018fe79           | sub                 eax, 0x79fe1800
            //   87d2                 | xchg                edx, edx
            //   81eb7985603a         | sub                 ebx, 0x3a608579
            //   7500                 | jne                 2
            //   2d4ad5c0be           | sub                 eax, 0xbec0d54a
            //   95                   | xchg                eax, ebp

        $sequence_5 = { 2dad9d479a 8d36 054e3072a3 97 89bc2440f4ffff 8bf8 }
            // n = 6, score = 100
            //   2dad9d479a           | sub                 eax, 0x9a479dad
            //   8d36                 | lea                 esi, [esi]
            //   054e3072a3           | add                 eax, 0xa372304e
            //   97                   | xchg                eax, edi
            //   89bc2440f4ffff       | mov                 dword ptr [esp - 0xbc0], edi
            //   8bf8                 | mov                 edi, eax

        $sequence_6 = { e8???????? 83c40c 8d85f8f7ffff 68???????? 50 }
            // n = 5, score = 100
            //   e8????????           |                     
            //   83c40c               | add                 esp, 0xc
            //   8d85f8f7ffff         | lea                 eax, [ebp - 0x808]
            //   68????????           |                     
            //   50                   | push                eax

        $sequence_7 = { f7d2 81c324a668ac 95 89ac2410f2ffff 8be8 8b842410f2ffff 05416a1a18 }
            // n = 7, score = 100
            //   f7d2                 | not                 edx
            //   81c324a668ac         | add                 ebx, 0xac68a624
            //   95                   | xchg                eax, ebp
            //   89ac2410f2ffff       | mov                 dword ptr [esp - 0xdf0], ebp
            //   8be8                 | mov                 ebp, eax
            //   8b842410f2ffff       | mov                 eax, dword ptr [esp - 0xdf0]
            //   05416a1a18           | add                 eax, 0x181a6a41

        $sequence_8 = { 0f8eea000000 ffb5c053ffff 8d85a014ffff 50 e8???????? }
            // n = 5, score = 100
            //   0f8eea000000         | jle                 0xf0
            //   ffb5c053ffff         | push                dword ptr [ebp - 0xac40]
            //   8d85a014ffff         | lea                 eax, [ebp - 0xeb60]
            //   50                   | push                eax
            //   e8????????           |                     

        $sequence_9 = { 2dff599158 93 899c2410f1ffff 8bd8 8b842410f1ffff }
            // n = 5, score = 100
            //   2dff599158           | sub                 eax, 0x589159ff
            //   93                   | xchg                eax, ebx
            //   899c2410f1ffff       | mov                 dword ptr [esp - 0xef0], ebx
            //   8bd8                 | mov                 ebx, eax
            //   8b842410f1ffff       | mov                 eax, dword ptr [esp - 0xef0]

        $sequence_10 = { 2d6c11e96d 05ac9a3a98 81c3bac6eb2b 81eb96d44578 }
            // n = 4, score = 100
            //   2d6c11e96d           | sub                 eax, 0x6de9116c
            //   05ac9a3a98           | add                 eax, 0x983a9aac
            //   81c3bac6eb2b         | add                 ebx, 0x2bebc6ba
            //   81eb96d44578         | sub                 ebx, 0x7845d496

        $sequence_11 = { 6a00 8d8564fefeff 50 e8???????? c78590fefeff01010000 }
            // n = 5, score = 100
            //   6a00                 | push                0
            //   8d8564fefeff         | lea                 eax, [ebp - 0x1019c]
            //   50                   | push                eax
            //   e8????????           |                     
            //   c78590fefeff01010000     | mov    dword ptr [ebp - 0x10170], 0x101

        $sequence_12 = { 8b842440f2ffff 053c1cf6ea e9???????? 81eb8a502b38 }
            // n = 4, score = 100
            //   8b842440f2ffff       | mov                 eax, dword ptr [esp - 0xdc0]
            //   053c1cf6ea           | add                 eax, 0xeaf61c3c
            //   e9????????           |                     
            //   81eb8a502b38         | sub                 ebx, 0x382b508a

        $sequence_13 = { 2df7d3d1de 81c3c433ac40 81c3b8007d7c 2db3b7f18c }
            // n = 4, score = 100
            //   2df7d3d1de           | sub                 eax, 0xded1d3f7
            //   81c3c433ac40         | add                 ebx, 0x40ac33c4
            //   81c3b8007d7c         | add                 ebx, 0x7c7d00b8
            //   2db3b7f18c           | sub                 eax, 0x8cf1b7b3

        $sequence_14 = { 0568c34ed1 2dbefc96be 2deaaa7b96 81ebd5a4f105 }
            // n = 4, score = 100
            //   0568c34ed1           | add                 eax, 0xd14ec368
            //   2dbefc96be           | sub                 eax, 0xbe96fcbe
            //   2deaaa7b96           | sub                 eax, 0x967baaea
            //   81ebd5a4f105         | sub                 ebx, 0x5f1a4d5

        $sequence_15 = { 8d45fc be00280000 50 8d85ecd7ffff 56 }
            // n = 5, score = 100
            //   8d45fc               | lea                 eax, [ebp - 4]
            //   be00280000           | mov                 esi, 0x2800
            //   50                   | push                eax
            //   8d85ecd7ffff         | lea                 eax, [ebp - 0x2814]
            //   56                   | push                esi

    condition:
        7 of them and filesize < 245760
}