rule win_redalpha_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-06-10"
        version = "1"
        description = "Detects win.redalpha."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.redalpha"
        malpedia_rule_date = "20210604"
        malpedia_hash = "be09d5d71e77373c0f538068be31a2ad4c69cfbd"
        malpedia_version = "20210616"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 68???????? 50 e8???????? 83c40c c0e304 }
            // n = 5, score = 400
            //   68????????           |                     
            //   50                   | not                 ecx
            //   e8????????           |                     
            //   83c40c               | add                 ecx, dword ptr [esp]
            //   c0e304               | inc                 esp

        $sequence_1 = { 83c40c c0e304 0fb6c3 50 68???????? }
            // n = 5, score = 400
            //   83c40c               | inc                 ecx
            //   c0e304               | add                 edx, edx
            //   0fb6c3               | and                 eax, edx
            //   50                   | add                 ecx, dword ptr [esp]
            //   68????????           |                     

        $sequence_2 = { 83c40c b8???????? 5f 5e 5b }
            // n = 5, score = 400
            //   83c40c               | not                 ecx
            //   b8????????           |                     
            //   5f                   | inc                 ecx
            //   5e                   | ror                 edx, 0xc
            //   5b                   | and                 ecx, edx

        $sequence_3 = { 8b0cbd30284400 c644112900 837dfc00 7507 }
            // n = 4, score = 300
            //   8b0cbd30284400       | movzx               eax, bl
            //   c644112900           | push                eax
            //   837dfc00             | push                eax
            //   7507                 | add                 esp, 0xc

        $sequence_4 = { 030424 4403d8 41c1c30b 4503da }
            // n = 4, score = 300
            //   030424               | inc                 esp
            //   4403d8               | mov                 edx, dword ptr [ebx + 0x94]
            //   41c1c30b             | add                 dword ptr [ebx + 0x9c], eax
            //   4503da               | lea                 eax, dword ptr [ecx - 2]

        $sequence_5 = { 01839c000000 8b839c000000 448b8b0c170000 4103c1 83f803 0f82a7000000 }
            // n = 6, score = 300
            //   01839c000000         | jb                  0x71
            //   8b839c000000         | test                esi, esi
            //   448b8b0c170000       | je                  0x36
            //   4103c1               | add                 dword ptr [ebx + 0x9c], eax
            //   83f803               | mov                 eax, dword ptr [ebx + 0x9c]
            //   0f82a7000000         | inc                 esp

        $sequence_6 = { 014314 8bf7 2bf2 3bee }
            // n = 4, score = 300
            //   014314               | mov                 ecx, dword ptr [ebp - 0x80]
            //   8bf7                 | shr                 edx, cl
            //   2bf2                 | add                 edx, esi
            //   3bee                 | add                 dword ptr [ebx + 0x14], eax

        $sequence_7 = { 030424 448d8997ff2a43 03d0 418d8aa72394ab }
            // n = 4, score = 300
            //   030424               | rol                 ebx, 0xb
            //   448d8997ff2a43       | inc                 ebp
            //   03d0                 | add                 ebx, edx
            //   418d8aa72394ab       | inc                 ecx

        $sequence_8 = { 030c24 03d1 c1c207 4103d2 }
            // n = 4, score = 300
            //   030c24               | add                 ebx, edx
            //   03d1                 | inc                 ecx
            //   c1c207               | mov                 eax, ebx
            //   4103d2               | inc                 ecx

        $sequence_9 = { 41b901000000 418bd3 41d3e1 8b4d80 d3ea 03d6 }
            // n = 6, score = 300
            //   41b901000000         | inc                 ecx
            //   418bd3               | mov                 ecx, 1
            //   41d3e1               | inc                 ecx
            //   8b4d80               | mov                 edx, ebx
            //   d3ea                 | inc                 ecx
            //   03d6                 | shl                 ecx, cl

        $sequence_10 = { 8b0cbd30284400 83c410 8b7de8 89440f20 }
            // n = 4, score = 300
            //   8b0cbd30284400       | movzx               eax, bl
            //   83c410               | push                eax
            //   8b7de8               | push                eax
            //   89440f20             | add                 esp, 0xc

        $sequence_11 = { 030c24 4403d1 418bc8 f7d1 }
            // n = 4, score = 300
            //   030c24               | inc                 esp
            //   4403d1               | lea                 ecx, dword ptr [ecx + 0x432aff97]
            //   418bc8               | add                 edx, eax
            //   f7d1                 | inc                 ecx

        $sequence_12 = { 01839c000000 8d41fe 8983a0000000 0f1f4000 }
            // n = 4, score = 300
            //   01839c000000         | inc                 esp
            //   8d41fe               | mov                 ecx, dword ptr [ebx + 0x170c]
            //   8983a0000000         | inc                 ecx
            //   0f1f4000             | add                 eax, ecx

        $sequence_13 = { 8b0cc5646f4300 894de4 85c9 7455 }
            // n = 4, score = 300
            //   8b0cc5646f4300       | movzx               eax, bl
            //   894de4               | push                eax
            //   85c9                 | add                 esp, 0xc
            //   7455                 | shl                 bl, 4

        $sequence_14 = { 8b0d???????? 89048d58234400 5d c3 }
            // n = 4, score = 300
            //   8b0d????????         |                     
            //   89048d58234400       | add                 esp, 0x10
            //   5d                   | mov                 edi, dword ptr [ebp - 0x18]
            //   c3                   | mov                 dword ptr [edi + ecx + 0x20], eax

        $sequence_15 = { 8b0cb8 8d34b8 ff4b14 83c604 8d4701 894dfc 03c1 }
            // n = 7, score = 300
            //   8b0cb8               | not                 eax
            //   8d34b8               | add                 esp, 0xc
            //   ff4b14               | shl                 bl, 4
            //   83c604               | movzx               eax, bl
            //   8d4701               | push                eax
            //   894dfc               | add                 esp, 0xc
            //   03c1                 | shl                 bl, 4

        $sequence_16 = { 68???????? 68???????? c705????????00000000 c705????????00000000 c705????????00000000 ff15???????? a3???????? }
            // n = 7, score = 100
            //   68????????           |                     
            //   68????????           |                     
            //   c705????????00000000     |     
            //   c705????????00000000     |     
            //   c705????????00000000     |     
            //   ff15????????         |                     
            //   a3????????           |                     

        $sequence_17 = { e8???????? 59 5d c20400 e8???????? 85c0 0f84b71d0000 }
            // n = 7, score = 100
            //   e8????????           |                     
            //   59                   | pop                 ebp
            //   5d                   | ret                 
            //   c20400               | mov                 dword ptr [ecx*4 + 0x442358], eax
            //   e8????????           |                     
            //   85c0                 | pop                 ebp
            //   0f84b71d0000         | ret                 

        $sequence_18 = { 7810 3de4000000 7309 8b04c5680e4100 }
            // n = 4, score = 100
            //   7810                 | mov                 byte ptr [ecx + edx + 0x29], 0
            //   3de4000000           | cmp                 dword ptr [ebp - 4], 0
            //   7309                 | jne                 0x12
            //   8b04c5680e4100       | mov                 eax, 0x8000

        $sequence_19 = { 64a300000000 8965f0 8bf9 897de8 8b4508 3dfeffff7f 7605 }
            // n = 7, score = 100
            //   64a300000000         | test                bl, bl
            //   8965f0               | mov                 ecx, dword ptr [eax*8 + 0x436f64]
            //   8bf9                 | mov                 dword ptr [ebp - 0x1c], ecx
            //   897de8               | test                ecx, ecx
            //   8b4508               | je                  0x5c
            //   3dfeffff7f           | mov                 ecx, dword ptr [eax*8 + 0x436f64]
            //   7605                 | mov                 dword ptr [ebp - 0x1c], ecx

        $sequence_20 = { 8b4d10 6a00 894518 894710 }
            // n = 4, score = 100
            //   8b4d10               | jmp                 0xffffffab
            //   6a00                 | push                eax
            //   894518               | add                 esp, 0xc
            //   894710               | shl                 bl, 4

        $sequence_21 = { 8bd7 c1fa06 8bc7 83e03f 6bc830 8b049530744100 f644082801 }
            // n = 7, score = 100
            //   8bd7                 | mov                 dword ptr [ebp - 0x1c], ecx
            //   c1fa06               | test                ecx, ecx
            //   8bc7                 | je                  0x5c
            //   83e03f               | mov                 eax, dword ptr [ebp + 0x10]
            //   6bc830               | mov                 dword ptr [ebp - 0x18], eax
            //   8b049530744100       | mov                 eax, dword ptr [ebp + 0x14]
            //   f644082801           | mov                 dword ptr [ecx*4 + 0x442358], eax

        $sequence_22 = { 8a976c544000 668b8496760a0000 8bd0 d3e2 8b4e14 660996b0160000 8b5608 }
            // n = 7, score = 100
            //   8a976c544000         | shl                 bl, 4
            //   668b8496760a0000     | movzx               eax, bl
            //   8bd0                 | push                eax
            //   d3e2                 | push                eax
            //   8b4e14               | add                 esp, 0xc
            //   660996b0160000       | shl                 bl, 4
            //   8b5608               | push                eax

        $sequence_23 = { 5d c20400 c60369 bf01000000 8d86f8fdffff }
            // n = 5, score = 100
            //   5d                   | add                 esp, 0xc
            //   c20400               | shl                 bl, 4
            //   c60369               | movzx               eax, bl
            //   bf01000000           | push                eax
            //   8d86f8fdffff         | add                 esp, 0xc

        $sequence_24 = { 7408 40 83f81d 7cf1 eb07 8b0cc53c3a4100 894de4 }
            // n = 7, score = 100
            //   7408                 | jmp                 0x30
            //   40                   | mov                 ecx, dword ptr [edi*4 + 0x442830]
            //   83f81d               | mov                 byte ptr [ecx + edx + 0x29], 0
            //   7cf1                 | cmp                 dword ptr [ebp - 4], 0
            //   eb07                 | jne                 0x12
            //   8b0cc53c3a4100       | mov                 eax, 0x8000
            //   894de4               | jmp                 0x30

        $sequence_25 = { 8b04bd30744100 f644032801 7444 837c0318ff 743d }
            // n = 5, score = 100
            //   8b04bd30744100       | test                ecx, ecx
            //   f644032801           | je                  0x5c
            //   7444                 | mov                 eax, dword ptr [ebp + 0x10]
            //   837c0318ff           | mov                 ecx, dword ptr [eax*8 + 0x436f64]
            //   743d                 | mov                 dword ptr [ebp - 0x1c], ecx

        $sequence_26 = { 5d c20800 3bd7 7308 57 }
            // n = 5, score = 100
            //   5d                   | push                ebp
            //   c20800               | mov                 dword ptr [ecx*4 + 0x442358], eax
            //   3bd7                 | pop                 ebp
            //   7308                 | ret                 
            //   57                   | push                ebp

        $sequence_27 = { 5d c3 8b04c5acfc4000 5d c3 }
            // n = 5, score = 100
            //   5d                   | test                ecx, ecx
            //   c3                   | je                  0x5c
            //   8b04c5acfc4000       | mov                 eax, dword ptr [ebp + 0x10]
            //   5d                   | mov                 dword ptr [ebp - 0x18], eax
            //   c3                   | mov                 ecx, dword ptr [eax*8 + 0x436f64]

        $sequence_28 = { 8b45fc 817848184c4000 7409 ff7048 e8???????? 59 c70701000000 }
            // n = 7, score = 100
            //   8b45fc               | movzx               eax, bl
            //   817848184c4000       | push                eax
            //   7409                 | add                 esp, 0xc
            //   ff7048               | shl                 bl, 4
            //   e8????????           |                     
            //   59                   | movzx               eax, bl
            //   c70701000000         | add                 esp, 0xc

    condition:
        7 of them and filesize < 606208
}