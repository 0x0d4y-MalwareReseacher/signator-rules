rule win_beatdrop_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-07-11"
        version = "1"
        description = "Detects win.beatdrop."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.beatdrop"
        malpedia_rule_date = "20230705"
        malpedia_hash = "42d0574f4405bd7d2b154d321d345acb18834a41"
        malpedia_version = "20230715"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 418b4c2408 4d89f9 488d443500 4803742460 4889c7 f3a4 }
            // n = 6, score = 400
            //   418b4c2408           | dec                 ecx
            //   4d89f9               | and                 edi, 0xfffffff0
            //   488d443500           | dec                 ecx
            //   4803742460           | add                 edi, 0x10
            //   4889c7               | dec                 esp
            //   f3a4                 | mov                 ecx, edi

        $sequence_1 = { e8???????? eb05 49ff442418 4c89e0 }
            // n = 4, score = 400
            //   e8????????           |                     
            //   eb05                 | mov                 ecx, esp
            //   49ff442418           | dec                 ecx
            //   4c89e0               | mov                 esp, edx

        $sequence_2 = { 4533848500080000 89d8 c1eb10 418b549500 c1e818 4333949d000c0000 0fb6db }
            // n = 7, score = 400
            //   4533848500080000     | dec                 ecx
            //   89d8                 | mov                 ecx, esi
            //   c1eb10               | inc                 ecx
            //   418b549500           | mov                 eax, 0x10
            //   c1e818               | dec                 eax
            //   4333949d000c0000     | lea                 edx, [0x8a8d]
            //   0fb6db               | dec                 eax

        $sequence_3 = { 4c894c2458 4c8d4c2458 4c894c2428 e8???????? 4883c438 c3 4154 }
            // n = 7, score = 400
            //   4c894c2458           | lea                 edx, [0xc953]
            //   4c8d4c2458           | cmp                 byte ptr [ebx], 3
            //   4c894c2428           | jne                 0x1cec
            //   e8????????           |                     
            //   4883c438             | dec                 eax
            //   c3                   | cmp                 dword ptr [ebx + 8], 0
            //   4154                 | jne                 0x1d13

        $sequence_4 = { 4d89e6 e8???????? 4c8b2e 4c8b7e08 4889c1 4889c5 e8???????? }
            // n = 7, score = 400
            //   4d89e6               | dec                 eax
            //   e8????????           |                     
            //   4c8b2e               | mov                 dword ptr [ebx - 0x38], eax
            //   4c8b7e08             | mov                 dword ptr [ebx - 0xa0], 1
            //   4889c1               | dec                 eax
            //   4889c5               | mov                 dword ptr [ebx - 0x78], eax
            //   e8????????           |                     

        $sequence_5 = { 4189cd 89d3 89c1 c1eb18 41c1ea18 }
            // n = 5, score = 400
            //   4189cd               | mov                 eax, edx
            //   89d3                 | dec                 eax
            //   89c1                 | lea                 edx, [0x8e1d]
            //   c1eb18               | dec                 eax
            //   41c1ea18             | lea                 ecx, [0x8d54]

        $sequence_6 = { 448b8d0c010000 4489d0 48899510010000 410fcb d1e8 44335d00 }
            // n = 6, score = 400
            //   448b8d0c010000       | dec                 esp
            //   4489d0               | mov                 ecx, ebp
            //   48899510010000       | dec                 esp
            //   410fcb               | mov                 ecx, ebp
            //   d1e8                 | test                al, al
            //   44335d00             | jne                 0xf4a

        $sequence_7 = { 43339cac00080000 448b742414 4533848c00080000 0fb6ef 4489c1 448b442408 478b0484 }
            // n = 7, score = 400
            //   43339cac00080000     | dec                 eax
            //   448b742414           | cmp                 dword ptr [ebx + 0x20], 0
            //   4533848c00080000     | jne                 0x1541
            //   0fb6ef               | inc                 ecx
            //   4489c1               | mov                 eax, 0x184e
            //   448b442408           | dec                 eax
            //   478b0484             | lea                 edx, [0x11f15]

        $sequence_8 = { 4c89e1 e8???????? 4c89e9 8844242f e8???????? 8a44242f 4883c448 }
            // n = 7, score = 400
            //   4c89e1               | cmp                 dword ptr [eax], 4
            //   e8????????           |                     
            //   4c89e9               | je                  0xdc4
            //   8844242f             | dec                 eax
            //   e8????????           |                     
            //   8a44242f             | lea                 ecx, [0xb81a]
            //   4883c448             | cmp                 eax, -1

        $sequence_9 = { 410fb61414 410fb60404 4e8d74b500 41c1e318 488b8c2488000000 41333e 4133460c }
            // n = 7, score = 400
            //   410fb61414           | jmp                 0xa6e
            //   410fb60404           | dec                 eax
            //   4e8d74b500           | mov                 ecx, esi
            //   41c1e318             | dec                 eax
            //   488b8c2488000000     | mov                 edx, esi
            //   41333e               | dec                 esp
            //   4133460c             | mov                 ecx, esp

    condition:
        7 of them and filesize < 584704
}