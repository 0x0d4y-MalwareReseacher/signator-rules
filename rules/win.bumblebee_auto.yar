rule win_bumblebee_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2023-01-25"
        version = "1"
        description = "Detects win.bumblebee."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.bumblebee"
        malpedia_rule_date = "20230124"
        malpedia_hash = "2ee0eebba83dce3d019a90519f2f972c0fcf9686"
        malpedia_version = "20230125"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 8b4510 8b4808 8b5104 52 ff15???????? 8945f8 837df800 }
            // n = 7, score = 2100
            //   8b4510               | dec                 eax
            //   8b4808               | mov                 ecx, ebx
            //   8b5104               | test                eax, eax
            //   52                   | jle                 0x138f
            //   ff15????????         |                     
            //   8945f8               | test                eax, eax
            //   837df800             | jle                 0x13ae

        $sequence_1 = { 488943f8 eb08 e8???????? 488bd8 4c8b4608 4d3bc0 4d85c0 }
            // n = 7, score = 2100
            //   488943f8             | dec                 eax
            //   eb08                 | test                eax, eax
            //   e8????????           |                     
            //   488bd8               | jne                 0x1309
            //   4c8b4608             | dec                 eax
            //   4d3bc0               | lea                 edx, [0x6f088]
            //   4d85c0               | jmp                 0x1316

        $sequence_2 = { 8701 b801000000 eb5b 8b442440 486bc03c 41b904000000 41b800300000 }
            // n = 7, score = 2100
            //   8701                 | mov                 dword ptr [esp + 0x38], eax
            //   b801000000           | cmp                 byte ptr [ecx + 0x10], 0
            //   eb5b                 | je                  0x185f
            //   8b442440             | mov                 byte ptr [ecx + 0x10], 0
            //   486bc03c             | mov                 byte ptr [ecx + 0x10], 4
            //   41b904000000         | jmp                 0x18c2
            //   41b800300000         | dec                 eax

        $sequence_3 = { 4863442438 488b8c24a0010000 488b0cc1 ff15???????? 89442448 8b442444 }
            // n = 6, score = 2100
            //   4863442438           | dec                 ecx
            //   488b8c24a0010000     | add                 edx, ecx
            //   488b0cc1             | jmp                 edx
            //   ff15????????         |                     
            //   89442448             | dec                 esp
            //   8b442444             | mov                 dword ptr [esp + 0x40], eax

        $sequence_4 = { 7506 c645fe01 eb0b 8b4df0 83c101 894df0 eb9d }
            // n = 7, score = 2100
            //   7506                 | jb                  0x1e3
            //   c645fe01             | imul                eax, edx, 0x64
            //   eb0b                 | lea                 edi, [edx + edx]
            //   8b4df0               | inc                 esp
            //   83c101               | sub                 ecx, eax
            //   894df0               | inc                 ebp
            //   eb9d                 | add                 ecx, ecx

        $sequence_5 = { e8???????? 488b442450 488d0c40 48c1e105 488b442440 480308 0f1001 }
            // n = 7, score = 2100
            //   e8????????           |                     
            //   488b442450           | or                  eax, eax
            //   488d0c40             | dec                 eax
            //   48c1e105             | mov                 dword ptr [esi + 8], ecx
            //   488b442440           | inc                 ecx
            //   480308               | cmp                 ecx, 0x20
            //   0f1001               | jbe                 0x18f3

        $sequence_6 = { 81c200002000 3955f0 760a 8b45fc 50 ff15???????? eb0a }
            // n = 7, score = 2100
            //   81c200002000         | mov                 esi, dword ptr [ebp - 0x48]
            //   3955f0               | dec                 eax
            //   760a                 | mov                 edi, dword ptr [ebp - 0x50]
            //   8b45fc               | dec                 esp
            //   50                   | mov                 dword ptr [ebp - 0x18], esi
            //   ff15????????         |                     
            //   eb0a                 | dec                 eax

        $sequence_7 = { 7507 c644243101 eb0f 8b442438 ffc0 89442438 }
            // n = 6, score = 2100
            //   7507                 | sub                 edi, ecx
            //   c644243101           | dec                 ecx
            //   eb0f                 | lea                 edx, [edi + ebp]
            //   8b442438             | inc                 esp
            //   ffc0                 | mov                 eax, ecx
            //   89442438             | jb                  0x14e

        $sequence_8 = { 486bc93e 488d440804 4889442448 488b442448 4883c012 41b82c000000 b290 }
            // n = 7, score = 2100
            //   486bc93e             | dec                 eax
            //   488d440804           | mov                 dword ptr [esp + 0x28], eax
            //   4889442448           | cmp                 dword ptr [ecx + 0x8c], 0
            //   488b442448           | inc                 esp
            //   4883c012             | mov                 esi, edx
            //   41b82c000000         | dec                 eax
            //   b290                 | mov                 ebx, ecx

        $sequence_9 = { 488d8a38000000 4883c108 e9???????? 488d8a38000000 e9???????? 488d8a38000000 4883c108 }
            // n = 7, score = 2100
            //   488d8a38000000       | dec                 eax
            //   4883c108             | mov                 dword ptr [ebx], eax
            //   e9????????           |                     
            //   488d8a38000000       | inc                 eax
            //   e9????????           |                     
            //   488d8a38000000       | test                bh, 1
            //   4883c108             | je                  0x1a07

    condition:
        7 of them and filesize < 4825088
}