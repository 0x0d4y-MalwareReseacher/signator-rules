rule win_poslurp_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-06-10"
        version = "1"
        description = "Detects win.poslurp."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.poslurp"
        malpedia_rule_date = "20210604"
        malpedia_hash = "be09d5d71e77373c0f538068be31a2ad4c69cfbd"
        malpedia_version = "20210616"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { c640f316 c640f417 c640f51a 458bc8 0f1f00 410fb64201 }
            // n = 6, score = 100
            //   c640f316             | xor                 eax, eax
            //   c640f417             | mov                 dl, 1
            //   c640f51a             | xor                 ebx, ebx
            //   458bc8               | mov                 word ptr [esp + 0x38], ax
            //   0f1f00               | mov                 eax, 0x52
            //   410fb64201           | inc                 ebp

        $sequence_1 = { 482bca 8bd3 48ffc9 48d1f9 }
            // n = 4, score = 100
            //   482bca               | imul                eax, eax, 0x22
            //   8bd3                 | dec                 eax
            //   48ffc9               | add                 eax, edx
            //   48d1f9               | dec                 eax

        $sequence_2 = { 0f84eb000000 4863463c 48899c2498000000 48899c2490000000 48896c2458 }
            // n = 5, score = 100
            //   0f84eb000000         | mov                 dword ptr [esp + 0x62], ecx
            //   4863463c             | mov                 word ptr [esp + 0x60], di
            //   48899c2498000000     | inc                 sp
            //   48899c2490000000     | mov                 dword ptr [esp + 0x62], ecx
            //   48896c2458           | mov                 word ptr [esp + 0x64], bx

        $sequence_3 = { 66895c2440 668944243e 48895c2420 ff15???????? 488905???????? 4885c0 750b }
            // n = 7, score = 100
            //   66895c2440           | lea                 ebp, dword ptr [edx + 1]
            //   668944243e           | test                ax, ax
            //   48895c2420           | jne                 0x11fb
            //   ff15????????         |                     
            //   488905????????       |                     
            //   4885c0               | inc                 ecx
            //   750b                 | inc                 edx

        $sequence_4 = { 48896c2458 4c89642450 448b643050 41b900300000 33d2 488bcf 4d8bc4 }
            // n = 7, score = 100
            //   48896c2458           | mov                 dword ptr [esp + 0x20], edi
            //   4c89642450           | dec                 eax
            //   448b643050           | mov                 ecx, ebx
            //   41b900300000         | dec                 eax
            //   33d2                 | mov                 edx, esi
            //   488bcf               | test                eax, eax
            //   4d8bc4               | je                  0x166c

        $sequence_5 = { 4c2b5c0830 7471 418b4004 85c0 7469 0f1f840000000000 }
            // n = 6, score = 100
            //   4c2b5c0830           | mov                 esi, ebp
            //   7471                 | dec                 ecx
            //   418b4004             | mov                 edi, esp
            //   85c0                 | rep movsb           byte ptr es:[edi], byte ptr [esi]
            //   7469                 | dec                 ecx
            //   0f1f840000000000     | mov                 ecx, esp

        $sequence_6 = { ff15???????? 4883f830 0f85b3000000 817c245000100000 }
            // n = 4, score = 100
            //   ff15????????         |                     
            //   4883f830             | inc                 ebp
            //   0f85b3000000         | xor                 eax, eax
            //   817c245000100000     | mov                 dl, 1

        $sequence_7 = { ffc2 48ffc6 85c9 75ea }
            // n = 4, score = 100
            //   ffc2                 | mov                 esp, ebp
            //   48ffc6               | dec                 eax
            //   85c9                 | test                ebp, ebp
            //   75ea                 | dec                 eax

        $sequence_8 = { baeeeac01f 488bcb 4c8bf0 e8???????? 837e1000 }
            // n = 5, score = 100
            //   baeeeac01f           | mov                 dword ptr [esp + 0x40], eax
            //   488bcb               | dec                 eax
            //   4c8bf0               | mov                 dword ptr [esp + 0x38], ebx
            //   e8????????           |                     
            //   837e1000             | dec                 eax

        $sequence_9 = { 0f85b6000000 448915???????? 4183fb05 7309 33c9 ff15???????? cc }
            // n = 7, score = 100
            //   0f85b6000000         | mov                 dword ptr [esp + 0x20], edi
            //   448915????????       |                     
            //   4183fb05             | dec                 eax
            //   7309                 | mov                 ecx, ebx
            //   33c9                 | inc                 esp
            //   ff15????????         |                     
            //   cc                   | mov                 eax, ebp

    condition:
        7 of them and filesize < 50176
}