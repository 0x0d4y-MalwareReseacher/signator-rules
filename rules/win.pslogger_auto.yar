rule win_pslogger_auto {

    meta:
        author = "Felix Bilstein - yara-signator at cocacoding dot com"
        date = "2021-06-10"
        version = "1"
        description = "Detects win.pslogger."
        info = "autogenerated rule brought to you by yara-signator"
        tool = "yara-signator v0.6.0"
        signator_config = "callsandjumps;datarefs;binvalue"
        malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.pslogger"
        malpedia_rule_date = "20210604"
        malpedia_hash = "be09d5d71e77373c0f538068be31a2ad4c69cfbd"
        malpedia_version = "20210616"
        malpedia_license = "CC BY-SA 4.0"
        malpedia_sharing = "TLP:WHITE"

    /* DISCLAIMER
     * The strings used in this rule have been automatically selected from the
     * disassembly of memory dumps and unpacked files, using YARA-Signator.
     * The code and documentation is published here:
     * https://github.com/fxb-cocacoding/yara-signator
     * As Malpedia is used as data source, please note that for a given
     * number of families, only single samples are documented.
     * This likely impacts the degree of generalization these rules will offer.
     * Take the described generation method also into consideration when you
     * apply the rules in your use cases and assign them confidence levels.
     */


    strings:
        $sequence_0 = { 7473 4863d7 4c8d053c590100 498904d0 }
            // n = 4, score = 200
            //   7473                 | dec                 eax
            //   4863d7               | lea                 edx, dword ptr [esp + 0xd0]
            //   4c8d053c590100       | ret                 
            //   498904d0             | inc                 ecx

        $sequence_1 = { 741c f0ff09 7517 488d0587260100 488b4c2430 483bc8 7406 }
            // n = 7, score = 200
            //   741c                 | mov                 eax, 1
            //   f0ff09               | dec                 eax
            //   7517                 | lea                 ebx, dword ptr [0xefb3]
            //   488d0587260100       | inc                 ecx
            //   488b4c2430           | test                al, al
            //   483bc8               | jne                 0x45
            //   7406                 | push                edi

        $sequence_2 = { 488d050d520100 c3 4053 4883ec20 8b05???????? bb14000000 }
            // n = 6, score = 200
            //   488d050d520100       | dec                 eax
            //   c3                   | lea                 eax, dword ptr [0x1520d]
            //   4053                 | ret                 
            //   4883ec20             | inc                 eax
            //   8b05????????         |                     
            //   bb14000000           | push                ebx

        $sequence_3 = { e8???????? 488d15c5570100 488d4c2420 48895c2420 }
            // n = 4, score = 200
            //   e8????????           |                     
            //   488d15c5570100       | mov                 dword ptr [esp + 0x20], edi
            //   488d4c2420           | dec                 esp
            //   48895c2420           | lea                 eax, dword ptr [0xea6]

        $sequence_4 = { 897c2420 ff15???????? 4c8d05a60e0000 4533c9 }
            // n = 4, score = 200
            //   897c2420             | dec                 eax
            //   ff15????????         |                     
            //   4c8d05a60e0000       | sub                 esp, 0x20
            //   4533c9               | mov                 ebx, 0x14

        $sequence_5 = { c3 8b05???????? 41b801000000 488d1db3ef0000 4184c0 7539 }
            // n = 6, score = 200
            //   c3                   | dec                 eax
            //   8b05????????         |                     
            //   41b801000000         | mov                 dword ptr [esp + 0x20], ebx
            //   488d1db3ef0000       | dec                 esp
            //   4184c0               | mov                 ebp, eax
            //   7539                 | dec                 eax

        $sequence_6 = { ff15???????? 4c8be8 4885c0 753f 488d05857c0100 48898424d0000000 488d9424d0000000 }
            // n = 7, score = 200
            //   ff15????????         |                     
            //   4c8be8               | inc                 ebp
            //   4885c0               | xor                 ecx, ecx
            //   753f                 | dec                 eax
            //   488d05857c0100       | lea                 edx, dword ptr [0x157c5]
            //   48898424d0000000     | dec                 eax
            //   488d9424d0000000     | lea                 ecx, dword ptr [esp + 0x20]

        $sequence_7 = { 57 4883ec20 488bd9 488d3537770100 0f1f8000000000 8b83ccaf0600 }
            // n = 6, score = 200
            //   57                   | test                eax, eax
            //   4883ec20             | jne                 0x41
            //   488bd9               | dec                 eax
            //   488d3537770100       | lea                 eax, dword ptr [0x17c85]
            //   0f1f8000000000       | dec                 eax
            //   8b83ccaf0600         | mov                 dword ptr [esp + 0xd0], eax

        $sequence_8 = { 8d7608 660fd60f 8d7f08 8b048d04ed4100 ffe0 }
            // n = 5, score = 100
            //   8d7608               | lea                 esi, dword ptr [esi + 8]
            //   660fd60f             | movq                qword ptr [edi], xmm1
            //   8d7f08               | lea                 edi, dword ptr [edi + 8]
            //   8b048d04ed4100       | mov                 eax, dword ptr [ecx*4 + 0x41ed04]
            //   ffe0                 | jmp                 eax

        $sequence_9 = { 899de4feffff e8???????? 8d95e8feffff e8???????? 53 8d55e8 8d8de8feffff }
            // n = 7, score = 100
            //   899de4feffff         | mov                 dword ptr [ebp - 0x11c], ebx
            //   e8????????           |                     
            //   8d95e8feffff         | lea                 edx, dword ptr [ebp - 0x118]
            //   e8????????           |                     
            //   53                   | push                ebx
            //   8d55e8               | lea                 edx, dword ptr [ebp - 0x18]
            //   8d8de8feffff         | lea                 ecx, dword ptr [ebp - 0x118]

        $sequence_10 = { 81e6fdff0000 83ce02 8b048540734200 33c1 894330 }
            // n = 5, score = 100
            //   81e6fdff0000         | and                 esi, 0xfffd
            //   83ce02               | or                  esi, 2
            //   8b048540734200       | mov                 eax, dword ptr [eax*4 + 0x427340]
            //   33c1                 | xor                 eax, ecx
            //   894330               | mov                 dword ptr [ebx + 0x30], eax

        $sequence_11 = { 83c408 85f6 0f84e8000000 8bce 8d5101 }
            // n = 5, score = 100
            //   83c408               | add                 esp, 8
            //   85f6                 | test                esi, esi
            //   0f84e8000000         | je                  0xee
            //   8bce                 | mov                 ecx, esi
            //   8d5101               | lea                 edx, dword ptr [ecx + 1]

        $sequence_12 = { 8b4748 c74010206c4000 8b4748 8938 8b4748 c7400408000000 8b4f48 }
            // n = 7, score = 100
            //   8b4748               | mov                 eax, dword ptr [edi + 0x48]
            //   c74010206c4000       | mov                 dword ptr [eax + 0x10], 0x406c20
            //   8b4748               | mov                 eax, dword ptr [edi + 0x48]
            //   8938                 | mov                 dword ptr [eax], edi
            //   8b4748               | mov                 eax, dword ptr [edi + 0x48]
            //   c7400408000000       | mov                 dword ptr [eax + 4], 8
            //   8b4f48               | mov                 ecx, dword ptr [edi + 0x48]

        $sequence_13 = { b826000000 6689842428040000 e9???????? b82a000000 6689842428040000 }
            // n = 5, score = 100
            //   b826000000           | mov                 eax, 0x26
            //   6689842428040000     | mov                 word ptr [esp + 0x428], ax
            //   e9????????           |                     
            //   b82a000000           | mov                 eax, 0x2a
            //   6689842428040000     | mov                 word ptr [esp + 0x428], ax

        $sequence_14 = { 83e03f c1fb06 6bc830 8b049d88b14200 }
            // n = 4, score = 100
            //   83e03f               | and                 eax, 0x3f
            //   c1fb06               | sar                 ebx, 6
            //   6bc830               | imul                ecx, eax, 0x30
            //   8b049d88b14200       | mov                 eax, dword ptr [ebx*4 + 0x42b188]

        $sequence_15 = { 898598fbffff 8b4318 034310 89859cfbffff 8d45e8 8985a4fcffff 8d45dc }
            // n = 7, score = 100
            //   898598fbffff         | mov                 dword ptr [ebp - 0x468], eax
            //   8b4318               | mov                 eax, dword ptr [ebx + 0x18]
            //   034310               | add                 eax, dword ptr [ebx + 0x10]
            //   89859cfbffff         | mov                 dword ptr [ebp - 0x464], eax
            //   8d45e8               | lea                 eax, dword ptr [ebp - 0x18]
            //   8985a4fcffff         | mov                 dword ptr [ebp - 0x35c], eax
            //   8d45dc               | lea                 eax, dword ptr [ebp - 0x24]

    condition:
        7 of them and filesize < 434176
}